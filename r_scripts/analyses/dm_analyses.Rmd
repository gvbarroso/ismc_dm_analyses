---
title: "What shapes genome-wide diversity?"
subtitle: "A case study in Drosophila melanogaster"
author: "Gustavo V. Barroso and Julien Y. Dutheil"
date: "February 13th 2023"
output:
  pdf_document:
    toc: true
    number_sections: true
    toc_depth: 3
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}

knitr::opts_chunk$set(echo = TRUE)

library(ppcor)
library(MASS)
library(reshape2) #
library(cowplot)
library(lmtest)
library(nlme)
library(boot)
library(car)
library(plyr)
library(tidyverse)
library(GenomicRanges) 
library(RColorBrewer)
library(scales)
library(interactions)

# Update according to where the data from FigShare was extracted, if needed:
knitr::opts_knit$set(root.dir = "~/Data/iSMC/root/")

nreps <- 10
reps <- character(length = nreps)
for(i in 1:nreps) {
  reps[i] <- paste("rep_", i, sep = "")
}
```

# Drosophila-like neutral simulations of chr 2L (True Landscapes)

Second batch of 10 replicate datasets simulated using parameters as inferred from real
Drosophila data.

Here we present results using true (simulated) genomic landscapes.

## 50 kb scale

```{r, message=FALSE, warning=FALSE}
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/dm.sim.rho.50000.txt", header = T)
sim.theta.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/dm.sim.theta.50000.txt", header = T)
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
rep_1.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_1/rep_1.pi.50kb.bedgraph", header = T)
rep_1.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_1/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_1.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_1.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho))  / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)


sim.lands.50kb.rep5 <- sim.lands.50kb
sim.lands.50kb.rep5$Replicate <- 1

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = sim.lands.50kb)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = sim.lands.50kb)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 1] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.50kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.50kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.50kb, weights = varPower(0, ~theta), method = "ML")

g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.50kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.3)

vif(g.div.50kb.3)
```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
rep_2.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_2/rep_2.pi.50kb.bedgraph", header = T)
rep_2.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_2/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_2.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_2.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

sim.lands.50kb.rep2 <- sim.lands.50kb
sim.lands.50kb.rep2$Replicate <- 2

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = sim.lands.50kb)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = sim.lands.50kb)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 2] <- anova.diversity$VarExp[4] * 100
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
rep_3.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_3/rep_3.pi.50kb.bedgraph", header = T)
rep_3.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_3/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_3.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_3.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)


sim.lands.50kb.rep3 <- sim.lands.50kb
sim.lands.50kb.rep3$Replicate <- 3

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 3] <- anova.diversity$VarExp[4] * 100
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
rep_4.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_4/rep_4.pi.50kb.bedgraph", header = T)
rep_4.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_4/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_4.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_4.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

sim.lands.50kb.rep4 <- sim.lands.50kb
sim.lands.50kb.rep4$Replicate <- 4

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 4] <- anova.diversity$VarExp[4] * 100
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
rep_5.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_5/rep_5.pi.50kb.bedgraph", header = T)
rep_5.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_5/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_5.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_5.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

sim.lands.50kb.rep5 <- sim.lands.50kb
sim.lands.50kb.rep5$Replicate <- 5

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 5] <- anova.diversity$VarExp[4] * 100
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
rep_6.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_6/rep_6.pi.50kb.bedgraph", header = T)
rep_6.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_6/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_6.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_6.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

sim.lands.50kb.rep6 <- sim.lands.50kb
sim.lands.50kb.rep6$Replicate <- 6

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 6] <- anova.diversity$VarExp[4] * 100
```

### Replicate 7

```{r, message=FALSE, warning=FALSE}
rep_7.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_7/rep_7.pi.50kb.bedgraph", header = T)
rep_7.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_7/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_7.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_7.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

sim.lands.50kb.rep7 <- sim.lands.50kb
sim.lands.50kb.rep7$Replicate <- 7

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 7] <- anova.diversity$VarExp[4] * 100
```

### Replicate 8

```{r}
rep_8.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_8/rep_8.pi.50kb.bedgraph", header = T)
rep_8.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_8/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_8.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_8.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

sim.lands.50kb.rep8 <- sim.lands.50kb
sim.lands.50kb.rep8$Replicate <- 8

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 8] <- anova.diversity$VarExp[4] * 100
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
rep_9.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_9/rep_9.pi.50kb.bedgraph", header = T)
rep_9.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_9/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_9.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_9.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

sim.lands.50kb.rep9 <- sim.lands.50kb
sim.lands.50kb.rep9 $Replicate <- 9

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 9] <- anova.diversity$VarExp[4] * 100
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
rep_10.pi.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_10/rep_10.pi.50kb.bedgraph", header = T)
rep_10.tmrca.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_10/sim.tmrca.50k.map", header = T)

sim.lands.50kb <- as.data.frame(cbind(rep_10.pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_10.tmrca.50kb$tmrca))
names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.50kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.50kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.50kb, method = "spearman") 

# standardizing
sim.lands.50kb$thetaS <- (sim.lands.50kb$theta - mean(sim.lands.50kb$theta)) / sd(sim.lands.50kb$theta)
sim.lands.50kb$tmrcaS <- (sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)) / sd(sim.lands.50kb$tmrca)
sim.lands.50kb$rhoS <- (sim.lands.50kb$rho - mean(sim.lands.50kb$rho)) / sd(sim.lands.50kb$rho)

sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

sim.lands.50kb.rep50 <- sim.lands.50kb
sim.lands.50kb.rep50$Replicate <- 10

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.50kb)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.50kb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.50kb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.sim.50kb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.sim.50kb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.sim.50kb[5, 10] <- anova.diversity$VarExp[4] * 100

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))
```

### all replicates:

```{r, message=FALSE, warning=FALSE}
sim.lands.50kb.all <- rbind(sim.lands.50kb.rep5, sim.lands.50kb.rep2, sim.lands.50kb.rep3, sim.lands.50kb.rep4, sim.lands.50kb.rep5, sim.lands.50kb.rep6, sim.lands.50kb.rep7, sim.lands.50kb.rep8, sim.lands.50kb.rep9, sim.lands.50kb.rep50)

m.div.50kb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS)*as.factor(Replicate), data = sim.lands.50kb.all)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

m.div.50kb.2 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS)*as.factor(Replicate), data = sim.lands.50kb.all)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS + rhoS:tmrcaS)*as.factor(Replicate), data = sim.lands.50kb.all)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)
summary(m.div.50kb)
```

## 200 kb scale

```{r, message=FALSE, warning=FALSE}
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/dm.sim.rho.2e+05.txt", header = T)
sim.theta.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/dm.sim.theta.2e+05.txt", header = T)
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
rep_1.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_1/rep_1.pi.200kb.bedgraph", header = T)
rep_1.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_1/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_1.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_1.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep5 <- sim.lands.200kb
sim.lands.200kb.rep5$Replicate <- 1

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 1] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.1)

vif(g.div.200kb.1)
```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
rep_2.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_2/rep_2.pi.200kb.bedgraph", header = T)
rep_2.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_2/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_2.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_2.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep2 <- sim.lands.200kb
sim.lands.200kb.rep2$Replicate <- 2

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 2] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.4)

vif(g.div.200kb.4)
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
rep_3.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_3/rep_3.pi.200kb.bedgraph", header = T)
rep_3.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_3/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_3.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_3.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep3 <- sim.lands.200kb
sim.lands.200kb.rep3$Replicate <- 3

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 3] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.1)

vif(g.div.200kb.1)
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
rep_4.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_4/rep_4.pi.200kb.bedgraph", header = T)
rep_4.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_4/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_4.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_4.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep4 <- sim.lands.200kb
sim.lands.200kb.rep4$Replicate <- 4

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 4] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.1)

vif(g.div.200kb.1)
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
rep_5.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_5/rep_5.pi.200kb.bedgraph", header = T)
rep_5.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_5/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_5.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_5.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep5 <- sim.lands.200kb
sim.lands.200kb.rep5$Replicate <- 5

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 5] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.1)

vif(g.div.200kb.1)
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
rep_6.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_6/rep_6.pi.200kb.bedgraph", header = T)
rep_6.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_6/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_6.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_6.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep6 <- sim.lands.200kb
sim.lands.200kb.rep6$Replicate <- 6

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 6] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.1)

vif(g.div.200kb.1)
```

### Replicate 7

```{r, message=FALSE, warning=FALSE}
rep_7.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_7/rep_7.pi.200kb.bedgraph", header = T)
rep_7.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_7/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_7.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_7.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep7 <- sim.lands.200kb
sim.lands.200kb.rep7$Replicate <- 7

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 7] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.1)

vif(g.div.200kb.1)
```

### Replicate 8

```{r, message=FALSE, warning=FALSE}
rep_8.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_8/rep_8.pi.200kb.bedgraph", header = T)
rep_8.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_8/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_8.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_8.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep8 <- sim.lands.200kb
sim.lands.200kb.rep8$Replicate <- 8

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 8] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.1)

vif(g.div.200kb.1)
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
rep_9.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_9/rep_9.pi.200kb.bedgraph", header = T)
rep_9.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_9/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_9.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_9.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep9 <- sim.lands.200kb
sim.lands.200kb.rep9$Replicate <- 9

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 9] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.1)

vif(g.div.200kb.1)
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
rep_10.pi.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_10/rep_10.pi.200kb.bedgraph", header = T)
rep_10.tmrca.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_10/sim.tmrca.200k.map", header = T)

sim.lands.200kb <- as.data.frame(cbind(rep_10.pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_10.tmrca.200kb$tmrca))
names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.200kb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.200kb$thetaS <- (sim.lands.200kb$theta - mean(sim.lands.200kb$theta)) / sd(sim.lands.200kb$theta)
sim.lands.200kb$tmrcaS <- (sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)) / sd(sim.lands.200kb$tmrca)
sim.lands.200kb$rhoS <- (sim.lands.200kb$rho - mean(sim.lands.200kb$rho)) / sd(sim.lands.200kb$rho)

sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)

sim.lands.200kb.rep50 <- sim.lands.200kb
sim.lands.200kb.rep50$Replicate <- 10

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.200kb)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.200kb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.200kb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.sim.200kb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.sim.200kb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.sim.200kb[5, 10] <- anova.diversity$VarExp[4] * 100

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~theta), method = "ML")

g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.200kb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.3)

vif(g.div.200kb.3)
```

### all replicates:

```{r, message=FALSE, warning=FALSE}
sim.lands.200kb.all <- rbind(sim.lands.200kb.rep5, sim.lands.200kb.rep2, sim.lands.200kb.rep3, sim.lands.200kb.rep4, sim.lands.200kb.rep5, sim.lands.200kb.rep6, sim.lands.200kb.rep7, sim.lands.200kb.rep8, sim.lands.200kb.rep9, sim.lands.200kb.rep50)

m.div.200kb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS)*as.factor(Replicate), data = sim.lands.200kb.all)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

m.div.200kb.2 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS)*as.factor(Replicate), data = sim.lands.200kb.all)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS + rhoS:tmrcaS)*as.factor(Replicate), data = sim.lands.200kb.all)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)
summary(m.div.200kb)
```

## 1 Mb scale

```{r, message=FALSE, warning=FALSE}
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/dm.sim.rho.1e+06.txt", header = T)
sim.theta.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/dm.sim.theta.1e+06.txt", header = T)
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
rep_1.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_1/rep_1.pi.1Mb.bedgraph", header = T)
rep_1.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_1/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_1.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_1.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep5 <- sim.lands.1Mb
sim.lands.1Mb.rep5$Replicate <- 1

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 1] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.2)

vif(g.div.1Mb.2)
```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
rep_2.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_2/rep_2.pi.1Mb.bedgraph", header = T)
rep_2.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_2/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_2.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_2.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

cor.test(~diversity+theta, data = sim.lands.200kb, method = "spearman") 
cor.test(~diversity+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~diversity+rho, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep2 <- sim.lands.1Mb
sim.lands.1Mb.rep2$Replicate <- 2

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 2] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.4)

vif(g.div.1Mb.4)
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
rep_3.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_3/rep_3.pi.1Mb.bedgraph", header = T)
rep_3.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_3/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_3.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_3.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

cor.test(~diversity+theta, data = sim.lands.200kb, method = "spearman") 
cor.test(~diversity+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~diversity+rho, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep3 <- sim.lands.1Mb
sim.lands.1Mb.rep3$Replicate <- 3

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 3] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.2)

vif(g.div.1Mb.2)
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
rep_4.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_4/rep_4.pi.1Mb.bedgraph", header = T)
rep_4.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_4/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_4.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_4.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

cor.test(~diversity+theta, data = sim.lands.200kb, method = "spearman") 
cor.test(~diversity+tmrca, data = sim.lands.200kb, method = "spearman") 
cor.test(~diversity+rho, data = sim.lands.200kb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep4 <- sim.lands.1Mb
sim.lands.1Mb.rep4$Replicate <- 4

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 4] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.4)

vif(g.div.1Mb.4)
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
rep_5.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_5/rep_5.pi.1Mb.bedgraph", header = T)
rep_5.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_5/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_5.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_5.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep5 <- sim.lands.1Mb
sim.lands.1Mb.rep5$Replicate <- 5

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 5] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.1)

vif(g.div.1Mb.1)
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
rep_6.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_6/rep_6.pi.1Mb.bedgraph", header = T)
rep_6.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_6/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_6.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_6.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep6 <- sim.lands.1Mb
sim.lands.1Mb.rep6$Replicate <- 6

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 6] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.1)

vif(g.div.1Mb.1)
```

### Replicate 7

```{r, message=FALSE, warning=FALSE}
rep_7.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_7/rep_7.pi.1Mb.bedgraph", header = T)
rep_7.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_7/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_7.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_7.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep7 <- sim.lands.1Mb
sim.lands.1Mb.rep7$Replicate <- 7

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 7] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.4)

vif(g.div.1Mb.4)
```

### Replicate 8

```{r, message=FALSE, warning=FALSE}
rep_8.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_8/rep_8.pi.1Mb.bedgraph", header = T)
rep_8.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_8/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_8.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_8.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep8 <- sim.lands.1Mb
sim.lands.1Mb.rep8$Replicate <- 8

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 8] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.2)

vif(g.div.1Mb.2)
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
rep_9.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_9/rep_9.pi.1Mb.bedgraph", header = T)
rep_9.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_9/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_9.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_9.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep9 <- sim.lands.1Mb
sim.lands.1Mb.rep9$Replicate <- 9

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 9] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.2)

vif(g.div.1Mb.2)
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
rep_10.pi.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_10/rep_10.pi.1Mb.bedgraph", header = T)
rep_10.tmrca.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims_2/rep_10/sim.tmrca.1M.map", header = T)

sim.lands.1Mb <- as.data.frame(cbind(rep_10.pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_10.tmrca.1Mb$tmrca))
names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")

cor.test(~theta+tmrca, data = sim.lands.1Mb, method = "spearman") 
cor.test(~theta+rho, data = sim.lands.1Mb, method = "spearman") 
cor.test(~rho+tmrca, data = sim.lands.1Mb, method = "spearman") 

# standardizing
sim.lands.1Mb$thetaS <- (sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)) / sd(sim.lands.1Mb$theta)
sim.lands.1Mb$tmrcaS <- (sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)) / sd(sim.lands.1Mb$tmrca)
sim.lands.1Mb$rhoS <- (sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)) / sd(sim.lands.1Mb$rho)

sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)

sim.lands.1Mb.rep50 <- sim.lands.1Mb
sim.lands.1Mb.rep50$Replicate <- 10

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = sim.lands.1Mb)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.sim.1Mb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.sim.1Mb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.sim.1Mb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.sim.1Mb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.sim.1Mb[5, 10] <- anova.diversity$VarExp[4] * 100


r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                  data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")

g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~theta), method = "ML")

g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS,
                    data = sim.lands.1Mb, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.1Mb.1)

vif(g.div.1Mb.1)
```

### all replicates:

```{r, message=FALSE, warning=FALSE}
sim.lands.1Mb.all <- rbind(sim.lands.1Mb.rep5, sim.lands.1Mb.rep2, sim.lands.1Mb.rep3, sim.lands.1Mb.rep4, sim.lands.1Mb.rep5, sim.lands.1Mb.rep6, sim.lands.1Mb.rep7, sim.lands.1Mb.rep8, sim.lands.1Mb.rep9, sim.lands.1Mb.rep50)

m.div.1Mb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS)*as.factor(Replicate), data = sim.lands.1Mb.all)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

m.div.1Mb.2 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS)*as.factor(Replicate), data = sim.lands.1Mb.all)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS + rhoS:tmrcaS)*as.factor(Replicate), data = sim.lands.1Mb.all)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)
summary(m.div.1Mb)
```

# Drosophila-like neutral simulations of chr 2L (Inferred Landscapes)

First batch of 10 replicate datasets simulated using parameters as inferred from real
Drosophila data.

Here we present results using genomic landscapes are inferred by iSMC

## 50 kb scale

```{r, message=FALSE, warning=FALSE}
r2.inf.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.inf.50kb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.inf.50kb) <- reps

# sim landscapes
sim.rho.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims/dm.sim.rho.50000.txt")
sim.theta.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims/dm.sim.theta.50000.txt")
sim.lands.50kb <- as.data.frame(cbind(sim.theta.50kb$sim, sim.rho.50kb$sim))
names(sim.lands.50kb ) <- c("theta", "rho")
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_1/rs.pair_1.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)
  
inf.lands.50kb.rep_1 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_1) <- c("diversity", "theta", "rho", "tmrca")

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")

# standardizing
inf.lands.50kb.rep_1$thetaS <- (inf.lands.50kb.rep_1$theta - mean(inf.lands.50kb.rep_1$theta)) /  sd(inf.lands.50kb.rep_1$theta)
inf.lands.50kb.rep_1$tmrcaS <- (inf.lands.50kb.rep_1$tmrca - mean(inf.lands.50kb.rep_1$tmrca)) / sd(inf.lands.50kb.rep_1$tmrca)
inf.lands.50kb.rep_1$rhoS <- (inf.lands.50kb.rep_1$rho - mean(inf.lands.50kb.rep_1$rho)) / sd(inf.lands.50kb.rep_1$rho)
  
inf.lands.50kb.rep_1$bin <- 1:nrow(inf.lands.50kb.rep_1)
inf.lands.50kb.rep_1$Replicate <- 1

m.diversity.rep_1 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_1)

plot(resid(m.diversity.rep_1)~fitted(m.diversity.rep_1))
dwtest(m.diversity.rep_1)
hmctest(m.diversity.rep_1)
hist(resid(m.diversity.rep_1))
  
summary(m.diversity.rep_1) 
vif(m.diversity.rep_1)

interact_plot(m.diversity.rep_1, pred = thetaS, modx= tmrcaS)

g.rep_1 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_1)
vif(g.rep_1)

g.rep_1.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_1.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_1)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 1] <- anova.diversity$VarExp[4] * 100
```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_2/rs.pair_2.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_2 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_2) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_2$thetaS <- (inf.lands.50kb.rep_2$theta - mean(inf.lands.50kb.rep_2$theta)) / sd(inf.lands.50kb.rep_2$theta)
inf.lands.50kb.rep_2$tmrcaS <- (inf.lands.50kb.rep_2$tmrca - mean(inf.lands.50kb.rep_2$tmrca)) / sd(inf.lands.50kb.rep_2$tmrca)
inf.lands.50kb.rep_2$rhoS <- (inf.lands.50kb.rep_2$rho - mean(inf.lands.50kb.rep_2$rho)) / sd(inf.lands.50kb.rep_2$rho)
  
inf.lands.50kb.rep_2$bin <- 1:nrow(inf.lands.50kb.rep_2)

inf.lands.50kb.rep_2$Replicate <- 2

m.diversity.rep_2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_2)

plot(resid(m.diversity.rep_2)~fitted(m.diversity.rep_2))
dwtest(m.diversity.rep_2)
hmctest(m.diversity.rep_2)
hist(resid(m.diversity.rep_2))
  
summary(m.diversity.rep_2) 
vif(m.diversity.rep_2)

interact_plot(m.diversity.rep_2, pred = thetaS, modx= tmrcaS)

g.rep_2 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_2, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_2)
vif(g.rep_2)

g.rep_2.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_2, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_2.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_2)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 2] <- anova.diversity$VarExp[4] * 100
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_3/rs.pair_3.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_3 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_3) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_3$thetaS <- (inf.lands.50kb.rep_3$theta - mean(inf.lands.50kb.rep_3$theta)) / sd(inf.lands.50kb.rep_3$theta)
inf.lands.50kb.rep_3$tmrcaS <- (inf.lands.50kb.rep_3$tmrca - mean(inf.lands.50kb.rep_3$tmrca)) / sd(inf.lands.50kb.rep_3$tmrca)
inf.lands.50kb.rep_3$rhoS <- (inf.lands.50kb.rep_3$rho - mean(inf.lands.50kb.rep_3$rho)) / sd(inf.lands.50kb.rep_3$rho)
  
inf.lands.50kb.rep_3$bin <- 1:nrow(inf.lands.50kb.rep_3)

inf.lands.50kb.rep_3$Replicate <- 3

m.diversity.rep_3 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_3)

plot(resid(m.diversity.rep_3)~fitted(m.diversity.rep_3))
dwtest(m.diversity.rep_3)
hmctest(m.diversity.rep_3)
hist(resid(m.diversity.rep_3))
  
summary(m.diversity.rep_3) 
vif(m.diversity.rep_3)

interact_plot(m.diversity.rep_3, pred = thetaS, modx= tmrcaS)

g.rep_3 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_3, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_3)
vif(g.rep_3)

g.rep_3.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_3, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_3.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_3)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 3] <- anova.diversity$VarExp[4] * 100
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_4/rs.pair_4.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_4 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_4) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_4$thetaS <- (inf.lands.50kb.rep_4$theta - mean(inf.lands.50kb.rep_4$theta)) / sd(inf.lands.50kb.rep_4$theta)
inf.lands.50kb.rep_4$tmrcaS <- (inf.lands.50kb.rep_4$tmrca - mean(inf.lands.50kb.rep_4$tmrca)) / sd(inf.lands.50kb.rep_4$tmrca)
inf.lands.50kb.rep_4$rhoS <- (inf.lands.50kb.rep_4$rho - mean(inf.lands.50kb.rep_4$rho)) / sd(inf.lands.50kb.rep_4$rho)
  
inf.lands.50kb.rep_4$bin <- 1:nrow(inf.lands.50kb.rep_4)

inf.lands.50kb.rep_4$Replicate <- 4

m.diversity.rep_4 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_4)

plot(resid(m.diversity.rep_4)~fitted(m.diversity.rep_4))
dwtest(m.diversity.rep_4)
hmctest(m.diversity.rep_4)
hist(resid(m.diversity.rep_4))
  
summary(m.diversity.rep_4) 
vif(m.diversity.rep_4)

interact_plot(m.diversity.rep_4, pred = thetaS, modx= tmrcaS)

g.rep_4 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_4, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_4)
vif(g.rep_4)

g.rep_4.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_4, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_4.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_4)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 4] <- anova.diversity$VarExp[4] * 100
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_5/rs.pair_5.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_5 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_5) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_5$thetaS <- (inf.lands.50kb.rep_5$theta - mean(inf.lands.50kb.rep_5$theta)) / sd(inf.lands.50kb.rep_5$theta)
inf.lands.50kb.rep_5$tmrcaS <- (inf.lands.50kb.rep_5$tmrca - mean(inf.lands.50kb.rep_5$tmrca)) / sd(inf.lands.50kb.rep_5$tmrca)
inf.lands.50kb.rep_5$rhoS <- (inf.lands.50kb.rep_5$rho - mean(inf.lands.50kb.rep_5$rho)) / sd(inf.lands.50kb.rep_5$rho)
  
inf.lands.50kb.rep_5$bin <- 1:nrow(inf.lands.50kb.rep_5)

inf.lands.50kb.rep_5$Replicate <- 5

m.diversity.rep_5 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_5)

plot(resid(m.diversity.rep_5)~fitted(m.diversity.rep_5))
dwtest(m.diversity.rep_5)
hmctest(m.diversity.rep_5)
hist(resid(m.diversity.rep_5))
  
summary(m.diversity.rep_5) 
vif(m.diversity.rep_5)

interact_plot(m.diversity.rep_5, pred = thetaS, modx= tmrcaS)

g.rep_5 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_5, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_5)
vif(g.rep_5)

g.rep_5.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_5, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_5.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_5)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 5] <- anova.diversity$VarExp[4] * 100
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_6/rs.pair_6.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_6 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_6) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_6$thetaS <- (inf.lands.50kb.rep_6$theta - mean(inf.lands.50kb.rep_6$theta)) / sd(inf.lands.50kb.rep_6$theta)
inf.lands.50kb.rep_6$tmrcaS <- (inf.lands.50kb.rep_6$tmrca - mean(inf.lands.50kb.rep_6$tmrca)) / sd(inf.lands.50kb.rep_6$tmrca)
inf.lands.50kb.rep_6$rhoS <- (inf.lands.50kb.rep_6$rho - mean(inf.lands.50kb.rep_6$rho)) / sd(inf.lands.50kb.rep_6$rho)
  
inf.lands.50kb.rep_6$bin <- 1:nrow(inf.lands.50kb.rep_6)

inf.lands.50kb.rep_6$Replicate <- 6

m.diversity.rep_6 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_6)

plot(resid(m.diversity.rep_6)~fitted(m.diversity.rep_6))
dwtest(m.diversity.rep_6)
hmctest(m.diversity.rep_6)
hist(resid(m.diversity.rep_6))
  
summary(m.diversity.rep_6) 
vif(m.diversity.rep_6)

interact_plot(m.diversity.rep_6, pred = thetaS, modx= tmrcaS)

g.rep_6 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_6, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_6)
vif(g.rep_6)

g.rep_6.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_6, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_6.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_6)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 6] <- anova.diversity$VarExp[4] * 100
```

### Replicate 7

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_7/rs.pair_7.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_7 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_7) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_7$thetaS <- (inf.lands.50kb.rep_7$theta - mean(inf.lands.50kb.rep_7$theta)) / sd(inf.lands.50kb.rep_7$theta)
inf.lands.50kb.rep_7$tmrcaS <- (inf.lands.50kb.rep_7$tmrca - mean(inf.lands.50kb.rep_7$tmrca)) / sd(inf.lands.50kb.rep_7$tmrca)
inf.lands.50kb.rep_7$rhoS <- (inf.lands.50kb.rep_7$rho - mean(inf.lands.50kb.rep_7$rho)) / sd(inf.lands.50kb.rep_7$rho)
  
inf.lands.50kb.rep_7$bin <- 1:nrow(inf.lands.50kb.rep_7)

inf.lands.50kb.rep_7$Replicate <- 7

m.diversity.rep_7 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_7)

plot(resid(m.diversity.rep_7)~fitted(m.diversity.rep_7))
dwtest(m.diversity.rep_7)
hmctest(m.diversity.rep_7)
hist(resid(m.diversity.rep_7))
  
summary(m.diversity.rep_7) 
vif(m.diversity.rep_7)

interact_plot(m.diversity.rep_7, pred = thetaS, modx= tmrcaS)

g.rep_7 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_7, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_7)
vif(g.rep_7)

g.rep_7.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_7, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_7.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_7)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 7] <- anova.diversity$VarExp[4] * 100
```

### Replicate 8

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_8/rs.pair_8.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_8 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_8) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_8$thetaS <- (inf.lands.50kb.rep_8$theta - mean(inf.lands.50kb.rep_8$theta)) / sd(inf.lands.50kb.rep_8$theta)
inf.lands.50kb.rep_8$tmrcaS <- (inf.lands.50kb.rep_8$tmrca - mean(inf.lands.50kb.rep_8$tmrca)) / sd(inf.lands.50kb.rep_8$tmrca)
inf.lands.50kb.rep_8$rhoS <- (inf.lands.50kb.rep_8$rho - mean(inf.lands.50kb.rep_8$rho)) / sd(inf.lands.50kb.rep_8$rho)
  
inf.lands.50kb.rep_8$bin <- 1:nrow(inf.lands.50kb.rep_8)

inf.lands.50kb.rep_8$Replicate <- 8

m.diversity.rep_8 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_8)

plot(resid(m.diversity.rep_8)~fitted(m.diversity.rep_8))
dwtest(m.diversity.rep_8)
hmctest(m.diversity.rep_8)
hist(resid(m.diversity.rep_8))
  
summary(m.diversity.rep_8) 
vif(m.diversity.rep_8)

interact_plot(m.diversity.rep_8, pred = thetaS, modx= tmrcaS)

g.rep_8 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_8, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_8)
vif(g.rep_8)

g.rep_8.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_8, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_8.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_8)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 8] <- anova.diversity$VarExp[4] * 100
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_9/rs.pair_9.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_9 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_9) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_9$thetaS <- (inf.lands.50kb.rep_9$theta - mean(inf.lands.50kb.rep_9$theta)) / sd(inf.lands.50kb.rep_9$theta)
inf.lands.50kb.rep_9$tmrcaS <- (inf.lands.50kb.rep_9$tmrca - mean(inf.lands.50kb.rep_9$tmrca)) / sd(inf.lands.50kb.rep_9$tmrca)
inf.lands.50kb.rep_9$rhoS <- (inf.lands.50kb.rep_9$rho - mean(inf.lands.50kb.rep_9$rho)) / sd(inf.lands.50kb.rep_9$rho)
  
inf.lands.50kb.rep_9$bin <- 1:nrow(inf.lands.50kb.rep_9)

inf.lands.50kb.rep_9$Replicate <- 9

m.diversity.rep_9 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_9)

plot(resid(m.diversity.rep_9)~fitted(m.diversity.rep_9))
dwtest(m.diversity.rep_9)
hmctest(m.diversity.rep_9)
hist(resid(m.diversity.rep_9))
  
summary(m.diversity.rep_9) 
vif(m.diversity.rep_9)

interact_plot(m.diversity.rep_9, pred = thetaS, modx= tmrcaS)

g.rep_9 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_9, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_9)
vif(g.rep_9)

g.rep_9.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_9, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_9.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_9)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 9] <- anova.diversity$VarExp[4] * 100
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_10/rs.pair_10.", sep = "")
pi.50kb <- read.table(paste(p, "diversity.50kb.bedgraph", sep = ""), header = T)
pi.50kb$avg <- apply(pi.50kb[4:ncol(pi.50kb)], 1, mean)
tmrca.50kb <- read.table(paste(p, "TMRCA.50kb.bedgraph", sep = ""), header = T)
tmrca.50kb$avg <- apply(tmrca.50kb[4:ncol(tmrca.50kb)], 1, mean)
rho.50kb <- read.table(paste(p, "rho.50kb.bedgraph", sep = ""), header = T)
theta.50kb <- read.table(paste(p, "theta.50kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.50kb$sim, theta.50kb$sample_mean, method = "spearman")
  
inf.lands.50kb.rep_10 <- as.data.frame(cbind(pi.50kb$avg, theta.50kb$sample_mean, rho.50kb$sample_mean, tmrca.50kb$avg))
names(inf.lands.50kb.rep_10) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.50kb.rep_10$thetaS <- (inf.lands.50kb.rep_10$theta - mean(inf.lands.50kb.rep_10$theta)) / sd(inf.lands.50kb.rep_10$theta)
inf.lands.50kb.rep_10$tmrcaS <- (inf.lands.50kb.rep_10$tmrca - mean(inf.lands.50kb.rep_10$tmrca)) / sd(inf.lands.50kb.rep_10$tmrca)
inf.lands.50kb.rep_10$rhoS <- (inf.lands.50kb.rep_10$rho - mean(inf.lands.50kb.rep_10$rho)) / sd(inf.lands.50kb.rep_10$rho)
  
inf.lands.50kb.rep_10$bin <- 1:nrow(inf.lands.50kb.rep_10)

inf.lands.50kb.rep_10$Replicate <- 10

m.diversity.rep_10 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.50kb.rep_10)

plot(resid(m.diversity.rep_10)~fitted(m.diversity.rep_10))
dwtest(m.diversity.rep_10)
hmctest(m.diversity.rep_10)
hist(resid(m.diversity.rep_10))
  
summary(m.diversity.rep_10) 
vif(m.diversity.rep_10)

interact_plot(m.diversity.rep_10, pred = thetaS, modx= tmrcaS)

g.rep_10 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.50kb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_10)
vif(g.rep_10)

g.rep_10.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.50kb.rep_10, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_10.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_10)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.50kb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.50kb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.inf.50kb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.inf.50kb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.inf.50kb[5, 10] <- anova.diversity$VarExp[4] * 100


r2.inf.50kb$average <- rowMeans(r2.inf.50kb)
r2.inf.50kb <- transform(r2.inf.50kb, sd=apply(r2.inf.50kb, 1, sd, na.rm = TRUE))
```


### all replicates:

```{r, message=FALSE, warning=FALSE}
inf.lands.50kb.all <- rbind(inf.lands.50kb.rep_1, inf.lands.50kb.rep_2, inf.lands.50kb.rep_3, inf.lands.50kb.rep_4, inf.lands.50kb.rep_5, inf.lands.50kb.rep_6, inf.lands.50kb.rep_7, inf.lands.50kb.rep_8, inf.lands.50kb.rep_9, inf.lands.50kb.rep_10)

m.div.50kb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS)*as.factor(Replicate), data = inf.lands.50kb.all)
plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

m.div.50kb.2 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS)*as.factor(Replicate), data = inf.lands.50kb.all)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS + rhoS:tmrcaS)*as.factor(Replicate), data = inf.lands.50kb.all)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)
summary(m.div.50kb)
```

### Plots

```{r, message=FALSE, warning=FALSE}

scale.3d <- function(x) sprintf("%.3f", x)

rho.plot <- as.data.frame(cbind(inf.lands.50kb.rep_1$bin,
                                sim.rho.50kb$sim, 
                                inf.lands.50kb.rep_1$rho,
                                inf.lands.50kb.rep_2$rho,
                                inf.lands.50kb.rep_3$rho,
                                inf.lands.50kb.rep_4$rho,
                                inf.lands.50kb.rep_5$rho,
                                inf.lands.50kb.rep_6$rho,
                                inf.lands.50kb.rep_7$rho,
                                inf.lands.50kb.rep_8$rho,
                                inf.lands.50kb.rep_9$rho,
                                inf.lands.50kb.rep_10$rho))

rho.plot[,3:ncol(rho.plot)] <- 1.53 * rho.plot[,3:ncol(rho.plot)] # scaling because of SCRM N0 vs Ne

names(rho.plot) <- c("bin", "sim", reps)
molten.rho <- melt(rho.plot, id.vars = "bin")
rho.map.50kb <- ggplot(data = molten.rho, aes(x = bin * 50, y = value, colour = variable)) + theme_bw()
rho.map.50kb <- rho.map.50kb + geom_line(data = molten.rho, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
rho.map.50kb <- rho.map.50kb + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Blues"), "cyan"))
rho.map.50kb <- rho.map.50kb + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
rho.map.50kb <- rho.map.50kb + labs(title = NULL, x = NULL, y = expression(rho))
rho.map.50kb <- rho.map.50kb + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)

theta.plot <- as.data.frame(cbind(inf.lands.50kb.rep_1$bin,
                                sim.theta.50kb$sim, 
                                inf.lands.50kb.rep_1$theta,
                                inf.lands.50kb.rep_2$theta,
                                inf.lands.50kb.rep_3$theta,
                                inf.lands.50kb.rep_4$theta,
                                inf.lands.50kb.rep_5$theta,
                                inf.lands.50kb.rep_6$theta,
                                inf.lands.50kb.rep_7$theta,
                                inf.lands.50kb.rep_8$theta,
                                inf.lands.50kb.rep_9$theta,
                                inf.lands.50kb.rep_10$theta))

names(theta.plot) <- c("bin", "sim", reps)
molten.theta <- melt(theta.plot, id.vars = "bin")
theta.map.50kb <- ggplot(data = molten.theta, aes(x = bin * 50, y = value, colour = variable)) + theme_bw()
theta.map.50kb <- theta.map.50kb + geom_line(data = molten.theta, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
theta.map.50kb <- theta.map.50kb + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Reds"), "orange"))
theta.map.50kb <- theta.map.50kb + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
theta.map.50kb <- theta.map.50kb + labs(title = NULL, x = NULL, y = "50 kb")
theta.map.50kb <- theta.map.50kb + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)

plot_grid(rho.map.50kb, theta.map.50kb, nrow = 2, ncol = 1)
```


## 200 kb scale

```{r, message=FALSE, warning=FALSE}
r2.inf.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.inf.200kb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.inf.200kb) <- reps

# sim landscapes
sim.rho.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims/dm.sim.rho.2e+05.txt")
sim.theta.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims/dm.sim.theta.2e+05.txt")
sim.lands.200kb  <- as.data.frame(cbind(sim.theta.200kb$sim, sim.rho.200kb$sim))
names(sim.lands.200kb ) <- c("theta", "rho")
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_1/rs.pair_1.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_1 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_1) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_1$thetaS <- (inf.lands.200kb.rep_1$theta - mean(inf.lands.200kb.rep_1$theta)) / sd(inf.lands.200kb.rep_1$theta)
inf.lands.200kb.rep_1$tmrcaS <- (inf.lands.200kb.rep_1$tmrca - mean(inf.lands.200kb.rep_1$tmrca)) / sd(inf.lands.200kb.rep_1$tmrca)
inf.lands.200kb.rep_1$rhoS <- (inf.lands.200kb.rep_1$rho - mean(inf.lands.200kb.rep_1$rho)) / sd(inf.lands.200kb.rep_1$rho)
  
inf.lands.200kb.rep_1$bin <- 1:nrow(inf.lands.200kb.rep_1)

inf.lands.200kb.rep_1$Replicate <- 1

m.diversity.rep_1 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_1)

plot(resid(m.diversity.rep_1)~fitted(m.diversity.rep_1))
dwtest(m.diversity.rep_1)
hmctest(m.diversity.rep_1)
hist(resid(m.diversity.rep_1))
  
summary(m.diversity.rep_1) 
vif(m.diversity.rep_1)

interact_plot(m.diversity.rep_1, pred = thetaS, modx= tmrcaS)

g.rep_1 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_1)
vif(g.rep_1)

g.rep_1.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_1.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_1)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 1] <- anova.diversity$VarExp[4] * 100
```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_2/rs.pair_2.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_2 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_2) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_2$thetaS <- (inf.lands.200kb.rep_2$theta - mean(inf.lands.200kb.rep_2$theta)) / sd(inf.lands.200kb.rep_2$theta)
inf.lands.200kb.rep_2$tmrcaS <- (inf.lands.200kb.rep_2$tmrca - mean(inf.lands.200kb.rep_2$tmrca)) / sd(inf.lands.200kb.rep_2$tmrca)
inf.lands.200kb.rep_2$rhoS <- (inf.lands.200kb.rep_2$rho - mean(inf.lands.200kb.rep_2$rho)) / sd(inf.lands.200kb.rep_2$rho)
  
inf.lands.200kb.rep_2$bin <- 1:nrow(inf.lands.200kb.rep_2)

inf.lands.200kb.rep_2$Replicate <- 2

m.diversity.rep_2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_2)

plot(resid(m.diversity.rep_2)~fitted(m.diversity.rep_2))
dwtest(m.diversity.rep_2)
hmctest(m.diversity.rep_2)
hist(resid(m.diversity.rep_2))
  
summary(m.diversity.rep_2) 
vif(m.diversity.rep_2)

interact_plot(m.diversity.rep_2, pred = thetaS, modx= tmrcaS)

g.rep_2 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_2, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_2)

vif(g.rep_2)

g.rep_2.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_2, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_2.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_2)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 2] <- anova.diversity$VarExp[4] * 100
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_3/rs.pair_3.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_3 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_3) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_3$thetaS <- (inf.lands.200kb.rep_3$theta - mean(inf.lands.200kb.rep_3$theta)) / sd(inf.lands.200kb.rep_3$theta)
inf.lands.200kb.rep_3$tmrcaS <- (inf.lands.200kb.rep_3$tmrca - mean(inf.lands.200kb.rep_3$tmrca)) / sd(inf.lands.200kb.rep_3$tmrca)
inf.lands.200kb.rep_3$rhoS <- (inf.lands.200kb.rep_3$rho - mean(inf.lands.200kb.rep_3$rho)) / sd(inf.lands.200kb.rep_3$rho)
  
inf.lands.200kb.rep_3$bin <- 1:nrow(inf.lands.200kb.rep_3)

inf.lands.200kb.rep_3$Replicate <- 3

m.diversity.rep_3 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_3)

plot(resid(m.diversity.rep_3)~fitted(m.diversity.rep_3))
dwtest(m.diversity.rep_3)
hmctest(m.diversity.rep_3)
hist(resid(m.diversity.rep_3))
  
summary(m.diversity.rep_3) 
vif(m.diversity.rep_3)

interact_plot(m.diversity.rep_3, pred = thetaS, modx= tmrcaS)

g.rep_3 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_3, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_3)
vif(g.rep_3)

g.rep_3.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_3, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_3.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_3)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 3] <- anova.diversity$VarExp[4] * 100
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_4/rs.pair_4.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_4 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_4) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_4$thetaS <- (inf.lands.200kb.rep_4$theta - mean(inf.lands.200kb.rep_4$theta)) / sd(inf.lands.200kb.rep_4$theta)
inf.lands.200kb.rep_4$tmrcaS <- (inf.lands.200kb.rep_4$tmrca - mean(inf.lands.200kb.rep_4$tmrca)) / sd(inf.lands.200kb.rep_4$tmrca)
inf.lands.200kb.rep_4$rhoS <- (inf.lands.200kb.rep_4$rho - mean(inf.lands.200kb.rep_4$rho)) / sd(inf.lands.200kb.rep_4$rho)
  
inf.lands.200kb.rep_4$bin <- 1:nrow(inf.lands.200kb.rep_4)

inf.lands.200kb.rep_4$Replicate <- 4

m.diversity.rep_4 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_4)

plot(resid(m.diversity.rep_4)~fitted(m.diversity.rep_4))
dwtest(m.diversity.rep_4)
hmctest(m.diversity.rep_4)
hist(resid(m.diversity.rep_4))
  
summary(m.diversity.rep_4) 
vif(m.diversity.rep_4)

interact_plot(m.diversity.rep_4, pred = thetaS, modx= tmrcaS)

g.rep_4 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_4, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_4)
vif(g.rep_4)

g.rep_4.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_4, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_4.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_4)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 4] <- anova.diversity$VarExp[4] * 100
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_5/rs.pair_5.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_5 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_5) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_5$thetaS <- (inf.lands.200kb.rep_5$theta - mean(inf.lands.200kb.rep_5$theta)) / sd(inf.lands.200kb.rep_5$theta)
inf.lands.200kb.rep_5$tmrcaS <- (inf.lands.200kb.rep_5$tmrca - mean(inf.lands.200kb.rep_5$tmrca)) / sd(inf.lands.200kb.rep_5$tmrca)
inf.lands.200kb.rep_5$rhoS <- (inf.lands.200kb.rep_5$rho - mean(inf.lands.200kb.rep_5$rho)) / sd(inf.lands.200kb.rep_5$rho)
  
inf.lands.200kb.rep_5$bin <- 1:nrow(inf.lands.200kb.rep_5)

inf.lands.200kb.rep_5$Replicate <- 5

m.diversity.rep_5 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_5)

plot(resid(m.diversity.rep_5)~fitted(m.diversity.rep_5))
dwtest(m.diversity.rep_5)
hmctest(m.diversity.rep_5)
hist(resid(m.diversity.rep_5))
  
summary(m.diversity.rep_5) 
vif(m.diversity.rep_5)

interact_plot(m.diversity.rep_5, pred = thetaS, modx= tmrcaS)

g.rep_5 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_5, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_5)
vif(g.rep_5)

g.rep_5.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_5, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_5.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_5)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 5] <- anova.diversity$VarExp[4] * 100
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_6/rs.pair_6.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_6 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_6) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_6$thetaS <- (inf.lands.200kb.rep_6$theta - mean(inf.lands.200kb.rep_6$theta)) / sd(inf.lands.200kb.rep_6$theta)
inf.lands.200kb.rep_6$tmrcaS <- (inf.lands.200kb.rep_6$tmrca - mean(inf.lands.200kb.rep_6$tmrca)) / sd(inf.lands.200kb.rep_6$tmrca)
inf.lands.200kb.rep_6$rhoS <- (inf.lands.200kb.rep_6$rho - mean(inf.lands.200kb.rep_6$rho)) / sd(inf.lands.200kb.rep_6$rho)
  
inf.lands.200kb.rep_6$bin <- 1:nrow(inf.lands.200kb.rep_6)

inf.lands.200kb.rep_6$Replicate <- 6

m.diversity.rep_6 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_6)

plot(resid(m.diversity.rep_6)~fitted(m.diversity.rep_6))
dwtest(m.diversity.rep_6)
hmctest(m.diversity.rep_6)
hist(resid(m.diversity.rep_6))
  
summary(m.diversity.rep_6) 
vif(m.diversity.rep_6)

interact_plot(m.diversity.rep_6, pred = thetaS, modx= tmrcaS)

g.rep_6 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_6, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_6)
vif(g.rep_6)

g.rep_6.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_6, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_6.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_6)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 6] <- anova.diversity$VarExp[4] * 100
```

### Replicate 7

```{r}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_7/rs.pair_7.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_7 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_7) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_7$thetaS <- (inf.lands.200kb.rep_7$theta - mean(inf.lands.200kb.rep_7$theta)) / sd(inf.lands.200kb.rep_7$theta)
inf.lands.200kb.rep_7$tmrcaS <- (inf.lands.200kb.rep_7$tmrca - mean(inf.lands.200kb.rep_7$tmrca)) / sd(inf.lands.200kb.rep_7$tmrca)
inf.lands.200kb.rep_7$rhoS <- (inf.lands.200kb.rep_7$rho - mean(inf.lands.200kb.rep_7$rho)) / sd(inf.lands.200kb.rep_7$rho)
  
inf.lands.200kb.rep_7$bin <- 1:nrow(inf.lands.200kb.rep_7)

inf.lands.200kb.rep_7$Replicate <- 7

m.diversity.rep_7 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_7)

plot(resid(m.diversity.rep_7)~fitted(m.diversity.rep_7))
dwtest(m.diversity.rep_7)
hmctest(m.diversity.rep_7)
hist(resid(m.diversity.rep_7))
  
summary(m.diversity.rep_7) 
vif(m.diversity.rep_7)

interact_plot(m.diversity.rep_7, pred = thetaS, modx= tmrcaS)

g.rep_7 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_7, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_7)
vif(g.rep_7)

g.rep_7.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_7, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_7.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_7)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 7] <- anova.diversity$VarExp[4] * 100
```

### Replicate 8

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_8/rs.pair_8.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_8 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_8) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_8$thetaS <- (inf.lands.200kb.rep_8$theta - mean(inf.lands.200kb.rep_8$theta)) / sd(inf.lands.200kb.rep_8$theta)
inf.lands.200kb.rep_8$tmrcaS <- (inf.lands.200kb.rep_8$tmrca - mean(inf.lands.200kb.rep_8$tmrca)) / sd(inf.lands.200kb.rep_8$tmrca)
inf.lands.200kb.rep_8$rhoS <- (inf.lands.200kb.rep_8$rho - mean(inf.lands.200kb.rep_8$rho)) / sd(inf.lands.200kb.rep_8$rho)
  
inf.lands.200kb.rep_8$bin <- 1:nrow(inf.lands.200kb.rep_8)

inf.lands.200kb.rep_8$Replicate <- 8

m.diversity.rep_8 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_8)

plot(resid(m.diversity.rep_8)~fitted(m.diversity.rep_8))
dwtest(m.diversity.rep_8)
hmctest(m.diversity.rep_8)
hist(resid(m.diversity.rep_8))
  
summary(m.diversity.rep_8) 
vif(m.diversity.rep_8)

interact_plot(m.diversity.rep_8, pred = thetaS, modx= tmrcaS)

g.rep_8 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_8, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_8)
vif(g.rep_8)

g.rep_8.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_8, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_8.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_8)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 8] <- anova.diversity$VarExp[4] * 100
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_9/rs.pair_9.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_9 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_9) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_9$thetaS <- (inf.lands.200kb.rep_9$theta - mean(inf.lands.200kb.rep_9$theta)) / sd(inf.lands.200kb.rep_9$theta)
inf.lands.200kb.rep_9$tmrcaS <- (inf.lands.200kb.rep_9$tmrca - mean(inf.lands.200kb.rep_9$tmrca)) / sd(inf.lands.200kb.rep_9$tmrca)
inf.lands.200kb.rep_9$rhoS <- (inf.lands.200kb.rep_9$rho - mean(inf.lands.200kb.rep_9$rho)) / sd(inf.lands.200kb.rep_9$rho)
  
inf.lands.200kb.rep_9$bin <- 1:nrow(inf.lands.200kb.rep_9)

inf.lands.200kb.rep_9$Replicate <- 9

m.diversity.rep_9 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_9)

plot(resid(m.diversity.rep_9)~fitted(m.diversity.rep_9))
dwtest(m.diversity.rep_9)
hmctest(m.diversity.rep_9)
hist(resid(m.diversity.rep_9))
  
summary(m.diversity.rep_9) 
vif(m.diversity.rep_9)

interact_plot(m.diversity.rep_9, pred = thetaS, modx= tmrcaS)

g.rep_9 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_9, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_9)
vif(g.rep_9)

g.rep_9.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_9, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_9.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_9)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 9] <- anova.diversity$VarExp[4] * 100
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_10/rs.pair_10.", sep = "")
pi.200kb <- read.table(paste(p, "diversity.200kb.bedgraph", sep = ""), header = T)
pi.200kb$avg <- apply(pi.200kb[4:ncol(pi.200kb)], 1, mean)
tmrca.200kb <- read.table(paste(p, "TMRCA.200kb.bedgraph", sep = ""), header = T)
tmrca.200kb$avg <- apply(tmrca.200kb[4:ncol(tmrca.200kb)], 1, mean)
rho.200kb <- read.table(paste(p, "rho.200kb.bedgraph", sep = ""), header = T)
theta.200kb <- read.table(paste(p, "theta.200kb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.200kb$sim, theta.200kb$sample_mean, method = "spearman")
  
inf.lands.200kb.rep_10 <- as.data.frame(cbind(pi.200kb$avg, theta.200kb$sample_mean, rho.200kb$sample_mean, tmrca.200kb$avg))
names(inf.lands.200kb.rep_10) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.200kb.rep_10$thetaS <- (inf.lands.200kb.rep_10$theta - mean(inf.lands.200kb.rep_10$theta)) / sd(inf.lands.200kb.rep_10$tmrca)
inf.lands.200kb.rep_10$tmrcaS <- (inf.lands.200kb.rep_10$tmrca - mean(inf.lands.200kb.rep_10$tmrca)) / sd(inf.lands.200kb.rep_10$tmrca)
inf.lands.200kb.rep_10$rhoS <- (inf.lands.200kb.rep_10$rho - mean(inf.lands.200kb.rep_10$rho)) / sd(inf.lands.200kb.rep_10$tmrca)
  
inf.lands.200kb.rep_10$bin <- 1:nrow(inf.lands.200kb.rep_10)

inf.lands.200kb.rep_10$Replicate <- 10

m.diversity.rep_10 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.200kb.rep_10)

plot(resid(m.diversity.rep_10)~fitted(m.diversity.rep_10))
dwtest(m.diversity.rep_10)
hmctest(m.diversity.rep_10)
hist(resid(m.diversity.rep_10))
  
summary(m.diversity.rep_10) 
vif(m.diversity.rep_10)

interact_plot(m.diversity.rep_10, pred = thetaS, modx= tmrcaS)

g.rep_10 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.200kb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_10)
vif(g.rep_10)

g.rep_10.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.200kb.rep_10, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_10.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_10)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.200kb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.200kb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.inf.200kb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.inf.200kb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.inf.200kb[5, 10] <- anova.diversity$VarExp[4] * 100

r2.inf.200kb$average <- rowMeans(r2.inf.200kb)
r2.inf.200kb <- transform(r2.inf.200kb, sd=apply(r2.inf.200kb, 1, sd, na.rm = TRUE))
```

### all replicates:

```{r, message=FALSE, warning=FALSE}
inf.lands.200kb.all <- rbind(inf.lands.200kb.rep_1, inf.lands.200kb.rep_2, inf.lands.200kb.rep_3, inf.lands.200kb.rep_4, inf.lands.200kb.rep_5, inf.lands.200kb.rep_6, inf.lands.200kb.rep_7, inf.lands.200kb.rep_8, inf.lands.200kb.rep_9, inf.lands.200kb.rep_10)

m.div.200kb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS)*as.factor(Replicate), data = inf.lands.200kb.all)
plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

m.div.200kb.2 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS)*as.factor(Replicate), data = inf.lands.200kb.all)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS + rhoS:tmrcaS)*as.factor(Replicate), data = inf.lands.200kb.all)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)
summary(m.div.200kb)
```

### Plots

```{r, message=FALSE, warning=FALSE}

scale.3d <- function(x) sprintf("%.3f", x)

rho.plot <- as.data.frame(cbind(inf.lands.200kb.rep_1$bin,
                                sim.rho.200kb$sim, 
                                inf.lands.200kb.rep_1$rho,
                                inf.lands.200kb.rep_2$rho,
                                inf.lands.200kb.rep_3$rho,
                                inf.lands.200kb.rep_4$rho,
                                inf.lands.200kb.rep_5$rho,
                                inf.lands.200kb.rep_6$rho,
                                inf.lands.200kb.rep_7$rho,
                                inf.lands.200kb.rep_8$rho,
                                inf.lands.200kb.rep_9$rho,
                                inf.lands.200kb.rep_10$rho))

rho.plot[,3:ncol(rho.plot)] <- 1.53 * rho.plot[,3:ncol(rho.plot)] # scaling because of SCRM N0 vs Ne

names(rho.plot) <- c("bin", "sim", reps)
molten.rho <- melt(rho.plot, id.vars = "bin")
rho.map.200kb <- ggplot(data = molten.rho, aes(x = bin * 200, y = value, colour = variable)) + theme_bw()
rho.map.200kb <- rho.map.200kb + geom_line(data = molten.rho, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
rho.map.200kb <- rho.map.200kb + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Blues"), "cyan"))
rho.map.200kb <- rho.map.200kb + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
rho.map.200kb <- rho.map.200kb + labs(title = NULL, x = NULL, y = expression(rho))
rho.map.200kb <- rho.map.200kb + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)

theta.plot <- as.data.frame(cbind(inf.lands.200kb.rep_1$bin,
                                sim.theta.200kb$sim, 
                                inf.lands.200kb.rep_1$theta,
                                inf.lands.200kb.rep_2$theta,
                                inf.lands.200kb.rep_3$theta,
                                inf.lands.200kb.rep_4$theta,
                                inf.lands.200kb.rep_5$theta,
                                inf.lands.200kb.rep_6$theta,
                                inf.lands.200kb.rep_7$theta,
                                inf.lands.200kb.rep_8$theta,
                                inf.lands.200kb.rep_9$theta,
                                inf.lands.200kb.rep_10$theta))

names(theta.plot) <- c("bin", "sim", reps)
molten.theta <- melt(theta.plot, id.vars = "bin")
theta.map.200kb <- ggplot(data = molten.theta, aes(x = bin * 200, y = value, colour = variable)) + theme_bw()
theta.map.200kb <- theta.map.200kb + geom_line(data = molten.theta, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
theta.map.200kb <- theta.map.200kb + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Reds"), "orange"))
theta.map.200kb <- theta.map.200kb + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
theta.map.200kb <- theta.map.200kb + labs(title = NULL, x = NULL, y = "200 kb")
theta.map.200kb <- theta.map.200kb + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)

plot_grid(rho.map.200kb, theta.map.200kb, nrow = 2, ncol = 1)
```

## 1 Mb scale 

```{r, message=FALSE, warning=FALSE}
r2.inf.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.inf.1Mb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.inf.1Mb) <- reps

# sim landscapes
sim.rho.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims/dm.sim.rho.1e+06.txt")
sim.theta.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_coal_sims/dm.sim.theta.1e+06.txt")
sim.lands.1Mb <- as.data.frame(cbind(sim.theta.1Mb$sim, sim.rho.1Mb$sim))
names(sim.lands.1Mb) <- c("theta", "rho")
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_1/rs.pair_1.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_1 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_1) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_1$thetaS <- (inf.lands.1Mb.rep_1$theta - mean(inf.lands.1Mb.rep_1$theta)) / sd(inf.lands.1Mb.rep_1$theta)
inf.lands.1Mb.rep_1$tmrcaS <- (inf.lands.1Mb.rep_1$tmrca - mean(inf.lands.1Mb.rep_1$tmrca)) / sd(inf.lands.1Mb.rep_1$tmrca)
inf.lands.1Mb.rep_1$rhoS <- (inf.lands.1Mb.rep_1$rho - mean(inf.lands.1Mb.rep_1$rho)) / sd(inf.lands.1Mb.rep_1$rho)
  
inf.lands.1Mb.rep_1$bin <- 1:nrow(inf.lands.1Mb.rep_1)

inf.lands.1Mb.rep_1$Replicate <- 1

m.diversity.rep_1 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_1)

plot(resid(m.diversity.rep_1)~fitted(m.diversity.rep_1))
dwtest(m.diversity.rep_1)
hmctest(m.diversity.rep_1)
hist(resid(m.diversity.rep_1))
  
summary(m.diversity.rep_1) 
vif(m.diversity.rep_1)

interact_plot(m.diversity.rep_1, pred = thetaS, modx= tmrcaS)

g.rep_1 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_1)
vif(g.rep_1)

g.rep_1.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_1.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_1)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 1] <- anova.diversity$VarExp[4] * 100
```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_2/rs.pair_2.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_2 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_2) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_2$thetaS <- (inf.lands.1Mb.rep_2$theta - mean(inf.lands.1Mb.rep_2$theta)) / sd(inf.lands.1Mb.rep_2$theta)
inf.lands.1Mb.rep_2$tmrcaS <- (inf.lands.1Mb.rep_2$tmrca - mean(inf.lands.1Mb.rep_2$tmrca)) / sd(inf.lands.1Mb.rep_2$tmrca)
inf.lands.1Mb.rep_2$rhoS <- (inf.lands.1Mb.rep_2$rho - mean(inf.lands.1Mb.rep_2$rho)) / sd(inf.lands.1Mb.rep_2$rho)
  
inf.lands.1Mb.rep_2$bin <- 1:nrow(inf.lands.1Mb.rep_2)

inf.lands.1Mb.rep_2$Replicate <- 2

m.diversity.rep_2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_2)

plot(resid(m.diversity.rep_2)~fitted(m.diversity.rep_2))
dwtest(m.diversity.rep_2)
hmctest(m.diversity.rep_2)
hist(resid(m.diversity.rep_2))
  
summary(m.diversity.rep_2) 
vif(m.diversity.rep_2)

interact_plot(m.diversity.rep_2, pred = thetaS, modx= tmrcaS)

g.rep_2 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_2, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_2)
vif(g.rep_2)

g.rep_2.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_2, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_2.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_2)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 2] <- anova.diversity$VarExp[4] * 100
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_3/rs.pair_3.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_3 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_3) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_3$thetaS <- (inf.lands.1Mb.rep_3$theta - mean(inf.lands.1Mb.rep_3$theta)) / sd(inf.lands.1Mb.rep_3$theta)
inf.lands.1Mb.rep_3$tmrcaS <- (inf.lands.1Mb.rep_3$tmrca - mean(inf.lands.1Mb.rep_3$tmrca)) / sd(inf.lands.1Mb.rep_3$tmrca)
inf.lands.1Mb.rep_3$rhoS <- (inf.lands.1Mb.rep_3$rho - mean(inf.lands.1Mb.rep_3$rho)) / sd(inf.lands.1Mb.rep_3$rho)
  
inf.lands.1Mb.rep_3$bin <- 1:nrow(inf.lands.1Mb.rep_3)

inf.lands.1Mb.rep_3$Replicate <- 3

m.diversity.rep_3 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_3)

plot(resid(m.diversity.rep_3)~fitted(m.diversity.rep_3))
dwtest(m.diversity.rep_3)
hmctest(m.diversity.rep_3)
hist(resid(m.diversity.rep_3))
  
summary(m.diversity.rep_3) 
vif(m.diversity.rep_3)

interact_plot(m.diversity.rep_3, pred = thetaS, modx= tmrcaS)

g.rep_3 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_3, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_3)
vif(g.rep_3)

g.rep_3.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_3, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_3.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_3)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 3] <- anova.diversity$VarExp[4] * 100
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_4/rs.pair_4.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_4 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_4) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_4$thetaS <- (inf.lands.1Mb.rep_4$theta - mean(inf.lands.1Mb.rep_4$theta)) / sd(inf.lands.1Mb.rep_4$theta)
inf.lands.1Mb.rep_4$tmrcaS <- (inf.lands.1Mb.rep_4$tmrca - mean(inf.lands.1Mb.rep_4$tmrca)) / sd(inf.lands.1Mb.rep_4$tmrca)
inf.lands.1Mb.rep_4$rhoS <- (inf.lands.1Mb.rep_4$rho - mean(inf.lands.1Mb.rep_4$rho)) / sd(inf.lands.1Mb.rep_4$rho)
  
inf.lands.1Mb.rep_4$bin <- 1:nrow(inf.lands.1Mb.rep_4)

inf.lands.1Mb.rep_4$Replicate <- 4

m.diversity.rep_4 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_4)

plot(resid(m.diversity.rep_4)~fitted(m.diversity.rep_4))
dwtest(m.diversity.rep_4)
hmctest(m.diversity.rep_4)
hist(resid(m.diversity.rep_4))
  
summary(m.diversity.rep_4) 
vif(m.diversity.rep_4)

interact_plot(m.diversity.rep_4, pred = thetaS, modx= tmrcaS)

g.rep_4 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_4, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_4)
vif(g.rep_4)

g.rep_4.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_4, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_4.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_4)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 4] <- anova.diversity$VarExp[4] * 100
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_5/rs.pair_5.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_5 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_5) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_5$thetaS <- (inf.lands.1Mb.rep_5$theta - mean(inf.lands.1Mb.rep_5$theta)) / sd(inf.lands.1Mb.rep_5$theta)
inf.lands.1Mb.rep_5$tmrcaS <- (inf.lands.1Mb.rep_5$tmrca - mean(inf.lands.1Mb.rep_5$tmrca)) / sd(inf.lands.1Mb.rep_5$theta)
inf.lands.1Mb.rep_5$rhoS <- (inf.lands.1Mb.rep_5$rho - mean(inf.lands.1Mb.rep_5$rho)) / sd(inf.lands.1Mb.rep_5$theta)
  
inf.lands.1Mb.rep_5$bin <- 1:nrow(inf.lands.1Mb.rep_5)

inf.lands.1Mb.rep_5$Replicate <- 5

m.diversity.rep_5 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_5)

plot(resid(m.diversity.rep_5)~fitted(m.diversity.rep_5))
dwtest(m.diversity.rep_5)
hmctest(m.diversity.rep_5)
hist(resid(m.diversity.rep_5))
  
summary(m.diversity.rep_5) 
vif(m.diversity.rep_5)

interact_plot(m.diversity.rep_5, pred = thetaS, modx= tmrcaS)

g.rep_5 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_5, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_5)
vif(g.rep_5)

g.rep_5.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_5, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_5.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_5)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 5] <- anova.diversity$VarExp[4] * 100
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_6/rs.pair_6.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_6 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_6) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_6$thetaS <- (inf.lands.1Mb.rep_6$theta - mean(inf.lands.1Mb.rep_6$theta)) / sd(inf.lands.1Mb.rep_6$theta)
inf.lands.1Mb.rep_6$tmrcaS <- (inf.lands.1Mb.rep_6$tmrca - mean(inf.lands.1Mb.rep_6$tmrca)) / sd(inf.lands.1Mb.rep_6$tmrca)
inf.lands.1Mb.rep_6$rhoS <- (inf.lands.1Mb.rep_6$rho - mean(inf.lands.1Mb.rep_6$rho)) / sd(inf.lands.1Mb.rep_6$rho)
  
inf.lands.1Mb.rep_6$bin <- 1:nrow(inf.lands.1Mb.rep_6)

inf.lands.1Mb.rep_6$Replicate <- 6

m.diversity.rep_6 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_6)

plot(resid(m.diversity.rep_6)~fitted(m.diversity.rep_6))
dwtest(m.diversity.rep_6)
hmctest(m.diversity.rep_6)
hist(resid(m.diversity.rep_6))
  
summary(m.diversity.rep_6) 
vif(m.diversity.rep_6)

interact_plot(m.diversity.rep_6, pred = thetaS, modx= tmrcaS)

g.rep_6 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_6, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_6)
vif(g.rep_6)

g.rep_6.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_6, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_6.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_6)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 6] <- anova.diversity$VarExp[4] * 100
```

### Replicate 7

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_7/rs.pair_7.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_7 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_7) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_7$thetaS <- (inf.lands.1Mb.rep_7$theta - mean(inf.lands.1Mb.rep_7$theta)) / sd(inf.lands.1Mb.rep_7$theta)
inf.lands.1Mb.rep_7$tmrcaS <- (inf.lands.1Mb.rep_7$tmrca - mean(inf.lands.1Mb.rep_7$tmrca)) / sd(inf.lands.1Mb.rep_7$tmrca)
inf.lands.1Mb.rep_7$rhoS <- (inf.lands.1Mb.rep_7$rho - mean(inf.lands.1Mb.rep_7$rho)) / sd(inf.lands.1Mb.rep_7$rho)
  
inf.lands.1Mb.rep_7$bin <- 1:nrow(inf.lands.1Mb.rep_7)

inf.lands.1Mb.rep_7$Replicate <- 7

m.diversity.rep_7 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_7)

plot(resid(m.diversity.rep_7)~fitted(m.diversity.rep_7))
dwtest(m.diversity.rep_7)
hmctest(m.diversity.rep_7)
hist(resid(m.diversity.rep_7))
  
summary(m.diversity.rep_7) 
vif(m.diversity.rep_7)

interact_plot(m.diversity.rep_7, pred = thetaS, modx= tmrcaS)

g.rep_7 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_7, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_7)
vif(g.rep_7)

g.rep_7.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_7, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_7.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_7)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 7] <- anova.diversity$VarExp[4] * 100
```

### Replicate 8

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_8/rs.pair_8.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_8 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_8) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_8$thetaS <- (inf.lands.1Mb.rep_8$theta - mean(inf.lands.1Mb.rep_8$theta)) / sd(inf.lands.1Mb.rep_8$theta)
inf.lands.1Mb.rep_8$tmrcaS <- (inf.lands.1Mb.rep_8$tmrca - mean(inf.lands.1Mb.rep_8$tmrca)) / sd(inf.lands.1Mb.rep_8$tmrca)
inf.lands.1Mb.rep_8$rhoS <- (inf.lands.1Mb.rep_8$rho - mean(inf.lands.1Mb.rep_8$rho)) / sd(inf.lands.1Mb.rep_8$rho)
  
inf.lands.1Mb.rep_8$bin <- 1:nrow(inf.lands.1Mb.rep_8)

inf.lands.1Mb.rep_8$Replicate <- 8

m.diversity.rep_8 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_8)

plot(resid(m.diversity.rep_8)~fitted(m.diversity.rep_8))
dwtest(m.diversity.rep_8)
hmctest(m.diversity.rep_8)
hist(resid(m.diversity.rep_8))
  
summary(m.diversity.rep_8) 
vif(m.diversity.rep_8)

interact_plot(m.diversity.rep_8, pred = thetaS, modx= tmrcaS)

g.rep_8 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_8, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_8)
vif(g.rep_8)

g.rep_8.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_8, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_8.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_8)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 8] <- anova.diversity$VarExp[4] * 100
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_9/rs.pair_9.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_9 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_9) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_9$thetaS <- (inf.lands.1Mb.rep_9$theta - mean(inf.lands.1Mb.rep_9$theta)) / sd(inf.lands.1Mb.rep_9$theta)
inf.lands.1Mb.rep_9$tmrcaS <- (inf.lands.1Mb.rep_9$tmrca - mean(inf.lands.1Mb.rep_9$tmrca)) / sd(inf.lands.1Mb.rep_9$tmrca)
inf.lands.1Mb.rep_9$rhoS <- (inf.lands.1Mb.rep_9$rho - mean(inf.lands.1Mb.rep_9$rho)) / sd(inf.lands.1Mb.rep_9$rho)
  
inf.lands.1Mb.rep_9$bin <- 1:nrow(inf.lands.1Mb.rep_9)

inf.lands.1Mb.rep_9$Replicate <- 9

m.diversity.rep_9 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_9)

plot(resid(m.diversity.rep_9)~fitted(m.diversity.rep_9))
dwtest(m.diversity.rep_9)
hmctest(m.diversity.rep_9)
hist(resid(m.diversity.rep_9))
  
summary(m.diversity.rep_9) 
vif(m.diversity.rep_9)

interact_plot(m.diversity.rep_9, pred = thetaS, modx= tmrcaS)

g.rep_9 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_9, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_9)
vif(g.rep_9)

g.rep_9.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_9, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_9.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_9)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 9] <- anova.diversity$VarExp[4] * 100
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
p <- paste("dm_data/dm_chr_maps/2L/dm_coal_sims/rep_10/rs.pair_10.", sep = "")
pi.1Mb <- read.table(paste(p, "diversity.1Mb.bedgraph", sep = ""), header = T)
pi.1Mb$avg <- apply(pi.1Mb[4:ncol(pi.1Mb)], 1, mean)
tmrca.1Mb <- read.table(paste(p, "TMRCA.1Mb.bedgraph", sep = ""), header = T)
tmrca.1Mb$avg <- apply(tmrca.1Mb[4:ncol(tmrca.1Mb)], 1, mean)
rho.1Mb <- read.table(paste(p, "rho.1Mb.bedgraph", sep = ""), header = T)
theta.1Mb <- read.table(paste(p, "theta.1Mb.bedgraph", sep = ""), header = T)

cor.test(sim.theta.1Mb$sim, theta.1Mb$sample_mean, method = "spearman")
  
inf.lands.1Mb.rep_10 <- as.data.frame(cbind(pi.1Mb$avg, theta.1Mb$sample_mean, rho.1Mb$sample_mean, tmrca.1Mb$avg))
names(inf.lands.1Mb.rep_10) <- c("diversity", "theta", "rho", "tmrca")

# standardizing
inf.lands.1Mb.rep_10$thetaS <- (inf.lands.1Mb.rep_10$theta - mean(inf.lands.1Mb.rep_10$theta)) / sd(inf.lands.1Mb.rep_10$theta)
inf.lands.1Mb.rep_10$tmrcaS <- (inf.lands.1Mb.rep_10$tmrca - mean(inf.lands.1Mb.rep_10$tmrca)) / sd(inf.lands.1Mb.rep_10$tmrca)
inf.lands.1Mb.rep_10$rhoS <- (inf.lands.1Mb.rep_10$rho - mean(inf.lands.1Mb.rep_10$rho)) / sd(inf.lands.1Mb.rep_10$rho)
  
inf.lands.1Mb.rep_10$bin <- 1:nrow(inf.lands.1Mb.rep_10)

inf.lands.1Mb.rep_10$Replicate <- 10

m.diversity.rep_10 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS*tmrcaS, data = inf.lands.1Mb.rep_10)

plot(resid(m.diversity.rep_10)~fitted(m.diversity.rep_10))
dwtest(m.diversity.rep_10)
hmctest(m.diversity.rep_10)
hist(resid(m.diversity.rep_10))
  
summary(m.diversity.rep_10) 
vif(m.diversity.rep_10)

interact_plot(m.diversity.rep_10, pred = thetaS, modx= tmrcaS)

g.rep_10 <- gls(diversity ~ thetaS + tmrcaS + rhoS + thetaS:tmrcaS,
               data = inf.lands.1Mb.rep_1, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_10)
vif(g.rep_10)

g.rep_10.no.tmrca <- gls(diversity ~ thetaS + rhoS,
                        data = inf.lands.1Mb.rep_10, cor = corAR1(0, ~bin), method = "ML")

summary(g.rep_10.no.tmrca)

anova.diversity <- Anova(m.diversity.rep_10)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
  
r2.inf.1Mb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.inf.1Mb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.inf.1Mb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.inf.1Mb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.inf.1Mb[5, 10] <- anova.diversity$VarExp[4] * 100

r2.inf.1Mb$average <- rowMeans(r2.inf.1Mb)
r2.inf.1Mb <- transform(r2.inf.1Mb, sd=apply(r2.inf.1Mb, 1, sd, na.rm = TRUE))
```

### all replicates:

```{r, message=FALSE, warning=FALSE}
inf.lands.1Mb.all <- rbind(inf.lands.1Mb.rep_1, inf.lands.1Mb.rep_2, inf.lands.1Mb.rep_3, inf.lands.1Mb.rep_4, inf.lands.1Mb.rep_5, inf.lands.1Mb.rep_6, inf.lands.1Mb.rep_7, inf.lands.1Mb.rep_8, inf.lands.1Mb.rep_9, inf.lands.1Mb.rep_10)

m.div.1Mb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS)*as.factor(Replicate), data = inf.lands.1Mb.all)
plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

m.div.1Mb.2 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS)*as.factor(Replicate), data = inf.lands.1Mb.all)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS + thetaS:rhoS + rhoS:tmrcaS)*as.factor(Replicate), data = inf.lands.1Mb.all)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)
summary(m.div.1Mb)
```

### Plots

```{r, message=FALSE, warning=FALSE}

scale.3d <- function(x) sprintf("%.3f", x)

rho.plot <- as.data.frame(cbind(inf.lands.1Mb.rep_1$bin,
                                sim.rho.1Mb$sim, 
                                inf.lands.1Mb.rep_1$rho,
                                inf.lands.1Mb.rep_2$rho,
                                inf.lands.1Mb.rep_3$rho,
                                inf.lands.1Mb.rep_4$rho,
                                inf.lands.1Mb.rep_5$rho,
                                inf.lands.1Mb.rep_6$rho,
                                inf.lands.1Mb.rep_7$rho,
                                inf.lands.1Mb.rep_8$rho,
                                inf.lands.1Mb.rep_9$rho,
                                inf.lands.1Mb.rep_10$rho))

rho.plot[,3:ncol(rho.plot)] <- 1.53 * rho.plot[,3:ncol(rho.plot)] # scaling because of SCRM N0 vs Ne

names(rho.plot) <- c("bin", "sim", reps)
molten.rho <- melt(rho.plot, id.vars = "bin")
rho.map.1Mb <- ggplot(data = molten.rho, aes(x = bin * 1000, y = value, colour = variable)) + theme_bw()
rho.map.1Mb <- rho.map.1Mb + geom_line(data = molten.rho, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
rho.map.1Mb <- rho.map.1Mb + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Blues"), "cyan"))
rho.map.1Mb <- rho.map.1Mb + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
rho.map.1Mb <- rho.map.1Mb + labs(title = NULL, x = NULL, y = expression(rho))
rho.map.1Mb <- rho.map.1Mb + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)

theta.plot <- as.data.frame(cbind(inf.lands.1Mb.rep_1$bin,
                                sim.theta.1Mb$sim, 
                                inf.lands.1Mb.rep_1$theta,
                                inf.lands.1Mb.rep_2$theta,
                                inf.lands.1Mb.rep_3$theta,
                                inf.lands.1Mb.rep_4$theta,
                                inf.lands.1Mb.rep_5$theta,
                                inf.lands.1Mb.rep_6$theta,
                                inf.lands.1Mb.rep_7$theta,
                                inf.lands.1Mb.rep_8$theta,
                                inf.lands.1Mb.rep_9$theta,
                                inf.lands.1Mb.rep_10$theta))

names(theta.plot) <- c("bin", "sim", reps)
molten.theta <- melt(theta.plot, id.vars = "bin")
theta.map.1Mb <- ggplot(data = molten.theta, aes(x = bin * 1000, y = value, colour = variable)) + theme_bw()
theta.map.1Mb <- theta.map.1Mb + geom_line(data = molten.theta, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
theta.map.1Mb <- theta.map.1Mb + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Reds"), "orange"))
theta.map.1Mb <- theta.map.1Mb + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
theta.map.1Mb <- theta.map.1Mb + labs(title = NULL, x = "Position (kb)", y = "1 Mb")
theta.map.1Mb <- theta.map.1Mb + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)

plot_grid(rho.map.1Mb, theta.map.1Mb, nrow = 2, ncol = 1)

theta.maps.coal <- plot_grid(theta.map.50kb, theta.map.200kb, theta.map.1Mb, nrow = 3, ncol = 1)
theta.maps.coal
```

# Real Drosophila data.

We first focus on chr 2L for comparing R^2 with simulations

```{r, message=FALSE, warning=FALSE}
r2.dm.tab <- as.data.frame(matrix(ncol = 6, nrow = 3))
colnames(r2.dm.tab) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA", "bin.size")

# 50kb
# recombination landscapes
rho.dm.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.rho.50kb.bedgraph", header = T)

# diversity
diversity.dm.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.diversity.50kb.bedgraph", header = T)
diversity.dm.50kb$avg <- apply(diversity.dm.50kb[4:ncol(diversity.dm.50kb)], 1, mean)

# mutation landscapes
theta.dm.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.theta.50kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.TMRCA.50kb.bedgraph", header = T)
tmrca.dm.50kb$sample_mean <- apply(tmrca.dm.50kb[4:ncol(tmrca.dm.50kb)], 1, mean)

# missing data
missing.prop.50kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.missing.prop.50kb.bedgraph", header = T)
intersect.50kb <- apply(missing.prop.50kb[4:ncol(missing.prop.50kb)], 1, function(x) any(x > 0.1)) 

dm.lands.50kb <- as.data.frame(cbind(diversity.dm.50kb$avg,
                                     theta.dm.50kb$sample_mean,
                                     rho.dm.50kb$sample_mean,
                                     tmrca.dm.50kb$sample_mean))

names(dm.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
dm.lands.50kb$bin <- 1:nrow(dm.lands.50kb)

dm.lands.50kb <- dm.lands.50kb[which(intersect.50kb == F),] # filters based on missing data

# correlation between inferred TMRCA and Pi
cor.test(dm.lands.50kb$diversity, dm.lands.50kb$tmrca, method = "spearman")

# correlation with Comeron map
comeron.50kb <- read.table("dm_bgs_sims/RecombinationMap_50kb.csv", sep = ",", header = T)
comeron.50kb$chrom <- "2L"
comeron.50kb_gr <- makeGRangesFromDataFrame(comeron.50kb, keep.extra.columns = T)

rho.dm.50kb$chromStart <- rho.dm.50kb$chromStart + 1
rho.dm.50kb$chrom <- "2L"
rho.dm.50kb_gr <- makeGRangesFromDataFrame(rho.dm.50kb[,c(1:3, ncol(rho.dm.50kb))], keep.extra.columns = T)

hits <- findOverlaps(query = rho.dm.50kb_gr, subject = comeron.50kb_gr, type = "equal") 

comeron.50kb_gr <- comeron.50kb_gr[subjectHits(hits),]
rho.dm.50kb_gr <- rho.dm.50kb_gr[queryHits(hits),]

rec_df <- merge(as.data.frame(rho.dm.50kb_gr), as.data.frame(comeron.50kb_gr))
cor.test(rec_df[,6], rec_df[,7], method = "spearman")


# OLS

# standardizing
dm.lands.50kb$thetaS <- (dm.lands.50kb$theta - mean(dm.lands.50kb$theta)) / sd(dm.lands.50kb$theta)
dm.lands.50kb$tmrcaS <- (dm.lands.50kb$tmrca - mean(dm.lands.50kb$tmrca)) / sd(dm.lands.50kb$tmrca)
dm.lands.50kb$rhoS <- (dm.lands.50kb$rho - mean(dm.lands.50kb$rho)) / sd(dm.lands.50kb$rho)

m.diversity <- lm(diversity ~ thetaS + rhoS + tmrcaS + tmrcaS*thetaS, data = dm.lands.50kb)

# type 2 ANOVA
anova.diversity <- Anova(m.diversity)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.dm.tab[1,] <- c((anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100,
                    anova.diversity$VarExp[1] * 100,
                    anova.diversity$VarExp[2] * 100,
                    anova.diversity$VarExp[3] * 100, 
                    anova.diversity$VarExp[4] * 100, 50)

# 200kb
# recombination landscapes
rho.dm.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.rho.200kb.bedgraph", header = T)

# diversity
diversity.dm.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.diversity.200kb.bedgraph", header = T)
diversity.dm.200kb$avg <- apply(diversity.dm.200kb[4:ncol(diversity.dm.200kb)], 1, mean)

# mutation landscapes
theta.dm.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.theta.200kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.TMRCA.200kb.bedgraph", header = T)
tmrca.dm.200kb$sample_mean <- apply(tmrca.dm.200kb[4:ncol(tmrca.dm.200kb)], 1, mean)

# missing data
missing.prop.200kb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.missing.prop.200kb.bedgraph", header = T)
intersect.200kb <- apply(missing.prop.200kb[4:ncol(missing.prop.200kb)], 1, function(x) any(x > 0.1)) 

dm.lands.200kb <- as.data.frame(cbind(diversity.dm.200kb$avg,
                                     theta.dm.200kb$sample_mean,
                                     rho.dm.200kb$sample_mean,
                                     tmrca.dm.200kb$sample_mean))

names(dm.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
dm.lands.200kb$bin <- 1:nrow(dm.lands.200kb)
# filters based on missing data 
dm.lands.200kb <- dm.lands.200kb[which(intersect.200kb == F),]

# correlation between inferred TMRCA and Pi
cor.test(dm.lands.200kb$diversity, dm.lands.200kb$tmrca, method = "spearman")

# correlation with Comeron map
comeron.200kb <- read.table("dm_bgs_sims/RecombinationMap_200kb.csv", sep = ",", header = T)
comeron.200kb$chrom <- "2L"
comeron.200kb_gr <- makeGRangesFromDataFrame(comeron.200kb, keep.extra.columns = T)

rho.dm.200kb$chromStart <- rho.dm.200kb$chromStart + 1
rho.dm.200kb$chrom <- "2L"
rho.dm.200kb_gr <- makeGRangesFromDataFrame(rho.dm.200kb[,c(1:3, ncol(rho.dm.200kb))], keep.extra.columns = T)

hits <- findOverlaps(query = rho.dm.200kb_gr, subject = comeron.200kb_gr, type = "equal") 

comeron.200kb_gr <- comeron.200kb_gr[subjectHits(hits),]
rho.dm.200kb_gr <- rho.dm.200kb_gr[queryHits(hits),]

rec_df <- merge(as.data.frame(rho.dm.200kb_gr), as.data.frame(comeron.200kb_gr))
cor.test(rec_df[,6], rec_df[,7], method = "spearman")

# OLS

dm.lands.200kb$thetaS <- (dm.lands.200kb$theta - mean(dm.lands.200kb$theta)) / sd(dm.lands.200kb$theta)
dm.lands.200kb$tmrcaS <- (dm.lands.200kb$tmrca - mean(dm.lands.200kb$tmrca)) / sd(dm.lands.200kb$tmrca)
dm.lands.200kb$rhoS <- (dm.lands.200kb$rho - mean(dm.lands.200kb$rho)) / sd(dm.lands.200kb$rho)

m.diversity <- lm(diversity ~ thetaS + rhoS + tmrcaS + tmrcaS*thetaS, data = dm.lands.200kb)

# type 2 ANOVA
anova.diversity <- Anova(m.diversity)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.dm.tab[2,] <- c((anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100,
                   anova.diversity$VarExp[1] * 100,
                   anova.diversity$VarExp[2] * 100, 
                   anova.diversity$VarExp[3] * 100, 
                   anova.diversity$VarExp[4] * 100, 200)

# 1Mb
# recombination landscapes
rho.dm.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.rho.1Mb.bedgraph", header = T)

# diversity
diversity.dm.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.diversity.1Mb.bedgraph", header = T)
diversity.dm.1Mb$avg <- apply(diversity.dm.1Mb[4:ncol(diversity.dm.1Mb)], 1, mean)

# mutation landscapes
theta.dm.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.theta.1Mb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.TMRCA.1Mb.bedgraph", header = T)
tmrca.dm.1Mb$sample_mean <- apply(tmrca.dm.1Mb[4:ncol(tmrca.dm.1Mb)], 1, mean)

# missing data
missing.prop.1Mb <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.missing.prop.1Mb.bedgraph", header = T)
intersect.1Mb <- apply(missing.prop.1Mb[4:ncol(missing.prop.1Mb)], 1, function(x) any(x > 0.1)) 

dm.lands.1Mb <- as.data.frame(cbind(diversity.dm.1Mb$avg,
                                    theta.dm.1Mb$sample_mean,
                                    rho.dm.1Mb$sample_mean,
                                    tmrca.dm.1Mb$sample_mean))

names(dm.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
dm.lands.1Mb$bin <- 1:nrow(dm.lands.1Mb)
# filters based on missing data
dm.lands.1Mb <- dm.lands.1Mb[which(intersect.1Mb == F),]

# correlation between inferred TMRCA and Pi
cor.test(dm.lands.1Mb$diversity, dm.lands.1Mb$tmrca, method = "spearman")

# correlation with Comeron map
comeron.1Mb <- read.table("dm_bgs_sims/RecombinationMap_1000kb.csv", sep = ",", header = T)
comeron.1Mb$chrom <- "2L"
comeron.1Mb_gr <- makeGRangesFromDataFrame(comeron.1Mb, keep.extra.columns = T)

rho.dm.1Mb$chromStart <- rho.dm.1Mb$chromStart + 1
rho.dm.1Mb$chrom <- "2L"
rho.dm.1Mb_gr <- makeGRangesFromDataFrame(rho.dm.1Mb[,c(1:3, ncol(rho.dm.1Mb))], keep.extra.columns = T)

hits <- findOverlaps(query = rho.dm.1Mb_gr, subject = comeron.1Mb_gr, type = "equal") 

comeron.1Mb_gr <- comeron.1Mb_gr[subjectHits(hits),]
rho.dm.1Mb_gr <- rho.dm.1Mb_gr[queryHits(hits),]

rec_df <- merge(as.data.frame(rho.dm.1Mb_gr), as.data.frame(comeron.1Mb_gr))
cor.test(rec_df[,6], rec_df[,7], method = "spearman")

# OLS
dm.lands.1Mb$thetaS <- (dm.lands.1Mb$theta - mean(dm.lands.1Mb$theta))
dm.lands.1Mb$tmrcaS <- (dm.lands.1Mb$tmrca - mean(dm.lands.1Mb$tmrca))
dm.lands.1Mb$rhoS <- (dm.lands.1Mb$rho - mean(dm.lands.1Mb$rho))

m.diversity <- lm(diversity ~ thetaS + rhoS + tmrcaS + tmrcaS*thetaS, data = dm.lands.1Mb)

# type 2 ANOVA
anova.diversity <- Anova(m.diversity)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)


r2.dm.tab[3,] <- c((anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] +
                    anova.diversity$VarExp[4]) * 100,
                    anova.diversity$VarExp[1] * 100,
                    anova.diversity$VarExp[2] * 100,
                    anova.diversity$VarExp[3] * 100,
                    anova.diversity$VarExp[4] * 100, 1000)

```

We now move on to whole-genome analyses

## 50 kb windows

```{r, message=FALSE, warning=FALSE}
# Chr 2L

# recombination landscapes
rho.dm.50kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.rho.50kb.bedgraph", header = T)

# diversity
diversity.dm.50kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.diversity.50kb.bedgraph", header = T)
diversity.dm.50kb.2L$avg <- apply(diversity.dm.50kb.2L[4:ncol(diversity.dm.50kb.2L)], 1, mean)

# mutation landscapes
theta.dm.50kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.theta.50kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.50kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.TMRCA.50kb.bedgraph", header = T)
tmrca.dm.50kb.2L$sample_mean <- apply(tmrca.dm.50kb.2L[4:ncol(tmrca.dm.50kb.2L)], 1, mean)

# missing data
missing.prop.50kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.missing.prop.50kb.bedgraph", header = T)
intersect.50kb.2L <- apply(missing.prop.50kb.2L[4:ncol(missing.prop.50kb.2L)], 1, function(x) any(x > 0.1)) 

dm.lands.50kb.2L <- as.data.frame(cbind(diversity.dm.50kb.2L$chromStart,
                                        diversity.dm.50kb.2L$chromEnd,
                                        diversity.dm.50kb.2L$avg,
                                        theta.dm.50kb.2L$sample_mean,
                                        rho.dm.50kb.2L$sample_mean,
                                        tmrca.dm.50kb.2L$sample_mean))
names(dm.lands.50kb.2L) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.50kb.2L$bin <- 1:nrow(dm.lands.50kb.2L)

# filters based on missing data 
dm.lands.50kb.2L <- dm.lands.50kb.2L[which(intersect.50kb.2L == F),]

dm.lands.50kb.2L$chr <- "2L"

dm.lands.50kb.2L$thetaS <- (dm.lands.50kb.2L$theta - mean(dm.lands.50kb.2L$theta)) / sd(dm.lands.50kb.2L$theta)
dm.lands.50kb.2L$tmrcaS <- (dm.lands.50kb.2L$tmrca - mean(dm.lands.50kb.2L$tmrca)) / sd(dm.lands.50kb.2L$tmrca)
dm.lands.50kb.2L$rhoS <- (dm.lands.50kb.2L$rho - mean(dm.lands.50kb.2L$rho)) / sd(dm.lands.50kb.2L$rho)

g.div.dm.50kb.2L <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.50kb.2L, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.50kb.2L)

# Chr 2R

# recombination landscapes
rho.dm.50kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.rho.50kb.bedgraph", header = T)

# diversity
diversity.dm.50kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.diversity.50kb.bedgraph", header = T)
diversity.dm.50kb.2R$avg <- apply(diversity.dm.50kb.2R[4:ncol(diversity.dm.50kb.2R)], 1, mean)

# mutation landscapes
theta.dm.50kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.theta.50kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.50kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.TMRCA.50kb.bedgraph", header = T)
tmrca.dm.50kb.2R$sample_mean <- apply(tmrca.dm.50kb.2R[4:ncol(tmrca.dm.50kb.2R)], 1, mean)

# missing data
missing.prop.50kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.missing.prop.50kb.bedgraph", header = T)
intersect.50kb.2R <- apply(missing.prop.50kb.2R[4:ncol(missing.prop.50kb.2R)], 1, function(x) any(x > 0.1)) 

dm.lands.50kb.2R <- as.data.frame(cbind(diversity.dm.50kb.2R$chromStart,
                                        diversity.dm.50kb.2R$chromEnd,
                                        diversity.dm.50kb.2R$avg,
                                        theta.dm.50kb.2R$sample_mean,
                                        rho.dm.50kb.2R$sample_mean,
                                        tmrca.dm.50kb.2R$sample_mean))
names(dm.lands.50kb.2R) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.50kb.2R$bin <- 1:nrow(dm.lands.50kb.2R)

# filters based on missing data 
dm.lands.50kb.2R <- dm.lands.50kb.2R[which(intersect.50kb.2R == F),]

dm.lands.50kb.2R$chr <- "2R"

dm.lands.50kb.2R$thetaS <- (dm.lands.50kb.2R$theta- mean(dm.lands.50kb.2R$theta)) / sd(dm.lands.50kb.2L$theta)
dm.lands.50kb.2R$tmrcaS <- (dm.lands.50kb.2R$tmrca - mean(dm.lands.50kb.2R$tmrca)) / sd(dm.lands.50kb.2R$tmrca)
dm.lands.50kb.2R$rhoS <- (dm.lands.50kb.2R$rho - mean(dm.lands.50kb.2R$rho)) / sd(dm.lands.50kb.2R$rho)

g.div.dm.50kb.2R <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.50kb.2R, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.50kb.2R)

# recombination landscapes
rho.dm.50kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.rho.50kb.bedgraph", header = T)

# diversity
diversity.dm.50kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.diversity.50kb.bedgraph", header = T)
diversity.dm.50kb.3L$avg <- apply(diversity.dm.50kb.3L[4:ncol(diversity.dm.50kb.3L)], 1, mean)

# mutation landscapes
theta.dm.50kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.theta.50kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.50kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.TMRCA.50kb.bedgraph", header = T)
tmrca.dm.50kb.3L$sample_mean <- apply(tmrca.dm.50kb.3L[4:ncol(tmrca.dm.50kb.3L)], 1, mean)

# missing data
missing.prop.50kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.missing.prop.50kb.bedgraph", header = T)
intersect.50kb.3L <- apply(missing.prop.50kb.3L[4:ncol(missing.prop.50kb.3L)], 1, function(x) any(x > 0.1)) 

dm.lands.50kb.3L <- as.data.frame(cbind(diversity.dm.50kb.3L$chromStart,
                                        diversity.dm.50kb.3L$chromEnd,
                                        diversity.dm.50kb.3L$avg,
                                        theta.dm.50kb.3L$sample_mean,
                                        rho.dm.50kb.3L$sample_mean,
                                        tmrca.dm.50kb.3L$sample_mean))
names(dm.lands.50kb.3L) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.50kb.3L$bin <- 1:nrow(dm.lands.50kb.3L)

# filters based on missing data
dm.lands.50kb.3L <- dm.lands.50kb.3L[which(intersect.50kb.3L == F),]

dm.lands.50kb.3L$chr <- "3L"

dm.lands.50kb.3L$thetaS <- (dm.lands.50kb.3L$theta - mean(dm.lands.50kb.3L$theta)) / sd(dm.lands.50kb.3L$theta)
dm.lands.50kb.3L$tmrcaS <- (dm.lands.50kb.3L$tmrca - mean(dm.lands.50kb.3L$tmrca)) / sd(dm.lands.50kb.3L$tmrca)
dm.lands.50kb.3L$rhoS <- (dm.lands.50kb.3L$rho - mean(dm.lands.50kb.3L$rho)) / sd(dm.lands.50kb.3L$rho)

g.div.dm.50kb.3L <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.50kb.3L, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.50kb.3L)

# Chr 3R

# recombination landscapes
rho.dm.50kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.rho.50kb.bedgraph", header = T)

# diversity
diversity.dm.50kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.diversity.50kb.bedgraph", header = T)
diversity.dm.50kb.3R$avg <- apply(diversity.dm.50kb.3R[4:ncol(diversity.dm.50kb.3R)], 1, mean)

# mutation landscapes
theta.dm.50kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.theta.50kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.50kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.TMRCA.50kb.bedgraph", header = T)
tmrca.dm.50kb.3R$sample_mean <- apply(tmrca.dm.50kb.3R[4:ncol(tmrca.dm.50kb.3R)], 1, mean)

# missing data
missing.prop.50kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.missing.prop.50kb.bedgraph", header = T)
intersect.50kb.3R <- apply(missing.prop.50kb.3R[4:ncol(missing.prop.50kb.3R)], 1, function(x) any(x > 0.1)) 

dm.lands.50kb.3R <- as.data.frame(cbind(diversity.dm.50kb.3R$chromStart,
                                        diversity.dm.50kb.3R$chromEnd,
                                        diversity.dm.50kb.3R$avg,
                                        theta.dm.50kb.3R$sample_mean,
                                        rho.dm.50kb.3R$sample_mean,
                                        tmrca.dm.50kb.3R$sample_mean))
names(dm.lands.50kb.3R) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.50kb.3R$bin <- 1:nrow(dm.lands.50kb.3R)

# filters based on missing data
dm.lands.50kb.3R <- dm.lands.50kb.3R[which(intersect.50kb.3R == F),]

dm.lands.50kb.3R$chr <- "3R"

dm.lands.50kb.3R$thetaS <- (dm.lands.50kb.3R$theta - mean(dm.lands.50kb.3R$theta)) / sd(dm.lands.50kb.3R$theta)
dm.lands.50kb.3R$tmrcaS <- (dm.lands.50kb.3R$tmrca - mean(dm.lands.50kb.3R$tmrca)) / sd(dm.lands.50kb.3R$tmrca)
dm.lands.50kb.3R$rhoS <- (dm.lands.50kb.3R$rho - mean(dm.lands.50kb.3R$rho)) / sd(dm.lands.50kb.3R$rho)

g.div.dm.50kb.3R <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.50kb.3R, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.50kb.3R)

# all together now
dm.lands.50kb <- rbind.data.frame(dm.lands.50kb.2L, dm.lands.50kb.2R, dm.lands.50kb.3L, dm.lands.50kb.3R)

write.table(dm.lands.50kb, "dm_data/dm_chr_maps/dm.maps.50kb.tsv", quote = F, sep = "\t", row.names = F, col.names = T)

# genome-wide correlations 
cor.test(~rho + diversity, data = dm.lands.50kb, method = "spearman")
cor.test(~rho + tmrca, data = dm.lands.50kb, method = "spearman")
cor.test(~theta + tmrca, data = dm.lands.50kb, method = "spearman")

# Linear models
# standardizing
dm.lands.50kb$thetaS <- (dm.lands.50kb$theta - mean(dm.lands.50kb$theta)) / sd(dm.lands.50kb$theta)
dm.lands.50kb$tmrcaS <- (dm.lands.50kb$tmrca - mean(dm.lands.50kb$tmrca)) / sd(dm.lands.50kb$tmrca)
dm.lands.50kb$rhoS <- (dm.lands.50kb$rho - mean(dm.lands.50kb$rho)) / sd(dm.lands.50kb$rho)

dm.lands.50kb$bin <- 1:nrow(dm.lands.50kb)

m.div.dm.50kb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS), data = dm.lands.50kb)

plot(resid(m.div.dm.50kb)~fitted(m.div.dm.50kb))
hist(resid(m.div.dm.50kb), nclass = 30)
dwtest(m.div.dm.50kb)
hmctest(m.div.dm.50kb, nsim = 10000) 

summary(m.div.dm.50kb)
vif(m.div.dm.50kb)

# type 2 ANOVA
anova.diversity <- Anova(m.div.dm.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
anova.diversity

# GLS
g.div.dm.50kb.1 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.50kb, weights = varPower(0, ~tmrcaS|chr), cor = corAR1(0, ~bin|chr), method = "ML")

g.div.dm.50kb.2 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.50kb, weights = varPower(0, ~theta|chr), cor = corAR1(0, ~bin|chr), method = "ML")

g.div.dm.50kb.3 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.50kb, weights = varPower(0, ~theta|chr), method = "ML")

g.div.dm.50kb.4 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.50kb, weights = varPower(0, ~tmrcaS|chr), method = "ML")

AIC(g.div.dm.50kb.1, g.div.dm.50kb.2, g.div.dm.50kb.3, g.div.dm.50kb.4)

summary(g.div.dm.50kb.1)

vif(g.div.dm.50kb.1)

# Linear model without TMRCA --> rho becomes significant
g.div.dm.50kb.5 <- gls(diversity ~ (thetaS + rhoS),
                       data = dm.lands.50kb, weights = varPower(0, ~thetaS|chr), cor = corAR1(0, ~bin|chr), method = "ML")

summary(g.div.dm.50kb.5)
vif(g.div.dm.50kb.5)
```

## 200 kb windows

```{r, message=FALSE, warning=FALSE}
# Chr 2L

# recombination landscapes
rho.dm.200kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.rho.200kb.bedgraph", header = T)

# diversity
diversity.dm.200kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.diversity.200kb.bedgraph", header = T)
diversity.dm.200kb.2L$avg <- apply(diversity.dm.200kb.2L[4:ncol(diversity.dm.200kb.2L)], 1, mean)

# mutation landscapes
theta.dm.200kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.theta.200kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.200kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.TMRCA.200kb.bedgraph", header = T)
tmrca.dm.200kb.2L$sample_mean <- apply(tmrca.dm.200kb.2L[4:ncol(tmrca.dm.200kb.2L)], 1, mean)

# missing data
missing.prop.200kb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.missing.prop.200kb.bedgraph", header = T)
intersect.200kb.2L <- apply(missing.prop.200kb.2L[4:ncol(missing.prop.200kb.2L)], 1, function(x) any(x > 0.1)) 

dm.lands.200kb.2L <- as.data.frame(cbind(diversity.dm.200kb.2L$chromStart,
                                        diversity.dm.200kb.2L$chromEnd,
                                        diversity.dm.200kb.2L$avg,
                                        theta.dm.200kb.2L$sample_mean,
                                        rho.dm.200kb.2L$sample_mean,
                                        tmrca.dm.200kb.2L$sample_mean))
names(dm.lands.200kb.2L) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.200kb.2L$bin <- 1:nrow(dm.lands.200kb.2L)

# filters based on missing data 
dm.lands.200kb.2L <- dm.lands.200kb.2L[which(intersect.200kb.2L == F),]

dm.lands.200kb.2L$chr <- "2L"

dm.lands.200kb.2L$thetaS <- (dm.lands.200kb.2L$theta - mean(dm.lands.200kb.2L$theta)) / sd(dm.lands.200kb.2L$theta)
dm.lands.200kb.2L$tmrcaS <- (dm.lands.200kb.2L$tmrca - mean(dm.lands.200kb.2L$tmrca)) / sd(dm.lands.200kb.2L$tmrca)
dm.lands.200kb.2L$rhoS <- (dm.lands.200kb.2L$rho - mean(dm.lands.200kb.2L$rho)) / sd(dm.lands.200kb.2L$rho)

g.div.dm.200kb.2L <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.200kb.2L, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.200kb.2L)

# Chr 2R

# recombination landscapes
rho.dm.200kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.rho.200kb.bedgraph", header = T)

# diversity
diversity.dm.200kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.diversity.200kb.bedgraph", header = T)
diversity.dm.200kb.2R$avg <- apply(diversity.dm.200kb.2R[4:ncol(diversity.dm.200kb.2R)], 1, mean)

# mutation landscapes
theta.dm.200kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.theta.200kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.200kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.TMRCA.200kb.bedgraph", header = T)
tmrca.dm.200kb.2R$sample_mean <- apply(tmrca.dm.200kb.2R[4:ncol(tmrca.dm.200kb.2R)], 1, mean)

# missing data
missing.prop.200kb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.missing.prop.200kb.bedgraph", header = T)
intersect.200kb.2R <- apply(missing.prop.200kb.2R[4:ncol(missing.prop.200kb.2R)], 1, function(x) any(x > 0.1)) 

dm.lands.200kb.2R <- as.data.frame(cbind(diversity.dm.200kb.2R$chromStart,
                                        diversity.dm.200kb.2R$chromEnd,
                                        diversity.dm.200kb.2R$avg,
                                        theta.dm.200kb.2R$sample_mean,
                                        rho.dm.200kb.2R$sample_mean,
                                        tmrca.dm.200kb.2R$sample_mean))
names(dm.lands.200kb.2R) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.200kb.2R$bin <- 1:nrow(dm.lands.200kb.2R)

# filters based on missing data 
dm.lands.200kb.2R <- dm.lands.200kb.2R[which(intersect.200kb.2R == F),]

dm.lands.200kb.2R$chr <- "2R"

dm.lands.200kb.2R$thetaS <- (dm.lands.200kb.2R$theta - mean(dm.lands.200kb.2R$theta)) / sd(dm.lands.200kb.2R$theta)
dm.lands.200kb.2R$tmrcaS <- (dm.lands.200kb.2R$tmrca - mean(dm.lands.200kb.2R$tmrca)) / sd(dm.lands.200kb.2R$tmrca)
dm.lands.200kb.2R$rhoS <- (dm.lands.200kb.2R$rho - mean(dm.lands.200kb.2R$rho)) / sd(dm.lands.200kb.2R$rho)

g.div.dm.200kb.2R <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.200kb.2R, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.200kb.2R)

# recombination landscapes
rho.dm.200kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.rho.200kb.bedgraph", header = T)

# diversity
diversity.dm.200kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.diversity.200kb.bedgraph", header = T)
diversity.dm.200kb.3L$avg <- apply(diversity.dm.200kb.3L[4:ncol(diversity.dm.200kb.3L)], 1, mean)

# mutation landscapes
theta.dm.200kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.theta.200kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.200kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.TMRCA.200kb.bedgraph", header = T)
tmrca.dm.200kb.3L$sample_mean <- apply(tmrca.dm.200kb.3L[4:ncol(tmrca.dm.200kb.3L)], 1, mean)

# missing data
missing.prop.200kb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.missing.prop.200kb.bedgraph", header = T)
intersect.200kb.3L <- apply(missing.prop.200kb.3L[4:ncol(missing.prop.200kb.3L)], 1, function(x) any(x > 0.1)) 

dm.lands.200kb.3L <- as.data.frame(cbind(diversity.dm.200kb.3L$chromStart,
                                        diversity.dm.200kb.3L$chromEnd,
                                        diversity.dm.200kb.3L$avg,
                                        theta.dm.200kb.3L$sample_mean,
                                        rho.dm.200kb.3L$sample_mean,
                                        tmrca.dm.200kb.3L$sample_mean))
names(dm.lands.200kb.3L) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.200kb.3L$bin <- 1:nrow(dm.lands.200kb.3L)

# filters based on missing data
dm.lands.200kb.3L <- dm.lands.200kb.3L[which(intersect.200kb.3L == F),]

dm.lands.200kb.3L$chr <- "3L"

dm.lands.200kb.3L$thetaS <- (dm.lands.200kb.3L$theta - mean(dm.lands.200kb.3L$theta)) / sd(dm.lands.200kb.3L$theta)
dm.lands.200kb.3L$tmrcaS <- (dm.lands.200kb.3L$tmrca - mean(dm.lands.200kb.3L$tmrca)) / sd(dm.lands.200kb.3L$tmrca)
dm.lands.200kb.3L$rhoS <- (dm.lands.200kb.3L$rho - mean(dm.lands.200kb.3L$rho)) / sd(dm.lands.200kb.3L$rho)

g.div.dm.200kb.3L <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.200kb.3L, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.200kb.3L)

# Chr 3R

# recombination landscapes
rho.dm.200kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.rho.200kb.bedgraph", header = T)

# diversity
diversity.dm.200kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.diversity.200kb.bedgraph", header = T)

diversity.dm.200kb.3R$avg <- apply(diversity.dm.200kb.3R[4:ncol(diversity.dm.200kb.3R)], 1, mean)

# mutation landscapes
theta.dm.200kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.theta.200kb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.200kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.TMRCA.200kb.bedgraph", header = T)
tmrca.dm.200kb.3R$sample_mean <- apply(tmrca.dm.200kb.3R[4:ncol(tmrca.dm.200kb.3R)], 1, mean)

# missing data
missing.prop.200kb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.missing.prop.200kb.bedgraph", header = T)
intersect.200kb.3R <- apply(missing.prop.200kb.3R[4:ncol(missing.prop.200kb.3R)], 1, function(x) any(x > 0.1)) 

dm.lands.200kb.3R <- as.data.frame(cbind(diversity.dm.200kb.3R$chromStart,
                                        diversity.dm.200kb.3R$chromEnd,
                                        diversity.dm.200kb.3R$avg,
                                        theta.dm.200kb.3R$sample_mean,
                                        rho.dm.200kb.3R$sample_mean,
                                        tmrca.dm.200kb.3R$sample_mean))
names(dm.lands.200kb.3R) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.200kb.3R$bin <- 1:nrow(dm.lands.200kb.3R)

# filters based on missing data
dm.lands.200kb.3R <- dm.lands.200kb.3R[which(intersect.200kb.3R == F),]

dm.lands.200kb.3R$chr <- "3R"

dm.lands.200kb.3R$thetaS <- (dm.lands.200kb.3R$theta - mean(dm.lands.200kb.3R$theta)) / sd(dm.lands.200kb.3R$theta)
dm.lands.200kb.3R$tmrcaS <- (dm.lands.200kb.3R$tmrca - mean(dm.lands.200kb.3R$tmrca)) / sd(dm.lands.200kb.3R$tmrca)
dm.lands.200kb.3R$rhoS <- (dm.lands.200kb.3R$rho - mean(dm.lands.200kb.3R$rho)) / sd(dm.lands.200kb.3R$rho)

g.div.dm.200kb.3R <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.200kb.3R, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.200kb.3R)

# all together now
dm.lands.200kb <- rbind.data.frame(dm.lands.200kb.2L, dm.lands.200kb.2R, dm.lands.200kb.3L, dm.lands.200kb.3R)

write.table(dm.lands.200kb, "dm_data/dm_chr_maps/dm.maps.200kb.tsv", quote = F, sep = "\t", row.names = F, col.names = T)

# genome-wide correlations
cor.test(~rho + diversity, data = dm.lands.200kb, method = "spearman")
cor.test(~rho + tmrca, data = dm.lands.200kb, method = "spearman")
cor.test(~theta + tmrca, data = dm.lands.200kb, method = "spearman")

# Linear models
# standardizing
dm.lands.200kb$thetaS <- (dm.lands.200kb$theta - mean(dm.lands.200kb$theta)) / sd(dm.lands.200kb$theta)
dm.lands.200kb$tmrcaS <- (dm.lands.200kb$tmrca - mean(dm.lands.200kb$tmrca)) / sd(dm.lands.200kb$tmrca)
dm.lands.200kb$rhoS <- (dm.lands.200kb$rho - mean(dm.lands.200kb$rho)) / sd(dm.lands.200kb$rho)

dm.lands.200kb$bin <- 1:nrow(dm.lands.200kb)

m.div.dm.200kb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS), data = dm.lands.200kb)

plot(resid(m.div.dm.200kb)~fitted(m.div.dm.200kb))
hist(resid(m.div.dm.200kb), nclass = 30)
dwtest(m.div.dm.200kb)
hmctest(m.div.dm.200kb, nsim = 10000) 

summary(m.div.dm.200kb)
vif(m.div.dm.200kb)
  
# type 2 ANOVA
anova.diversity <- Anova(m.div.dm.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
anova.diversity

# GLS
g.div.dm.200kb.1 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.200kb, weights = varPower(0, ~tmrcaS|chr), cor = corAR1(0, ~bin|chr), method = "ML")

g.div.dm.200kb.2 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.200kb, weights = varPower(0, ~thetaS|chr), cor = corAR1(0, ~bin|chr), method = "ML")

g.div.dm.200kb.3 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.200kb, weights = varPower(0, ~thetaS|chr), method = "ML")

g.div.dm.200kb.4 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.200kb, weights = varPower(0, ~tmrcaS|chr), method = "ML")

AIC(g.div.dm.200kb.1, g.div.dm.200kb.2, g.div.dm.200kb.3, g.div.dm.200kb.4)

summary(g.div.dm.200kb.1)
vif(g.div.dm.200kb.1)

# Linear model without TMRCA --> rho becomes significant
g.div.dm.200kb.5 <- gls(diversity ~ (thetaS + rhoS),
                       data = dm.lands.200kb, weights = varPower(0, ~thetaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.200kb.5)
vif(g.div.dm.200kb.5)
```

## 1 Mb windows

```{r, message=FALSE, warning=FALSE}
# Chr 2L

# recombination landscapes
rho.dm.1Mb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.rho.1Mb.bedgraph", header = T)

# diversity
diversity.dm.1Mb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.diversity.1Mb.bedgraph", header = T)
diversity.dm.1Mb.2L$avg <- apply(diversity.dm.1Mb.2L[4:ncol(diversity.dm.1Mb.2L)], 1, mean)

# mutation landscapes
theta.dm.1Mb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.theta.1Mb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.1Mb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.TMRCA.1Mb.bedgraph", header = T)
tmrca.dm.1Mb.2L$sample_mean <- apply(tmrca.dm.1Mb.2L[4:ncol(tmrca.dm.1Mb.2L)], 1, mean)

# missing data
missing.prop.1Mb.2L <- read.table("dm_data/dm_chr_maps/2L/dm_30x5x5.missing.prop.1Mb.bedgraph", header = T)
intersect.1Mb.2L <- apply(missing.prop.1Mb.2L[4:ncol(missing.prop.1Mb.2L)], 1, function(x) any(x > 0.1)) 

dm.lands.1Mb.2L <- as.data.frame(cbind(diversity.dm.1Mb.2L$chromStart,
                                        diversity.dm.1Mb.2L$chromEnd,
                                        diversity.dm.1Mb.2L$avg,
                                        theta.dm.1Mb.2L$sample_mean,
                                        rho.dm.1Mb.2L$sample_mean,
                                        tmrca.dm.1Mb.2L$sample_mean))
names(dm.lands.1Mb.2L) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.1Mb.2L$bin <- 1:nrow(dm.lands.1Mb.2L)

# filters based on missing data 
dm.lands.1Mb.2L <- dm.lands.1Mb.2L[which(intersect.1Mb.2L == F),]

dm.lands.1Mb.2L$chr <- "2L"

dm.lands.1Mb.2L$thetaS <- (dm.lands.1Mb.2L$theta - mean(dm.lands.1Mb.2L$theta)) / sd(dm.lands.1Mb.2L$theta)
dm.lands.1Mb.2L$tmrcaS <- (dm.lands.1Mb.2L$tmrca - mean(dm.lands.1Mb.2L$tmrca)) / sd(dm.lands.1Mb.2L$tmrca)
dm.lands.1Mb.2L$rhoS <- (dm.lands.1Mb.2L$rho - mean(dm.lands.1Mb.2L$rho)) / sd(dm.lands.1Mb.2L$rho)

g.div.dm.1Mb.2L <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.1Mb.2L, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.1Mb.2L)

# Chr 2R

# recombination landscapes
rho.dm.1Mb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.rho.1Mb.bedgraph", header = T)

# diversity
diversity.dm.1Mb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.diversity.1Mb.bedgraph", header = T)
diversity.dm.1Mb.2R$avg <- apply(diversity.dm.1Mb.2R[4:ncol(diversity.dm.1Mb.2R)], 1, mean)

# mutation landscapes
theta.dm.1Mb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.theta.1Mb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.1Mb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.TMRCA.1Mb.bedgraph", header = T)
tmrca.dm.1Mb.2R$sample_mean <- apply(tmrca.dm.1Mb.2R[4:ncol(tmrca.dm.1Mb.2R)], 1, mean)

# missing data
missing.prop.1Mb.2R <- read.table("dm_data/dm_chr_maps/2R/dm_30x5x5.missing.prop.1Mb.bedgraph", header = T)
intersect.1Mb.2R <- apply(missing.prop.1Mb.2R[4:ncol(missing.prop.1Mb.2R)], 1, function(x) any(x > 0.1)) 

dm.lands.1Mb.2R <- as.data.frame(cbind(diversity.dm.1Mb.2R$chromStart,
                                        diversity.dm.1Mb.2R$chromEnd,
                                        diversity.dm.1Mb.2R$avg,
                                        theta.dm.1Mb.2R$sample_mean,
                                        rho.dm.1Mb.2R$sample_mean,
                                        tmrca.dm.1Mb.2R$sample_mean))
names(dm.lands.1Mb.2R) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.1Mb.2R$bin <- 1:nrow(dm.lands.1Mb.2R)

# filters based on missing data 
dm.lands.1Mb.2R <- dm.lands.1Mb.2R[which(intersect.1Mb.2R == F),]

dm.lands.1Mb.2R$chr <- "2R"

dm.lands.1Mb.2R$thetaS <- (dm.lands.1Mb.2R$theta - mean(dm.lands.1Mb.2R$theta)) / sd(dm.lands.1Mb.2R$theta)
dm.lands.1Mb.2R$tmrcaS <- (dm.lands.1Mb.2R$tmrca - mean(dm.lands.1Mb.2R$tmrca)) / sd(dm.lands.1Mb.2R$tmrca)
dm.lands.1Mb.2R$rhoS <- (dm.lands.1Mb.2R$rho - mean(dm.lands.1Mb.2R$rho)) / sd(dm.lands.1Mb.2R$rho)

g.div.dm.1Mb.2R <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.1Mb.2R, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.1Mb.2R)

# recombination landscapes
rho.dm.1Mb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.rho.1Mb.bedgraph", header = T)

# diversity
diversity.dm.1Mb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.diversity.1Mb.bedgraph", header = T)
diversity.dm.1Mb.3L$avg <- apply(diversity.dm.1Mb.3L[4:ncol(diversity.dm.1Mb.3L)], 1, mean)

# mutation landscapes
theta.dm.1Mb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.theta.1Mb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.1Mb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.TMRCA.1Mb.bedgraph", header = T)
tmrca.dm.1Mb.3L$sample_mean <- apply(tmrca.dm.1Mb.3L[4:ncol(tmrca.dm.1Mb.3L)], 1, mean)

# missing data
missing.prop.1Mb.3L <- read.table("dm_data/dm_chr_maps/3L/dm_30x5x5.missing.prop.1Mb.bedgraph", header = T)
intersect.1Mb.3L <- apply(missing.prop.1Mb.3L[4:ncol(missing.prop.1Mb.3L)], 1, function(x) any(x > 0.1)) 

dm.lands.1Mb.3L <- as.data.frame(cbind(diversity.dm.1Mb.3L$chromStart,
                                        diversity.dm.1Mb.3L$chromEnd,
                                        diversity.dm.1Mb.3L$avg,
                                        theta.dm.1Mb.3L$sample_mean,
                                        rho.dm.1Mb.3L$sample_mean,
                                        tmrca.dm.1Mb.3L$sample_mean))
names(dm.lands.1Mb.3L) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.1Mb.3L$bin <- 1:nrow(dm.lands.1Mb.3L)

# filters based on missing data
dm.lands.1Mb.3L <- dm.lands.1Mb.3L[which(intersect.1Mb.3L == F),]

dm.lands.1Mb.3L$chr <- "3L"

dm.lands.1Mb.3L$thetaS <- (dm.lands.1Mb.3L$theta - mean(dm.lands.1Mb.3L$theta)) / sd(dm.lands.1Mb.3L$theta)
dm.lands.1Mb.3L$tmrcaS <- (dm.lands.1Mb.3L$tmrca - mean(dm.lands.1Mb.3L$tmrca)) / sd(dm.lands.1Mb.3L$tmrca)
dm.lands.1Mb.3L$rhoS <- (dm.lands.1Mb.3L$rho - mean(dm.lands.1Mb.3L$rho)) / sd(dm.lands.1Mb.3L$rho)


g.div.dm.1Mb.3L <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.1Mb.3L, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.1Mb.3L)

# Chr 3R

# recombination landscapes
rho.dm.1Mb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.rho.1Mb.bedgraph", header = T)

# diversity
diversity.dm.1Mb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.diversity.1Mb.bedgraph", header = T)
diversity.dm.1Mb.3R$avg <- apply(diversity.dm.1Mb.3R[4:ncol(diversity.dm.1Mb.3R)], 1, mean)

# mutation landscapes
theta.dm.1Mb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.theta.1Mb.bedgraph", header = T)

# TMRCA landscapes
tmrca.dm.1Mb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.TMRCA.1Mb.bedgraph", header = T)
tmrca.dm.1Mb.3R$sample_mean <- apply(tmrca.dm.1Mb.3R[4:ncol(tmrca.dm.1Mb.3R)], 1, mean)

# missing data
missing.prop.1Mb.3R <- read.table("dm_data/dm_chr_maps/3R/dm_30x5x5.missing.prop.1Mb.bedgraph", header = T)
intersect.1Mb.3R <- apply(missing.prop.1Mb[4:ncol(missing.prop.1Mb.3R)], 1, function(x) any(x > 0.1)) 

dm.lands.1Mb.3R <- as.data.frame(cbind(diversity.dm.1Mb.3R$chromStart,
                                        diversity.dm.1Mb.3R$chromEnd,
                                        diversity.dm.1Mb.3R$avg,
                                        theta.dm.1Mb.3R$sample_mean,
                                        rho.dm.1Mb.3R$sample_mean,
                                        tmrca.dm.1Mb.3R$sample_mean))
names(dm.lands.1Mb.3R) <- c("start", "end", "diversity", "theta", "rho", "tmrca")
dm.lands.1Mb.3R$bin <- 1:nrow(dm.lands.1Mb.3R)

# filters based on missing data
dm.lands.1Mb.3R <- dm.lands.1Mb.3R[which(intersect.1Mb.3R == F),]

dm.lands.1Mb.3R$chr <- "3R"

dm.lands.1Mb.3R$thetaS <- (dm.lands.1Mb.3R$theta - mean(dm.lands.1Mb.3R$theta)) / sd(dm.lands.1Mb.3R$theta)
dm.lands.1Mb.3R$tmrcaS <- (dm.lands.1Mb.3R$tmrca - mean(dm.lands.1Mb.3R$tmrca)) / sd(dm.lands.1Mb.3R$tmrca)
dm.lands.1Mb.3R$rhoS <- (dm.lands.1Mb.3R$rho - mean(dm.lands.1Mb.3R$rho)) / sd(dm.lands.1Mb.3R$rho)

g.div.dm.1Mb.3R <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                        data = dm.lands.1Mb.3R, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")

summary(g.div.dm.1Mb.3R)

# all together now
dm.lands.1Mb <- rbind.data.frame(dm.lands.1Mb.2L, dm.lands.1Mb.2R, dm.lands.1Mb.3L, dm.lands.1Mb.3R)

write.table(dm.lands.1Mb, "dm_data/dm_chr_maps/dm.maps.1Mb.tsv", quote = F, sep = "\t", row.names = F, col.names = T)

# genome-wide correlations
cor.test(~rho + diversity, data = dm.lands.1Mb, method = "spearman")
cor.test(~rho + tmrca, data = dm.lands.1Mb, method = "spearman")
cor.test(~theta + tmrca, data = dm.lands.1Mb, method = "spearman")

# Linear models
# standardizing
dm.lands.1Mb$thetaS <- (dm.lands.1Mb$theta - mean(dm.lands.1Mb$theta)) / sd(dm.lands.1Mb$theta)
dm.lands.1Mb$tmrcaS <- (dm.lands.1Mb$tmrca - mean(dm.lands.1Mb$tmrca)) / sd(dm.lands.1Mb$tmrca)
dm.lands.1Mb$rhoS <- (dm.lands.1Mb$rho - mean(dm.lands.1Mb$rho)) / sd(dm.lands.1Mb$rho)

dm.lands.1Mb$bin <- 1:nrow(dm.lands.1Mb)

m.div.dm.1Mb <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS), data = dm.lands.1Mb)

plot(resid(m.div.dm.1Mb)~fitted(m.div.dm.1Mb))
hist(resid(m.div.dm.1Mb), nclass = 30)
dwtest(m.div.dm.1Mb)
hmctest(m.div.dm.1Mb, nsim = 10000) 

summary(m.div.dm.1Mb)
vif(m.div.dm.1Mb)

# type 2 ANOVA
anova.diversity <- Anova(m.div.dm.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
anova.diversity

# GLS
g.div.dm.1Mb.1 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.1Mb, weights = varPower(0, ~tmrcaS|chr), cor = corAR1(0, ~bin|chr), method = "ML")

g.div.dm.1Mb.2 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.1Mb, weights = varPower(0, ~theta|chr), cor = corAR1(0, ~bin|chr), method = "ML")

g.div.dm.1Mb.3 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.1Mb, weights = varPower(0, ~theta|chr), method = "ML")

g.div.dm.1Mb.4 <- gls(diversity ~ (thetaS + rhoS + tmrcaS + thetaS:tmrcaS),
                       data = dm.lands.1Mb, weights = varPower(0, ~tmrcaS|chr), method = "ML")

AIC(g.div.dm.1Mb.1, g.div.dm.1Mb.2, g.div.dm.1Mb.3, g.div.dm.1Mb.4)

summary(g.div.dm.1Mb.1)

vif(g.div.dm.1Mb.1)

# Linear model without TMRCA --> rho becomes significant
g.div.dm.1Mb.5 <- gls(diversity ~ (thetaS + rhoS),
                       data = dm.lands.1Mb, weights = varPower(0, ~thetaS|chr), cor = corAR1(0, ~bin|chr), method = "ML")

summary(g.div.dm.1Mb.5)
vif(g.div.dm.1Mb.5)
```

## Divergence with D. yakuba

```{r, message=FALSE, warning=FALSE}
lands.divergence.dm <- read.table("dm_data/dm_maps_50kb_divergence.tsv", header = T, sep = "\t")
  
cor.test(lands.divergence.dm$divergence, lands.divergence.dm$theta, method = "spearman")
```

## Evolutionary (Protein) Rates

This is how we generated the table from raw data:

```{r, message=FALSE, warning=FALSE}
# loads data
dm.raw <- read.table("dm_data/dm_misc/dpgp2_Dsimulans_bpp.all.csv", header = TRUE, sep = "\t") %>%
          select(GeneID, MeanNumberSynPos, PiN, PiS, MeanNumberSynPosDiv, dS, dN) %>% na.omit()

# summarises
dm.tbl <- ddply(dm.raw, .variables = "GeneID", .fun = plyr::summarize,
                MeanNumberNonSynPos = sum(3 - MeanNumberSynPos),
                MeanNumberSynPos = sum(MeanNumberSynPos),
                PiN = sum(PiN),
                PiS = sum(PiS),
                MeanNumberNonSynPosDiv = sum(3 - MeanNumberSynPosDiv),
                MeanNumberSynPosDiv = sum(MeanNumberSynPosDiv),
                dN = sum(dN),
                dS = sum(dS))

dm.tbl$PiN <- (dm.tbl$PiN / dm.tbl$MeanNumberNonSynPos)
dm.tbl$PiS <- (dm.tbl$PiS / dm.tbl$MeanNumberSynPos)
dm.tbl$dN <- (dm.tbl$dN / dm.tbl$MeanNumberNonSynPosDiv)
dm.tbl$dS <- (dm.tbl$dS / dm.tbl$MeanNumberSynPosDiv)

# computes ratios
dm.tbl$PiN_PiS <- with(dm.tbl, PiN / PiS)
dm.tbl$dN_dS <- with(dm.tbl, dN / dS)

# we ignore genes with ratios above 1 
dm.tbl <- dm.tbl[dm.tbl$PiN_PiS < 1,]
dm.tbl <- dm.tbl[dm.tbl$dN_dS < 1,]
dm.tbl <- na.omit(dm.tbl)

dm.genes.coord <- read.table("dm_data/dm_misc/Dmel_trans_nooverlaps-final.txt", header = F) %>% select(V1, V2, V3, V5)
names(dm.genes.coord) <- c("chr", "start", "end", "GeneID")

dm.evol <- merge(dm.genes.coord, dm.tbl, by = "GeneID")
dm.evol <- arrange(dm.evol, chr, start)

# reorder maps to use GR
dm.maps.50kb <- dm.lands.50kb[,c(8,1:6)]

# mapping genes to 50kb windows in ismc maps
dm.lands.gr <- makeGRangesFromDataFrame(dm.maps.50kb)
values(dm.lands.gr) <- select(dm.maps.50kb, diversity, theta, rho, tmrca)
evolrate.gr <- makeGRangesFromDataFrame(dm.evol)
values(evolrate.gr) <- select(dm.evol, PiN, PiS, dN, dS)

hits_1 <- findOverlaps(query = evolrate.gr, subject = dm.lands.gr, type = "within") 

evolrate.gr.df <- as.data.frame(evolrate.gr[queryHits(hits_1)], row.names = NULL)
dm.lands.gr.df <- as.data.frame(dm.lands.gr[subjectHits(hits_1)], row.names = NULL)

dm.lands.evolrate <- cbind.data.frame(dm.lands.gr.df[,c(1:3,6:9)], evolrate.gr.df[,c(2:4,6:9)])

names(dm.lands.evolrate)[1] <- "chr"
names(dm.lands.evolrate)[2] <- "start.window"
names(dm.lands.evolrate)[3] <- "end.window"
names(dm.lands.evolrate)[8] <- "start.gene"
names(dm.lands.evolrate)[9] <- "end.gene"
names(dm.lands.evolrate)[10] <- "length.gene"

dm.lands.evolrate <- arrange(dm.lands.evolrate, chr, start.window, start.gene)

dm.lands.evolrate.bins <- ddply(dm.lands.evolrate, .variables = c("chr", "start.window"), .fun = plyr::summarize,
                               diversity = mean(diversity),
                               theta = mean(theta),
                               rho = mean(rho),
                               tmrca = mean(tmrca),
                               exonic.sites = sum(length.gene),
                               PiN.window = sum(PiN*length.gene) / sum(length.gene),
                               PiS.window = sum(PiS*length.gene) / sum(length.gene),
                               dN.window = sum(dN*length.gene) / sum(length.gene),
                               dS.window = sum(dS*length.gene) / sum(length.gene))


dm.lands.evolrate.bins$bin <- 1:nrow(dm.lands.evolrate.bins)

write.table(dm.lands.evolrate.bins, "dm_data/dm_chr_maps/dm_maps_50kb_protein_rates.tsv",
            sep = "\t", quote = F, col.names = T, row.names = F)
```

We can read the table generated and move on with the analyses:

```{r, message=FALSE, warning=FALSE}
dm.lands.evolrate.bins <- read.table("dm_data/dm_chr_maps/dm_maps_50kb_protein_rates.tsv", header = T, sep = "\t")

# linear model in windows with more than 20kb exonic sites
dm.lands.genes <- filter(dm.lands.evolrate.bins, exonic.sites > 2e+4)

# standardizing
dm.lands.genes$thetaS <- (dm.lands.genes$theta - mean(dm.lands.genes$theta))
dm.lands.genes$tmrcaS <- (dm.lands.genes$tmrca - mean(dm.lands.genes$tmrca))
dm.lands.genes$rhoS <- (dm.lands.genes$rho - mean(dm.lands.genes$rho))

m.dm.cds.1 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS*tmrcaS), data = dm.lands.genes)
m.dm.cds.2 <- lm(diversity ~ (thetaS + rhoS + tmrcaS + thetaS*tmrcaS + rhoS*tmrcaS), data = dm.lands.genes)

AIC(m.dm.cds.1, m.dm.cds.2)

summary(m.dm.cds.2)

# picking best OLS for ANOVA
plot(resid(m.dm.cds.2)~fitted(m.dm.cds.2))
hist(resid(m.dm.cds.2), nclass = 30)
dwtest(m.dm.cds.2)
hmctest(m.dm.cds.2, nsim = 10000) 

summary(m.dm.cds.2)

# type 2 anova
anova.diversity.cds <- Anova(m.dm.cds.2)
apiss <- anova.diversity.cds$"Sum Sq"
anova.diversity.cds$VarExp <- apiss / sum(apiss)

anova.diversity.cds

# simple correlations
cor.test(dm.lands.evolrate.bins$theta, dm.lands.evolrate.bins$exonic.sites, method = "spearman")
cor.test(dm.lands.evolrate.bins$tmrca, dm.lands.evolrate.bins$exonic.sites, method = "spearman")
pcor.test(dm.lands.evolrate.bins$tmrca, dm.lands.evolrate.bins$exonic.sites, dm.lands.evolrate.bins$theta, method = "spearman")
pcor.test(dm.lands.evolrate.bins$theta, dm.lands.evolrate.bins$exonic.sites, dm.lands.evolrate.bins$tmrca, method = "spearman")

cor.test(dm.lands.evolrate.bins$PiN, dm.lands.evolrate.bins$theta, method = "spearman") 
cor.test(dm.lands.evolrate.bins$PiS, dm.lands.evolrate.bins$theta, method = "spearman") 

pcor.test(dm.lands.evolrate.bins$PiN, dm.lands.evolrate.bins$theta, dm.lands.evolrate.bins$tmrca, method = "spearman") 
pcor.test(dm.lands.evolrate.bins$PiS, dm.lands.evolrate.bins$theta, dm.lands.evolrate.bins$tmrca, method = "spearman") 

# bootstrapping PiN and PiS correlations
boot.tbl <- dm.lands.evolrate.bins %>% dplyr::select(PiN.window, theta, PiS.window, tmrca)
boot.PiN.theta <- boot(boot.tbl, 
  statistic = function(boot.tbl, i) {
    pcor.test(boot.tbl[i, "PiN.window"], boot.tbl[i, "theta"], boot.tbl[i, "tmrca"], method='spearman')$estimate
  },
  R = 10000
)
boot.ci(boot.PiN.theta, type = "basic")

boot.PiS.theta <- boot(boot.tbl, 
  statistic = function(boot.tbl, i) {
    pcor.test(boot.tbl[i, "PiS.window"], boot.tbl[i, "theta"], boot.tbl[i, "tmrca"], method='spearman')$estimate
  },
  R = 10000
)
boot.ci(boot.PiS.theta, type = "basic")
```

# R^2 plot with real, simulated (true) and simulated (inferred) data.

```{r, message=FALSE, warning=FALSE}
# true landscapes
r2.sim.avg <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
r2.sim.avg$bin.size <- c(50, 200, 1000)

# inferred landscapes
r2.inf.avg <- rbind.data.frame(r2.inf.50kb$average, r2.inf.200kb$average, r2.inf.1Mb$average, make.row.names = F)
colnames(r2.inf.avg) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
r2.inf.avg$bin.size <- c(50, 200, 1000)
  
r2.tab.comb <- rbind.data.frame(r2.dm.tab, r2.sim.avg, r2.inf.avg)
r2.tab.comb$type <- c(rep("iSMC-inferred (Drosophila)", 3), rep("True landscapes (simulations)", 3), rep("iSMC-inferred (simulations)", 3))

molten.r2 <- melt(r2.tab.comb, id.vars = c("bin.size", "type"))
r2.coal.plot <- ggplot(data = molten.r2, aes(x = bin.size, y = value, shape = variable))
r2.coal.plot <- r2.coal.plot + geom_line(data = molten.r2)
r2.coal.plot <- r2.coal.plot + geom_point(aes(shape = variable), size = 4) + facet_wrap(~type)
r2.coal.plot <- r2.coal.plot + scale_x_continuous(breaks = c(50, 200, 1000), trans="log10") 
r2.coal.plot <- r2.coal.plot + scale_y_continuous(breaks = pretty_breaks())
r2.coal.plot <- r2.coal.plot + scale_shape_manual(values = c(0, 1, 2, 3, 4))
r2.coal.plot <- r2.coal.plot + labs(title = NULL, x = NULL, y = "Variance Explained (%)") 
r2.coal.plot <- r2.coal.plot + theme_bw()
r2.coal.plot <- r2.coal.plot + theme(axis.title = element_text(size = 20), axis.text = element_text(size = 16),
                                     strip.text.x = element_text(size = 16), legend.position = "none")
r2.coal.plot
```


# Simulations with BGS and Gamma Mutation Landscape in SLiM

```{r, message=FALSE, warning=FALSE}
cor.table.theta <- as.data.frame(matrix(ncol = 3, nrow = nreps))
row.names(cor.table.theta) <- reps
colnames(cor.table.theta) <- c("50kb", "200kb", "1Mb")

cor.table.rho <- as.data.frame(matrix(ncol = 3, nrow = nreps))
row.names(cor.table.rho) <- reps
colnames(cor.table.rho) <- c("50kb", "200kb", "1Mb")

cor.table.tmrca <- as.data.frame(matrix(ncol = 3, nrow = nreps))
row.names(cor.table.tmrca) <- reps
colnames(cor.table.tmrca) <- c("50kb", "200kb", "1Mb")
```

## 50 kb scale

```{r, message=FALSE, warning=FALSE}
r2.bgs.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.bgs.50kb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.bgs.50kb) <- reps

r2.bgs.50kb.true <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.bgs.50kb.true) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.bgs.50kb.true) <- reps

sim.theta.50kb <- read.table("dm_bgs_sims/MutationMap_50kb.csv", sep = ",", header = T)
sim.rho.50kb <- read.table("dm_bgs_sims/RecombinationMap_50kb.csv", sep = ",", header = T)
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
rep1.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep1_w50000.csv", sep = ",", header = T)

rep_1.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.diversity.50kb.bedgraph", header = T)
rep_1.pi.50kb$avg <- apply(rep_1.pi.50kb[4:ncol(rep_1.pi.50kb)], 1, mean)
rep_1.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.rho.50kb.bedgraph", header = T)
rep_1.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.theta.50kb.bedgraph", header = T)
rep_1.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.TMRCA.50kb.bedgraph", header = T)
rep_1.tmrca.50kb$avg <- apply(rep_1.tmrca.50kb[4:ncol(rep_1.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep1 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep1.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep1) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep1$thetaS <- (true.lands.50kb.rep1$theta - mean(true.lands.50kb.rep1$theta)) / sd(true.lands.50kb.rep1$theta)
true.lands.50kb.rep1$tmrcaS <- (true.lands.50kb.rep1$tmrca - mean(true.lands.50kb.rep1$tmrca)) / sd(true.lands.50kb.rep1$tmrca)
true.lands.50kb.rep1$rhoS <- (true.lands.50kb.rep1$rho - mean(true.lands.50kb.rep1$rho, na.rm = T)) / sd(true.lands.50kb.rep1$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep1)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 1] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 1] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 1] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 1] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep1 <- as.data.frame(cbind(rep_1.pi.50kb$avg, rep_1.theta.50kb$sample_mean, rep_1.tmrca.50kb$avg, rep_1.rho.50kb$sample_mean))
names(inf.lands.50kb.rep1) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[1, 1] <- cor.test(sim.theta.50kb$Rate, rep_1.theta.50kb$sample_mean, method = "spearman")$estimate 
cor.table.rho[1, 1] <- cor.test(sim.rho.50kb$Rate, rep_1.rho.50kb$sample_mean, method = "spearman")$estimate 
cor.table.tmrca[1, 1] <- cor.test(rep1.sim.tmrca.50kb$AverageTmrca, rep_1.tmrca.50kb$avg, method = "spearman")$estimate 

# standardizing
inf.lands.50kb.rep1$thetaS <- (inf.lands.50kb.rep1$theta - mean(inf.lands.50kb.rep1$theta)) / sd(inf.lands.50kb.rep1$theta)
inf.lands.50kb.rep1$tmrcaS <- (inf.lands.50kb.rep1$tmrca - mean(inf.lands.50kb.rep1$tmrca)) / sd(inf.lands.50kb.rep1$tmrca)
inf.lands.50kb.rep1$rhoS <- (inf.lands.50kb.rep1$rho - mean(inf.lands.50kb.rep1$rho)) / sd(inf.lands.50kb.rep1$rho)

inf.lands.50kb.rep1$bin <- 1:nrow(inf.lands.50kb.rep1)
inf.lands.50kb.rep1$Replicate <- 1

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep1)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep1)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep1)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb.2)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 1] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep1, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep1, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep1, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep1, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.1)
vif(g.div.50kb.1)
```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
rep2.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep2_w50000.csv", sep = ",", header = T)

rep_2.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.diversity.50kb.bedgraph", header = T)
rep_2.pi.50kb$avg <- apply(rep_2.pi.50kb[4:ncol(rep_2.pi.50kb)], 1, mean)
rep_2.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.rho.50kb.bedgraph", header = T)
rep_2.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.theta.50kb.bedgraph", header = T)
rep_2.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.TMRCA.50kb.bedgraph", header = T)
rep_2.tmrca.50kb$avg <- apply(rep_2.tmrca.50kb[4:ncol(rep_2.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep2 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep2.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep2) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep2$thetaS <- (true.lands.50kb.rep2$theta - mean(true.lands.50kb.rep2$theta)) / sd(true.lands.50kb.rep2$theta)
true.lands.50kb.rep2$tmrcaS <- (true.lands.50kb.rep2$tmrca - mean(true.lands.50kb.rep2$tmrca)) / sd(true.lands.50kb.rep2$tmrca)
true.lands.50kb.rep2$rhoS <- (true.lands.50kb.rep2$rho - mean(true.lands.50kb.rep2$rho, na.rm = T)) / sd(true.lands.50kb.rep2$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep2)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 2] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 2] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 2] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 2] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep2 <- as.data.frame(cbind(rep_2.pi.50kb$avg, rep_2.theta.50kb$sample_mean, rep_2.tmrca.50kb$avg, rep_2.rho.50kb$sample_mean))
names(inf.lands.50kb.rep2) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[2, 1] <- cor.test(sim.theta.50kb$Rate, rep_2.theta.50kb$sample_mean, method = "spearman")$estimate 
cor.table.rho[2, 1] <- cor.test(sim.rho.50kb$Rate, rep_2.rho.50kb$sample_mean, method = "spearman")$estimate 
cor.table.tmrca[2, 1] <- cor.test(rep2.sim.tmrca.50kb$AverageTmrca, rep_2.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep2$thetaS <- (inf.lands.50kb.rep2$theta - mean(inf.lands.50kb.rep2$theta)) / sd(inf.lands.50kb.rep2$theta)
inf.lands.50kb.rep2$tmrcaS <- (inf.lands.50kb.rep2$tmrca - mean(inf.lands.50kb.rep2$tmrca)) / sd(inf.lands.50kb.rep2$tmrca)
inf.lands.50kb.rep2$rhoS <- (inf.lands.50kb.rep2$rho - mean(inf.lands.50kb.rep2$rho)) / sd(inf.lands.50kb.rep2$rho)

inf.lands.50kb.rep2$bin <- 1:nrow(inf.lands.50kb.rep2)
inf.lands.50kb.rep2$Replicate <- 2

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep2)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep2)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep2)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 2] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep2, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep2, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep2, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep2, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.1)
vif(g.div.50kb.1)
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
rep3.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep3_w50000.csv", sep = ",", header = T)

rep_3.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.diversity.50kb.bedgraph", header = T)
rep_3.pi.50kb$avg <- apply(rep_3.pi.50kb[4:ncol(rep_3.pi.50kb)], 1, mean)
rep_3.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.rho.50kb.bedgraph", header = T)
rep_3.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.theta.50kb.bedgraph", header = T)
rep_3.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.TMRCA.50kb.bedgraph", header = T)
rep_3.tmrca.50kb$avg <- apply(rep_3.tmrca.50kb[4:ncol(rep_3.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep3 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep3.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep3) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep3$thetaS <- (true.lands.50kb.rep3$theta - mean(true.lands.50kb.rep3$theta)) / sd(true.lands.50kb.rep3$theta)
true.lands.50kb.rep3$tmrcaS <- (true.lands.50kb.rep3$tmrca - mean(true.lands.50kb.rep3$tmrca)) / sd(true.lands.50kb.rep3$tmrca)
true.lands.50kb.rep3$rhoS <- (true.lands.50kb.rep3$rho - mean(true.lands.50kb.rep3$rho, na.rm = T)) / sd(true.lands.50kb.rep3$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep3)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 3] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 3] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 3] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 3] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep3 <- as.data.frame(cbind(rep_3.pi.50kb$avg, rep_3.theta.50kb$sample_mean, rep_3.tmrca.50kb$avg, rep_3.rho.50kb$sample_mean))
names(inf.lands.50kb.rep3) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[3, 1] <- cor.test(sim.theta.50kb$Rate, rep_3.theta.50kb$sample_mean, method = "spearman")$estimate 
cor.table.rho[3, 1] <- cor.test(sim.rho.50kb$Rate, rep_3.rho.50kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[3, 1] <- cor.test(rep3.sim.tmrca.50kb$AverageTmrca, rep_3.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep3$thetaS <- (inf.lands.50kb.rep3$theta - mean(inf.lands.50kb.rep3$theta)) / sd(inf.lands.50kb.rep3$theta)
inf.lands.50kb.rep3$tmrcaS <- (inf.lands.50kb.rep3$tmrca - mean(inf.lands.50kb.rep3$tmrca)) / sd(inf.lands.50kb.rep3$tmrca)
inf.lands.50kb.rep3$rhoS <- (inf.lands.50kb.rep3$rho - mean(inf.lands.50kb.rep3$rho)) / sd(inf.lands.50kb.rep3$rho)

inf.lands.50kb.rep3$bin <- 1:nrow(inf.lands.50kb.rep3)
inf.lands.50kb.rep3$Replicate <- 3

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep3)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep3)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep3)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 3] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep3, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep3, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep3, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep3, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.1)
vif(g.div.50kb.1)
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
rep4.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep4_w50000.csv", sep = ",", header = T)

rep_4.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.diversity.50kb.bedgraph", header = T)
rep_4.pi.50kb$avg <- apply(rep_4.pi.50kb[4:ncol(rep_4.pi.50kb)], 1, mean)
rep_4.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.rho.50kb.bedgraph", header = T)
rep_4.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.theta.50kb.bedgraph", header = T)
rep_4.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.TMRCA.50kb.bedgraph", header = T)
rep_4.tmrca.50kb$avg <- apply(rep_4.tmrca.50kb[4:ncol(rep_4.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep4 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep4.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep4) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep4$thetaS <- (true.lands.50kb.rep4$theta - mean(true.lands.50kb.rep4$theta)) / sd(true.lands.50kb.rep4$theta)
true.lands.50kb.rep4$tmrcaS <- (true.lands.50kb.rep4$tmrca - mean(true.lands.50kb.rep4$tmrca)) / sd(true.lands.50kb.rep4$tmrca)
true.lands.50kb.rep4$rhoS <- (true.lands.50kb.rep4$rho - mean(true.lands.50kb.rep4$rho, na.rm = T)) / sd(true.lands.50kb.rep4$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep4)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 4] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 4] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 4] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 4] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep4 <- as.data.frame(cbind(rep_4.pi.50kb$avg, rep_4.theta.50kb$sample_mean, rep_4.tmrca.50kb$avg, rep_4.rho.50kb$sample_mean))
names(inf.lands.50kb.rep4) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[4, 1] <- cor.test(sim.theta.50kb$Rate, rep_4.theta.50kb$sample_mean, method = "spearman")$estimate
cor.table.rho[4, 1] <- cor.test(sim.rho.50kb$Rate, rep_4.rho.50kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[4, 1] <- cor.test(rep4.sim.tmrca.50kb$AverageTmrca, rep_4.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep4$thetaS <- (inf.lands.50kb.rep4$theta - mean(inf.lands.50kb.rep4$theta)) / sd(inf.lands.50kb.rep4$theta)
inf.lands.50kb.rep4$tmrcaS <- (inf.lands.50kb.rep4$tmrca - mean(inf.lands.50kb.rep4$tmrca)) / sd(inf.lands.50kb.rep4$tmrca)
inf.lands.50kb.rep4$rhoS <- (inf.lands.50kb.rep4$rho - mean(inf.lands.50kb.rep4$rho)) / sd(inf.lands.50kb.rep4$rho)

inf.lands.50kb.rep4$bin <- 1:nrow(inf.lands.50kb.rep4)
inf.lands.50kb.rep4$Replicate <- 4

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep4)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep4)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep4)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb.2)~fitted(m.div.50kb.2))
dwtest(m.div.50kb.2)
hmctest(m.div.50kb.2)
hist(resid(m.div.50kb.2))

summary(m.div.50kb.2)
vif(m.div.50kb.2)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 4] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep4, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep4, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep4, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep4, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.3)
vif(g.div.50kb.3)
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
rep5.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep5_w50000.csv", sep = ",", header = T)

rep_5.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.diversity.50kb.bedgraph", header = T)
rep_5.pi.50kb$avg <- apply(rep_5.pi.50kb[4:ncol(rep_5.pi.50kb)], 1, mean)
rep_5.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.rho.50kb.bedgraph", header = T)
rep_5.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.theta.50kb.bedgraph", header = T)
rep_5.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.TMRCA.50kb.bedgraph", header = T)
rep_5.tmrca.50kb$avg <- apply(rep_5.tmrca.50kb[4:ncol(rep_5.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep5 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep5.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep5) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep5$thetaS <- (true.lands.50kb.rep5$theta - mean(true.lands.50kb.rep5$theta)) / sd(true.lands.50kb.rep5$theta)
true.lands.50kb.rep5$tmrcaS <- (true.lands.50kb.rep5$tmrca - mean(true.lands.50kb.rep5$tmrca)) / sd(true.lands.50kb.rep5$tmrca)
true.lands.50kb.rep5$rhoS <- (true.lands.50kb.rep5$rho - mean(true.lands.50kb.rep5$rho, na.rm = T)) / sd(true.lands.50kb.rep5$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep5)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 5] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 5] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 5] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 5] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep5 <- as.data.frame(cbind(rep_5.pi.50kb$avg, rep_5.theta.50kb$sample_mean, rep_5.tmrca.50kb$avg, rep_5.rho.50kb$sample_mean))
names(inf.lands.50kb.rep5) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[5, 1] <- cor.test(sim.theta.50kb$Rate, rep_5.theta.50kb$sample_mean, method = "spearman")$estimate
cor.table.rho[5, 1] <- cor.test(sim.rho.50kb$Rate, rep_5.rho.50kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[5, 1] <- cor.test(rep5.sim.tmrca.50kb$AverageTmrca, rep_5.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep5$thetaS <- (inf.lands.50kb.rep5$theta - mean(inf.lands.50kb.rep5$theta)) / sd(inf.lands.50kb.rep5$theta)
inf.lands.50kb.rep5$tmrcaS <- (inf.lands.50kb.rep5$tmrca - mean(inf.lands.50kb.rep5$tmrca)) / sd(inf.lands.50kb.rep5$tmrca)
inf.lands.50kb.rep5$rhoS <- (inf.lands.50kb.rep5$rho - mean(inf.lands.50kb.rep5$rho)) / sd(inf.lands.50kb.rep5$rho)

inf.lands.50kb.rep5$bin <- 1:nrow(inf.lands.50kb.rep5)
inf.lands.50kb.rep5$Replicate <- 5

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep5)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep5)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep5)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 5] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep5, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep5, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep5, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep5, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.4)
vif(g.div.50kb.4)
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
rep6.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep6_w50000.csv", sep = ",", header = T)

rep_6.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.diversity.50kb.bedgraph", header = T)
rep_6.pi.50kb$avg <- apply(rep_6.pi.50kb[4:ncol(rep_6.pi.50kb)], 1, mean)
rep_6.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.rho.50kb.bedgraph", header = T)
rep_6.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.theta.50kb.bedgraph", header = T)
rep_6.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.TMRCA.50kb.bedgraph", header = T)
rep_6.tmrca.50kb$avg <- apply(rep_6.tmrca.50kb[4:ncol(rep_6.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep6 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep6.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep6) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep6$thetaS <- (true.lands.50kb.rep6$theta - mean(true.lands.50kb.rep6$theta)) / sd(true.lands.50kb.rep6$theta)
true.lands.50kb.rep6$tmrcaS <- (true.lands.50kb.rep6$tmrca - mean(true.lands.50kb.rep6$tmrca)) / sd(true.lands.50kb.rep6$tmrca)
true.lands.50kb.rep6$rhoS <- (true.lands.50kb.rep6$rho - mean(true.lands.50kb.rep6$rho, na.rm = T)) / sd(true.lands.50kb.rep6$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep6)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 6] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 6] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 6] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 6] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep6 <- as.data.frame(cbind(rep_6.pi.50kb$avg, rep_6.theta.50kb$sample_mean, rep_6.tmrca.50kb$avg, rep_6.rho.50kb$sample_mean))
names(inf.lands.50kb.rep6) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[6, 1] <- cor.test(sim.theta.50kb$Rate, rep_6.theta.50kb$sample_mean, method = "spearman")$estimate
cor.table.rho[6, 1] <- cor.test(sim.rho.50kb$Rate, rep_6.rho.50kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[6, 1] <- cor.test(rep6.sim.tmrca.50kb$AverageTmrca, rep_6.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep6$thetaS <- (inf.lands.50kb.rep6$theta - mean(inf.lands.50kb.rep6$theta)) / sd(inf.lands.50kb.rep6$theta)
inf.lands.50kb.rep6$tmrcaS <- (inf.lands.50kb.rep6$tmrca - mean(inf.lands.50kb.rep6$tmrca)) / sd(inf.lands.50kb.rep6$tmrca)
inf.lands.50kb.rep6$rhoS <- (inf.lands.50kb.rep6$rho - mean(inf.lands.50kb.rep6$rho)) / sd(inf.lands.50kb.rep6$rho)

inf.lands.50kb.rep6$bin <- 1:nrow(inf.lands.50kb.rep6)
inf.lands.50kb.rep6$Replicate <- 6

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep6)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep6)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep6)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 6] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep6, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep6, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep6, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep6, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.3)
vif(g.div.50kb.3)
```

### Replicate 7

```{r, message=FALSE, warning=FALSE}
rep7.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep7_w50000.csv", sep = ",", header = T)

rep_7.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.diversity.50kb.bedgraph", header = T)
rep_7.pi.50kb$avg <- apply(rep_7.pi.50kb[4:ncol(rep_7.pi.50kb)], 1, mean)
rep_7.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.rho.50kb.bedgraph", header = T)
rep_7.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.theta.50kb.bedgraph", header = T)
rep_7.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.TMRCA.50kb.bedgraph", header = T)
rep_7.tmrca.50kb$avg <- apply(rep_7.tmrca.50kb[4:ncol(rep_7.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep7 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep7.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep7) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep7$thetaS <- (true.lands.50kb.rep7$theta - mean(true.lands.50kb.rep7$theta)) / sd(true.lands.50kb.rep7$theta)
true.lands.50kb.rep7$tmrcaS <- (true.lands.50kb.rep7$tmrca - mean(true.lands.50kb.rep7$tmrca)) / sd(true.lands.50kb.rep7$tmrca)
true.lands.50kb.rep7$rhoS <- (true.lands.50kb.rep7$rho - mean(true.lands.50kb.rep7$rho, na.rm = T)) / sd(true.lands.50kb.rep7$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep7)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 7] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 7] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 7] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 7] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep7 <- as.data.frame(cbind(rep_7.pi.50kb$avg, rep_7.theta.50kb$sample_mean, rep_7.tmrca.50kb$avg, rep_7.rho.50kb$sample_mean))
names(inf.lands.50kb.rep7) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[7, 1] <- cor.test(sim.theta.50kb$Rate, rep_7.theta.50kb$sample_mean, method = "spearman")$estimate
cor.table.rho[7, 1] <- cor.test(sim.rho.50kb$Rate, rep_7.rho.50kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[7, 1] <- cor.test(rep7.sim.tmrca.50kb$AverageTmrca, rep_7.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep7$thetaS <- (inf.lands.50kb.rep7$theta - mean(inf.lands.50kb.rep7$theta)) / sd(inf.lands.50kb.rep7$theta)
inf.lands.50kb.rep7$tmrcaS <- (inf.lands.50kb.rep7$tmrca - mean(inf.lands.50kb.rep7$tmrca)) / sd(inf.lands.50kb.rep7$tmrca)
inf.lands.50kb.rep7$rhoS <- (inf.lands.50kb.rep7$rho - mean(inf.lands.50kb.rep7$rho)) / sd(inf.lands.50kb.rep7$rho)

inf.lands.50kb.rep7$bin <- 1:nrow(inf.lands.50kb.rep7)

inf.lands.50kb.rep7$Replicate <- 7

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep7)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep7)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep7)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 7] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep7, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep7, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep7, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep7, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.4)
vif(g.div.50kb.4)
```

### Replicate 8

```{r, message=FALSE, warning=FALSE}
rep8.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep8_w50000.csv", sep = ",", header = T)

rep_8.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.diversity.50kb.bedgraph", header = T)
rep_8.pi.50kb$avg <- apply(rep_8.pi.50kb[4:ncol(rep_8.pi.50kb)], 1, mean)
rep_8.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.rho.50kb.bedgraph", header = T)
rep_8.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.theta.50kb.bedgraph", header = T)
rep_8.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.TMRCA.50kb.bedgraph", header = T)
rep_8.tmrca.50kb$avg <- apply(rep_8.tmrca.50kb[4:ncol(rep_8.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep8 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep8.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep8) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep8$thetaS <- (true.lands.50kb.rep8$theta - mean(true.lands.50kb.rep8$theta)) / sd(true.lands.50kb.rep8$theta)
true.lands.50kb.rep8$tmrcaS <- (true.lands.50kb.rep8$tmrca - mean(true.lands.50kb.rep8$tmrca)) / sd(true.lands.50kb.rep8$tmrca)
true.lands.50kb.rep8$rhoS <- (true.lands.50kb.rep8$rho - mean(true.lands.50kb.rep8$rho, na.rm = T)) / sd(true.lands.50kb.rep8$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep8)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 8] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 8] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 8] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 8] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep8 <- as.data.frame(cbind(rep_8.pi.50kb$avg, rep_8.theta.50kb$sample_mean, rep_8.tmrca.50kb$avg, rep_8.rho.50kb$sample_mean))
names(inf.lands.50kb.rep8) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[8, 1] <- cor.test(sim.theta.50kb$Rate, rep_8.theta.50kb$sample_mean, method = "spearman")$estimate
cor.table.rho[8, 1] <- cor.test(sim.rho.50kb$Rate, rep_8.rho.50kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[8, 1] <- cor.test(rep8.sim.tmrca.50kb$AverageTmrca, rep_8.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep8$thetaS <- (inf.lands.50kb.rep8$theta - mean(inf.lands.50kb.rep8$theta)) / sd(inf.lands.50kb.rep8$theta)
inf.lands.50kb.rep8$tmrcaS <- (inf.lands.50kb.rep8$tmrca - mean(inf.lands.50kb.rep8$tmrca)) / sd(inf.lands.50kb.rep8$tmrca)
inf.lands.50kb.rep8$rhoS <- (inf.lands.50kb.rep8$rho - mean(inf.lands.50kb.rep8$rho)) / sd(inf.lands.50kb.rep8$rho)

inf.lands.50kb.rep8$bin <- 1:nrow(inf.lands.50kb.rep8)
inf.lands.50kb.rep8$Replicate <- 8

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep8)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep8)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep8)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 8] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep8, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep8, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep8, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep8, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.4)
vif(g.div.50kb.4)
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
rep9.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep9_w50000.csv", sep = ",", header = T)

rep_9.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.diversity.50kb.bedgraph", header = T)
rep_9.pi.50kb$avg <- apply(rep_9.pi.50kb[4:ncol(rep_9.pi.50kb)], 1, mean)
rep_9.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.rho.50kb.bedgraph", header = T)
rep_9.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.theta.50kb.bedgraph", header = T)
rep_9.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.TMRCA.50kb.bedgraph", header = T)
rep_9.tmrca.50kb$avg <- apply(rep_9.tmrca.50kb[4:ncol(rep_9.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep9 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep9.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep9) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep9$thetaS <- (true.lands.50kb.rep9$theta - mean(true.lands.50kb.rep9$theta)) / sd(true.lands.50kb.rep9$theta)
true.lands.50kb.rep9$tmrcaS <- (true.lands.50kb.rep9$tmrca - mean(true.lands.50kb.rep9$tmrca)) / sd(true.lands.50kb.rep9$tmrca)
true.lands.50kb.rep9$rhoS <- (true.lands.50kb.rep9$rho - mean(true.lands.50kb.rep9$rho, na.rm = T)) / sd(true.lands.50kb.rep9$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep9)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 9] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 9] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 9] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 9] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep9 <- as.data.frame(cbind(rep_9.pi.50kb$avg, rep_9.theta.50kb$sample_mean, rep_9.tmrca.50kb$avg, rep_9.rho.50kb$sample_mean))
names(inf.lands.50kb.rep9) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[9, 1] <- cor.test(sim.theta.50kb$Rate, rep_9.theta.50kb$sample_mean, method = "spearman")$estimate
cor.table.rho[9, 1] <- cor.test(sim.rho.50kb$Rate, rep_9.rho.50kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[9, 1] <- cor.test(rep9.sim.tmrca.50kb$AverageTmrca, rep_9.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep9$thetaS <- (inf.lands.50kb.rep9$theta - mean(inf.lands.50kb.rep9$theta)) / sd(inf.lands.50kb.rep9$theta)
inf.lands.50kb.rep9$tmrcaS <- (inf.lands.50kb.rep9$tmrca - mean(inf.lands.50kb.rep9$tmrca)) / sd(inf.lands.50kb.rep9$tmrca)
inf.lands.50kb.rep9$rhoS <- (inf.lands.50kb.rep9$rho - mean(inf.lands.50kb.rep9$rho)) / sd(inf.lands.50kb.rep9$rho)

inf.lands.50kb.rep9$bin <- 1:nrow(inf.lands.50kb.rep9)
inf.lands.50kb.rep9$Replicate <- 9

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep9)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep9)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep9)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 9] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep9, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep9, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep9, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep9, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.4)
vif(g.div.50kb.4)
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
rep10.sim.tmrca.50kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep10_w50000.csv", sep = ",", header = T)

rep_10.pi.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.diversity.50kb.bedgraph", header = T)
rep_10.pi.50kb$avg <- apply(rep_10.pi.50kb[4:ncol(rep_10.pi.50kb)], 1, mean)
rep_10.rho.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.rho.50kb.bedgraph", header = T)
rep_10.theta.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.theta.50kb.bedgraph", header = T)
rep_10.tmrca.50kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.TMRCA.50kb.bedgraph", header = T)
rep_10.tmrca.50kb$avg <- apply(rep_10.tmrca.50kb[4:ncol(rep_10.tmrca.50kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.50kb.rep10 <- as.data.frame(cbind(rep_1.pi.50kb$avg, sim.theta.50kb$Rate, rep10.sim.tmrca.50kb$AverageTmrca, sim.rho.50kb$Rate))
names(true.lands.50kb.rep10) <- c("diversity", "theta", "tmrca", "rho")

true.lands.50kb.rep10$thetaS <- (true.lands.50kb.rep10$theta - mean(true.lands.50kb.rep10$theta)) / sd(true.lands.50kb.rep10$theta)
true.lands.50kb.rep10$tmrcaS <- (true.lands.50kb.rep10$tmrca - mean(true.lands.50kb.rep10$tmrca)) / sd(true.lands.50kb.rep10$tmrca)
true.lands.50kb.rep10$rhoS <- (true.lands.50kb.rep10$rho - mean(true.lands.50kb.rep10$rho, na.rm = T)) / sd(true.lands.50kb.rep10$rho, na.rm = T)

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.50kb.rep10)
anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.50kb.true[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb.true[2, 10] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb.true[3, 10] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb.true[4, 10] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb.true[5, 10] <- anova.diversity$VarExp[4] * 100

summary(m.div.50kb)
vif(m.div.50kb)

# now the lm with inferred landscapes
inf.lands.50kb.rep10 <- as.data.frame(cbind(rep_10.pi.50kb$avg, rep_10.theta.50kb$sample_mean, rep_10.tmrca.50kb$avg, rep_1.rho.50kb$sample_mean))
names(inf.lands.50kb.rep10) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[10, 1] <- cor.test(sim.theta.50kb$Rate, rep_10.theta.50kb$sample_mean, method = "spearman")$estimate
cor.table.rho[10, 1] <- cor.test(sim.rho.50kb$Rate, rep_10.rho.50kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[10, 1] <- cor.test(rep10.sim.tmrca.50kb$AverageTmrca, rep_10.tmrca.50kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.50kb.rep10$thetaS <- (inf.lands.50kb.rep10$theta - mean(inf.lands.50kb.rep10$theta)) /  sd(inf.lands.50kb.rep10$theta)
inf.lands.50kb.rep10$tmrcaS <- (inf.lands.50kb.rep10$tmrca - mean(inf.lands.50kb.rep10$tmrca)) / sd(inf.lands.50kb.rep10$tmrca)
inf.lands.50kb.rep10$rhoS <- (inf.lands.50kb.rep10$rho - mean(inf.lands.50kb.rep10$rho)) / sd(inf.lands.50kb.rep10$rho)

inf.lands.50kb.rep10$bin <- 1:nrow(inf.lands.50kb.rep10)
inf.lands.50kb.rep10$Replicate <- 10

m.div.50kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep10)
m.div.50kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.50kb.rep10)
m.div.50kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.50kb.rep10)

AIC(m.div.50kb, m.div.50kb.2, m.div.50kb.3)

plot(resid(m.div.50kb)~fitted(m.div.50kb))
dwtest(m.div.50kb)
hmctest(m.div.50kb)
hist(resid(m.div.50kb))

summary(m.div.50kb)
vif(m.div.50kb)

anova.diversity <- Anova(m.div.50kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.50kb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.50kb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.bgs.50kb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.bgs.50kb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.bgs.50kb[5, 10] <- anova.diversity$VarExp[4] * 100

g.div.50kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep10, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep10, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.50kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep10, weights = varPower(0, ~theta), method = "ML")
g.div.50kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.50kb.rep10, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.50kb.1, g.div.50kb.2, g.div.50kb.3, g.div.50kb.4)

summary(g.div.50kb.4)
vif(g.div.50kb.4)
```

## all replicates:

```{r, message=FALSE, warning=FALSE}
theta.plot <- as.data.frame(cbind(1:nrow(sim.theta.50kb),
                                sim.theta.50kb$Rate * 1e-7 * 3e+4, 
                                rep_1.theta.50kb$sample_mean,
                                rep_2.theta.50kb$sample_mean,
                                rep_3.theta.50kb$sample_mean,
                                rep_4.theta.50kb$sample_mean,
                                rep_5.theta.50kb$sample_mean,
                                rep_6.theta.50kb$sample_mean,
                                rep_7.theta.50kb$sample_mean,
                                rep_8.theta.50kb$sample_mean,
                                rep_9.theta.50kb$sample_mean,
                                rep_10.theta.50kb$sample_mean))

names(theta.plot) <- c("bin", "sim", reps)
molten.theta <- melt(theta.plot, id.vars = "bin")
theta.map.50kb.bgs <- ggplot(data = molten.theta, aes(x = bin * 50, y = value, colour = variable)) + theme_bw()
theta.map.50kb.bgs <- theta.map.50kb.bgs + geom_line(data = molten.theta, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
theta.map.50kb.bgs <- theta.map.50kb.bgs + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Reds"), "orange"))
theta.map.50kb.bgs <- theta.map.50kb.bgs + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
theta.map.50kb.bgs <- theta.map.50kb.bgs + labs(title = NULL, x = NULL, y = NULL)
theta.map.50kb.bgs <- theta.map.50kb.bgs + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)
theta.map.50kb.bgs
```


## 200 kb scale

```{r, message=FALSE, warning=FALSE}
r2.bgs.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.bgs.200kb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.bgs.200kb) <- reps

r2.bgs.200kb.true <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.bgs.200kb.true) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.bgs.200kb.true) <- reps

sim.theta.200kb <- read.table("dm_bgs_sims/MutationMap_200kb.csv", sep = ",", header = T)
sim.rho.200kb <- read.table("dm_bgs_sims/RecombinationMap_200kb.csv", sep = ",", header = T)
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
rep1.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep1_w200000.csv", sep = ",", header = T)

rep_1.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.diversity.200kb.bedgraph", header = T)
rep_1.pi.200kb$avg <- apply(rep_1.pi.200kb[4:ncol(rep_1.pi.200kb)], 1, mean)
rep_1.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.rho.200kb.bedgraph", header = T)
rep_1.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.theta.200kb.bedgraph", header = T)
rep_1.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.TMRCA.200kb.bedgraph", header = T)
rep_1.tmrca.200kb$avg <- apply(rep_1.tmrca.200kb[4:ncol(rep_1.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep1 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep1.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep1) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep1$thetaS <- (true.lands.200kb.rep1$theta - mean(true.lands.200kb.rep1$theta)) / sd(true.lands.200kb.rep1$theta)
true.lands.200kb.rep1$tmrcaS <- (true.lands.200kb.rep1$tmrca - mean(true.lands.200kb.rep1$tmrca)) / sd(true.lands.200kb.rep1$tmrca)
true.lands.200kb.rep1$rhoS <- (true.lands.200kb.rep1$rho - mean(true.lands.200kb.rep1$rho, na.rm = T)) / sd(true.lands.200kb.rep1$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep1)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 1] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 1] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 1] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 1] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep1 <- as.data.frame(cbind(rep_1.pi.200kb$avg, rep_1.theta.200kb$sample_mean, rep_1.tmrca.200kb$avg, rep_1.rho.200kb$sample_mean))
names(inf.lands.200kb.rep1) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[1, 2] <- cor.test(sim.theta.200kb$Rate, rep_1.theta.200kb$sample_mean, method = "spearman")$estimate 
cor.table.rho[1, 2] <- cor.test(sim.rho.200kb$Rate, rep_1.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[1, 2] <- cor.test(rep1.sim.tmrca.200kb$AverageTmrca, rep_1.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep1$thetaS <- (inf.lands.200kb.rep1$theta - mean(inf.lands.200kb.rep1$theta)) / sd(inf.lands.200kb.rep1$theta)
inf.lands.200kb.rep1$tmrcaS <- (inf.lands.200kb.rep1$tmrca - mean(inf.lands.200kb.rep1$tmrca)) / sd(inf.lands.200kb.rep1$tmrca)
inf.lands.200kb.rep1$rhoS <- (inf.lands.200kb.rep1$rho - mean(inf.lands.200kb.rep1$rho)) / sd(inf.lands.200kb.rep1$rho)

inf.lands.200kb.rep1$bin <- 1:nrow(inf.lands.200kb.rep1)
inf.lands.200kb.rep1$Replicate <- 1

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep1)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep1)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep1)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb.2)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 1] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep1, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep1, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep1, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep1, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.3)
vif(g.div.200kb.3)

```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
rep2.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep2_w200000.csv", sep = ",", header = T)

rep_2.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.diversity.200kb.bedgraph", header = T)
rep_2.pi.200kb$avg <- apply(rep_2.pi.200kb[4:ncol(rep_2.pi.200kb)], 1, mean)
rep_2.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.rho.200kb.bedgraph", header = T)
rep_2.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.theta.200kb.bedgraph", header = T)
rep_2.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.TMRCA.200kb.bedgraph", header = T)
rep_2.tmrca.200kb$avg <- apply(rep_2.tmrca.200kb[4:ncol(rep_2.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep2 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep2.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep2) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep2$thetaS <- (true.lands.200kb.rep2$theta - mean(true.lands.200kb.rep2$theta)) / sd(true.lands.200kb.rep2$theta)
true.lands.200kb.rep2$tmrcaS <- (true.lands.200kb.rep2$tmrca - mean(true.lands.200kb.rep2$tmrca)) / sd(true.lands.200kb.rep2$tmrca)
true.lands.200kb.rep2$rhoS <- (true.lands.200kb.rep2$rho - mean(true.lands.200kb.rep2$rho, na.rm = T)) / sd(true.lands.200kb.rep2$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep2)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 2] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 2] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 2] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 2] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep2 <- as.data.frame(cbind(rep_2.pi.200kb$avg, rep_2.theta.200kb$sample_mean, rep_2.tmrca.200kb$avg, rep_2.rho.200kb$sample_mean))
names(inf.lands.200kb.rep2) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[2, 2] <- cor.test(sim.theta.200kb$Rate, rep_2.theta.200kb$sample_mean, method = "spearman")$estimate
cor.table.rho[2, 2] <- cor.test(sim.rho.200kb$Rate, rep_2.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[2, 2] <- cor.test(rep2.sim.tmrca.200kb$AverageTmrca, rep_2.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep2$thetaS <- (inf.lands.200kb.rep2$theta - mean(inf.lands.200kb.rep2$theta)) / sd(inf.lands.200kb.rep2$theta)
inf.lands.200kb.rep2$tmrcaS <- (inf.lands.200kb.rep2$tmrca - mean(inf.lands.200kb.rep2$tmrca)) / sd(inf.lands.200kb.rep2$tmrca)
inf.lands.200kb.rep2$rhoS <- (inf.lands.200kb.rep2$rho - mean(inf.lands.200kb.rep2$rho)) / sd(inf.lands.200kb.rep2$rho)

inf.lands.200kb.rep2$bin <- 1:nrow(inf.lands.200kb.rep2)
inf.lands.200kb.rep2$Replicate <- 2

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep2)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep2)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep2)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 2] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep2, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep2, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep2, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep2, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.3)
vif(g.div.200kb.3)
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
rep3.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep3_w200000.csv", sep = ",", header = T)

rep_3.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.diversity.200kb.bedgraph", header = T)
rep_3.pi.200kb$avg <- apply(rep_3.pi.200kb[4:ncol(rep_3.pi.200kb)], 1, mean)
rep_3.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.rho.200kb.bedgraph", header = T)
rep_3.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.theta.200kb.bedgraph", header = T)
rep_3.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.TMRCA.200kb.bedgraph", header = T)
rep_3.tmrca.200kb$avg <- apply(rep_3.tmrca.200kb[4:ncol(rep_3.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep3 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep3.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep3) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep3$thetaS <- (true.lands.200kb.rep3$theta - mean(true.lands.200kb.rep3$theta)) / sd(true.lands.200kb.rep3$theta)
true.lands.200kb.rep3$tmrcaS <- (true.lands.200kb.rep3$tmrca - mean(true.lands.200kb.rep3$tmrca)) / sd(true.lands.200kb.rep3$tmrca)
true.lands.200kb.rep3$rhoS <- (true.lands.200kb.rep3$rho - mean(true.lands.200kb.rep3$rho, na.rm = T)) / sd(true.lands.200kb.rep3$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep3)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 3] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 3] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 3] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 3] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep3 <- as.data.frame(cbind(rep_3.pi.200kb$avg, rep_3.theta.200kb$sample_mean, rep_3.tmrca.200kb$avg, rep_3.rho.200kb$sample_mean))
names(inf.lands.200kb.rep3) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[3, 2] <- cor.test(sim.theta.200kb$Rate, rep_3.theta.200kb$sample_mean, method = "spearman")$estimate 
cor.table.rho[3, 2] <- cor.test(sim.rho.200kb$Rate, rep_3.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[3, 2] <- cor.test(rep3.sim.tmrca.200kb$AverageTmrca, rep_3.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep3$thetaS <- (inf.lands.200kb.rep3$theta - mean(inf.lands.200kb.rep3$theta)) / sd(inf.lands.200kb.rep3$theta)
inf.lands.200kb.rep3$tmrcaS <- (inf.lands.200kb.rep3$tmrca - mean(inf.lands.200kb.rep3$tmrca)) / sd(inf.lands.200kb.rep3$tmrca)
inf.lands.200kb.rep3$rhoS <- (inf.lands.200kb.rep3$rho - mean(inf.lands.200kb.rep3$rho)) / sd(inf.lands.200kb.rep3$rho)

inf.lands.200kb.rep3$bin <- 1:nrow(inf.lands.200kb.rep3)
inf.lands.200kb.rep3$Replicate <- 3

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep3)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep3)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep3)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 3] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep3, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep3, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep3, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep3, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.4)
vif(g.div.200kb.4)
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
rep4.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep4_w200000.csv", sep = ",", header = T)

rep_4.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.diversity.200kb.bedgraph", header = T)
rep_4.pi.200kb$avg <- apply(rep_4.pi.200kb[4:ncol(rep_4.pi.200kb)], 1, mean)
rep_4.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.rho.200kb.bedgraph", header = T)
rep_4.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.theta.200kb.bedgraph", header = T)
rep_4.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.TMRCA.200kb.bedgraph", header = T)
rep_4.tmrca.200kb$avg <- apply(rep_4.tmrca.200kb[4:ncol(rep_4.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep4 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep4.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep4) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep4$thetaS <- (true.lands.200kb.rep4$theta - mean(true.lands.200kb.rep4$theta)) / sd(true.lands.200kb.rep4$theta)
true.lands.200kb.rep4$tmrcaS <- (true.lands.200kb.rep4$tmrca - mean(true.lands.200kb.rep4$tmrca)) / sd(true.lands.200kb.rep4$tmrca)
true.lands.200kb.rep4$rhoS <- (true.lands.200kb.rep4$rho - mean(true.lands.200kb.rep4$rho, na.rm = T)) / sd(true.lands.200kb.rep4$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep4)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 4] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 4] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 4] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 4] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep4 <- as.data.frame(cbind(rep_4.pi.200kb$avg, rep_4.theta.200kb$sample_mean, rep_4.tmrca.200kb$avg, rep_4.rho.200kb$sample_mean))
names(inf.lands.200kb.rep4) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[4, 2] <- cor.test(sim.theta.200kb$Rate, rep_4.theta.200kb$sample_mean, method = "spearman")$estimate
cor.table.rho[4, 2] <- cor.test(sim.rho.200kb$Rate, rep_4.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[4, 2] <- cor.test(rep4.sim.tmrca.200kb$AverageTmrca, rep_4.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep4$thetaS <- (inf.lands.200kb.rep4$theta - mean(inf.lands.200kb.rep4$theta))
inf.lands.200kb.rep4$tmrcaS <- (inf.lands.200kb.rep4$tmrca - mean(inf.lands.200kb.rep4$tmrca))
inf.lands.200kb.rep4$rhoS <- (inf.lands.200kb.rep4$rho - mean(inf.lands.200kb.rep4$rho))

inf.lands.200kb.rep4$bin <- 1:nrow(inf.lands.200kb.rep4)
inf.lands.200kb.rep4$Replicate <- 4

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep4)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep4)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep4)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb.3)~fitted(m.div.200kb.3))
dwtest(m.div.200kb.3)
hmctest(m.div.200kb.3)
hist(resid(m.div.200kb.3))

summary(m.div.200kb.3)
vif(m.div.200kb.3)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 4] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep4, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep4, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep4, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep4, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.3)
vif(g.div.200kb.3)
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
rep5.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep5_w200000.csv", sep = ",", header = T)

rep_5.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.diversity.200kb.bedgraph", header = T)
rep_5.pi.200kb$avg <- apply(rep_5.pi.200kb[4:ncol(rep_5.pi.200kb)], 1, mean)
rep_5.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.rho.200kb.bedgraph", header = T)
rep_5.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.theta.200kb.bedgraph", header = T)
rep_5.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.TMRCA.200kb.bedgraph", header = T)
rep_5.tmrca.200kb$avg <- apply(rep_5.tmrca.200kb[4:ncol(rep_5.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep5 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep5.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep5) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep5$thetaS <- (true.lands.200kb.rep5$theta - mean(true.lands.200kb.rep5$theta)) / sd(true.lands.200kb.rep5$theta)
true.lands.200kb.rep5$tmrcaS <- (true.lands.200kb.rep5$tmrca - mean(true.lands.200kb.rep5$tmrca)) / sd(true.lands.200kb.rep5$tmrca)
true.lands.200kb.rep5$rhoS <- (true.lands.200kb.rep5$rho - mean(true.lands.200kb.rep5$rho, na.rm = T)) / sd(true.lands.200kb.rep5$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep5)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 5] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 5] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 5] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 5] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep5 <- as.data.frame(cbind(rep_5.pi.200kb$avg, rep_5.theta.200kb$sample_mean, rep_5.tmrca.200kb$avg, rep_5.rho.200kb$sample_mean))
names(inf.lands.200kb.rep5) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[5, 2] <- cor.test(sim.theta.200kb$Rate, rep_5.theta.200kb$sample_mean, method = "spearman")$estimate
cor.table.rho[5, 2] <- cor.test(sim.rho.200kb$Rate, rep_5.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[5, 2] <- cor.test(rep5.sim.tmrca.200kb$AverageTmrca, rep_5.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep5$thetaS <- (inf.lands.200kb.rep5$theta - mean(inf.lands.200kb.rep5$theta)) / sd(inf.lands.200kb.rep5$theta)
inf.lands.200kb.rep5$tmrcaS <- (inf.lands.200kb.rep5$tmrca - mean(inf.lands.200kb.rep5$tmrca)) / sd(inf.lands.200kb.rep5$tmrca)
inf.lands.200kb.rep5$rhoS <- (inf.lands.200kb.rep5$rho - mean(inf.lands.200kb.rep5$rho)) / sd(inf.lands.200kb.rep5$rho)

inf.lands.200kb.rep5$bin <- 1:nrow(inf.lands.200kb.rep5)
inf.lands.200kb.rep5$Replicate <- 5

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep5)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep5)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep5)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 5] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep5, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep5, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep5, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep5, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.3)
vif(g.div.200kb.3)
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
rep6.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep6_w200000.csv", sep = ",", header = T)

rep_6.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.diversity.200kb.bedgraph", header = T)
rep_6.pi.200kb$avg <- apply(rep_6.pi.200kb[4:ncol(rep_6.pi.200kb)], 1, mean)
rep_6.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.rho.200kb.bedgraph", header = T)
rep_6.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.theta.200kb.bedgraph", header = T)
rep_6.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.TMRCA.200kb.bedgraph", header = T)
rep_6.tmrca.200kb$avg <- apply(rep_6.tmrca.200kb[4:ncol(rep_6.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep6 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep6.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep6) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep6$thetaS <- (true.lands.200kb.rep6$theta - mean(true.lands.200kb.rep6$theta)) / sd(true.lands.200kb.rep6$theta)
true.lands.200kb.rep6$tmrcaS <- (true.lands.200kb.rep6$tmrca - mean(true.lands.200kb.rep6$tmrca)) / sd(true.lands.200kb.rep6$tmrca)
true.lands.200kb.rep6$rhoS <- (true.lands.200kb.rep6$rho - mean(true.lands.200kb.rep6$rho, na.rm = T)) / sd(true.lands.200kb.rep6$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep6)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 6] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 6] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 6] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 6] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep6 <- as.data.frame(cbind(rep_6.pi.200kb$avg, rep_6.theta.200kb$sample_mean, rep_6.tmrca.200kb$avg, rep_6.rho.200kb$sample_mean))
names(inf.lands.200kb.rep6) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[6, 2] <- cor.test(sim.theta.200kb$Rate, rep_6.theta.200kb$sample_mean, method = "spearman")$estimate
cor.table.rho[6, 2] <- cor.test(sim.rho.200kb$Rate, rep_6.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[6, 2] <- cor.test(rep6.sim.tmrca.200kb$AverageTmrca, rep_6.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep6$thetaS <- (inf.lands.200kb.rep6$theta - mean(inf.lands.200kb.rep6$theta)) / sd(inf.lands.200kb.rep6$theta)
inf.lands.200kb.rep6$tmrcaS <- (inf.lands.200kb.rep6$tmrca - mean(inf.lands.200kb.rep6$tmrca)) / sd(inf.lands.200kb.rep6$tmrca)
inf.lands.200kb.rep6$rhoS <- (inf.lands.200kb.rep6$rho - mean(inf.lands.200kb.rep6$rho)) / sd(inf.lands.200kb.rep6$rho)

inf.lands.200kb.rep6$bin <- 1:nrow(inf.lands.200kb.rep6)
inf.lands.200kb.rep6$Replicate <- 6

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep6)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep6)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep6)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 6] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep6, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep6, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep6, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep6, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.3)
vif(g.div.200kb.3)
```

### Replicate 7

```{r, message=FALSE, warning=FALSE}
rep7.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep7_w200000.csv", sep = ",", header = T)

rep_7.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.diversity.200kb.bedgraph", header = T)
rep_7.pi.200kb$avg <- apply(rep_7.pi.200kb[4:ncol(rep_7.pi.200kb)], 1, mean)
rep_7.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.rho.200kb.bedgraph", header = T)
rep_7.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.theta.200kb.bedgraph", header = T)
rep_7.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.TMRCA.200kb.bedgraph", header = T)
rep_7.tmrca.200kb$avg <- apply(rep_7.tmrca.200kb[4:ncol(rep_7.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep7 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep7.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep7) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep7$thetaS <- (true.lands.200kb.rep7$theta - mean(true.lands.200kb.rep7$theta)) / sd(true.lands.200kb.rep7$theta)
true.lands.200kb.rep7$tmrcaS <- (true.lands.200kb.rep7$tmrca - mean(true.lands.200kb.rep7$tmrca)) / sd(true.lands.200kb.rep7$tmrca)
true.lands.200kb.rep7$rhoS <- (true.lands.200kb.rep7$rho - mean(true.lands.200kb.rep7$rho, na.rm = T)) / sd(true.lands.200kb.rep7$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep7)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 7] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 7] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 7] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 7] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep7 <- as.data.frame(cbind(rep_7.pi.200kb$avg, rep_7.theta.200kb$sample_mean, rep_7.tmrca.200kb$avg, rep_7.rho.200kb$sample_mean))
names(inf.lands.200kb.rep7) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[7, 2] <- cor.test(sim.theta.200kb$Rate, rep_7.theta.200kb$sample_mean, method = "spearman")$estimate
cor.table.rho[7, 2] <- cor.test(sim.rho.200kb$Rate, rep_1.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[7, 2] <- cor.test(rep7.sim.tmrca.200kb$AverageTmrca, rep_7.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep7$thetaS <- (inf.lands.200kb.rep7$theta - mean(inf.lands.200kb.rep7$theta)) / sd(inf.lands.200kb.rep7$theta)
inf.lands.200kb.rep7$tmrcaS <- (inf.lands.200kb.rep7$tmrca - mean(inf.lands.200kb.rep7$tmrca)) / sd(inf.lands.200kb.rep7$tmrca)
inf.lands.200kb.rep7$rhoS <- (inf.lands.200kb.rep7$rho - mean(inf.lands.200kb.rep7$rho)) / sd(inf.lands.200kb.rep7$rho)

inf.lands.200kb.rep7$bin <- 1:nrow(inf.lands.200kb.rep7)
inf.lands.200kb.rep7$Replicate <- 7

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep7)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep7)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep7)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 7] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep7, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep7, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep7, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep7, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.3)
vif(g.div.200kb.3)
```

### Replicate 8

```{r, message=FALSE, warning=FALSE}
rep8.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep8_w200000.csv", sep = ",", header = T)

rep_8.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.diversity.200kb.bedgraph", header = T)
rep_8.pi.200kb$avg <- apply(rep_8.pi.200kb[4:ncol(rep_8.pi.200kb)], 1, mean)
rep_8.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.rho.200kb.bedgraph", header = T)
rep_8.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.theta.200kb.bedgraph", header = T)
rep_8.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.TMRCA.200kb.bedgraph", header = T)
rep_8.tmrca.200kb$avg <- apply(rep_8.tmrca.200kb[4:ncol(rep_8.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep8 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep8.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep8) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep8$thetaS <- (true.lands.200kb.rep8$theta - mean(true.lands.200kb.rep8$theta)) / sd(true.lands.200kb.rep8$theta)
true.lands.200kb.rep8$tmrcaS <- (true.lands.200kb.rep8$tmrca - mean(true.lands.200kb.rep8$tmrca)) / sd(true.lands.200kb.rep8$tmrca)
true.lands.200kb.rep8$rhoS <- (true.lands.200kb.rep8$rho - mean(true.lands.200kb.rep8$rho, na.rm = T)) / sd(true.lands.200kb.rep8$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep8)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 8] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 8] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 8] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 8] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep8 <- as.data.frame(cbind(rep_8.pi.200kb$avg, rep_8.theta.200kb$sample_mean, rep_8.tmrca.200kb$avg, rep_8.rho.200kb$sample_mean))
names(inf.lands.200kb.rep8) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[8, 2] <- cor.test(sim.theta.200kb$Rate, rep_8.theta.200kb$sample_mean, method = "spearman")$estimate
cor.table.rho[8, 2] <- cor.test(sim.rho.200kb$Rate, rep_8.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[8, 2] <- cor.test(rep8.sim.tmrca.200kb$AverageTmrca, rep_8.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep8$thetaS <- (inf.lands.200kb.rep8$theta - mean(inf.lands.200kb.rep8$theta)) / sd(inf.lands.200kb.rep8$theta)
inf.lands.200kb.rep8$tmrcaS <- (inf.lands.200kb.rep8$tmrca - mean(inf.lands.200kb.rep8$tmrca)) / sd(inf.lands.200kb.rep8$tmrca)
inf.lands.200kb.rep8$rhoS <- (inf.lands.200kb.rep8$rho - mean(inf.lands.200kb.rep8$rho)) / sd(inf.lands.200kb.rep8$rho)

inf.lands.200kb.rep8$bin <- 1:nrow(inf.lands.200kb.rep8)
inf.lands.200kb.rep8$Replicate <- 8

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep8)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep8)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep8)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 8] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep8, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep8, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep8, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep8, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.3)
vif(g.div.200kb.3)
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
rep9.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep9_w200000.csv", sep = ",", header = T)

rep_9.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.diversity.200kb.bedgraph", header = T)
rep_9.pi.200kb$avg <- apply(rep_9.pi.200kb[4:ncol(rep_9.pi.200kb)], 1, mean)
rep_9.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.rho.200kb.bedgraph", header = T)
rep_9.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.theta.200kb.bedgraph", header = T)
rep_9.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.TMRCA.200kb.bedgraph", header = T)
rep_9.tmrca.200kb$avg <- apply(rep_9.tmrca.200kb[4:ncol(rep_9.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep9 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep9.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep9) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep9$thetaS <- (true.lands.200kb.rep9$theta - mean(true.lands.200kb.rep9$theta)) / sd(true.lands.200kb.rep9$theta)
true.lands.200kb.rep9$tmrcaS <- (true.lands.200kb.rep9$tmrca - mean(true.lands.200kb.rep9$tmrca)) / sd(true.lands.200kb.rep9$tmrca)
true.lands.200kb.rep9$rhoS <- (true.lands.200kb.rep9$rho - mean(true.lands.200kb.rep9$rho, na.rm = T)) / sd(true.lands.200kb.rep9$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep9)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 9] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 9] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 9] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 9] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep9 <- as.data.frame(cbind(rep_9.pi.200kb$avg, rep_9.theta.200kb$sample_mean, rep_9.tmrca.200kb$avg, rep_9.rho.200kb$sample_mean))
names(inf.lands.200kb.rep9) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[9, 2] <- cor.test(sim.theta.200kb$Rate, rep_9.theta.200kb$sample_mean, method = "spearman")$estimate
cor.table.rho[9, 2] <- cor.test(sim.rho.200kb$Rate, rep_9.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[9, 2] <- cor.test(rep9.sim.tmrca.200kb$AverageTmrca, rep_9.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep9$thetaS <- (inf.lands.200kb.rep9$theta - mean(inf.lands.200kb.rep9$theta)) / sd(inf.lands.200kb.rep9$theta)
inf.lands.200kb.rep9$tmrcaS <- (inf.lands.200kb.rep9$tmrca - mean(inf.lands.200kb.rep9$tmrca)) / sd(inf.lands.200kb.rep9$tmrca)
inf.lands.200kb.rep9$rhoS <- (inf.lands.200kb.rep9$rho - mean(inf.lands.200kb.rep9$rho)) / sd(inf.lands.200kb.rep9$rho)

inf.lands.200kb.rep9$bin <- 1:nrow(inf.lands.200kb.rep9)
inf.lands.200kb.rep9$Replicate <- 9

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep9)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep9)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep9)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb.3)~fitted(m.div.200kb.3))
dwtest(m.div.200kb.3)
hmctest(m.div.200kb.3)
hist(resid(m.div.200kb.3))

summary(m.div.200kb.3)
vif(m.div.200kb.3)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 9] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep9, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep9, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep9, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep9, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.2)
vif(g.div.200kb.2)
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
rep10.sim.tmrca.200kb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep10_w200000.csv", sep = ",", header = T)

rep_10.pi.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.diversity.200kb.bedgraph", header = T)
rep_10.pi.200kb$avg <- apply(rep_10.pi.200kb[4:ncol(rep_10.pi.200kb)], 1, mean)
rep_10.rho.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.rho.200kb.bedgraph", header = T)
rep_10.theta.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.theta.200kb.bedgraph", header = T)
rep_10.tmrca.200kb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.TMRCA.200kb.bedgraph", header = T)
rep_10.tmrca.200kb$avg <- apply(rep_10.tmrca.200kb[4:ncol(rep_10.tmrca.200kb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.200kb.rep10 <- as.data.frame(cbind(rep_1.pi.200kb$avg, sim.theta.200kb$Rate, rep10.sim.tmrca.200kb$AverageTmrca, sim.rho.200kb$Rate))
names(true.lands.200kb.rep10) <- c("diversity", "theta", "tmrca", "rho")
true.lands.200kb.rep10$thetaS <- (true.lands.200kb.rep10$theta - mean(true.lands.200kb.rep10$theta)) / sd(true.lands.200kb.rep10$theta)
true.lands.200kb.rep10$tmrcaS <- (true.lands.200kb.rep10$tmrca - mean(true.lands.200kb.rep10$tmrca)) / sd(true.lands.200kb.rep10$tmrca)
true.lands.200kb.rep10$rhoS <- (true.lands.200kb.rep10$rho - mean(true.lands.200kb.rep10$rho, na.rm = T)) / sd(true.lands.200kb.rep10$rho, na.rm = T)

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.200kb.rep10)
anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.200kb.true[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb.true[2, 10] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb.true[3, 10] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb.true[4, 10] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb.true[5, 10] <- anova.diversity$VarExp[4] * 100

summary(m.div.200kb)
vif(m.div.200kb)

# now the lm with inferred landscapes
inf.lands.200kb.rep10 <- as.data.frame(cbind(rep_10.pi.200kb$avg, rep_10.theta.200kb$sample_mean, rep_10.tmrca.200kb$avg, rep_1.rho.200kb$sample_mean))
names(inf.lands.200kb.rep10) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[10, 2] <- cor.test(sim.theta.200kb$Rate, rep_10.theta.200kb$sample_mean, method = "spearman")$estimate
cor.table.rho[10, 2] <- cor.test(sim.rho.200kb$Rate, rep_10.rho.200kb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[10, 2] <- cor.test(rep10.sim.tmrca.200kb$AverageTmrca, rep_10.tmrca.200kb$avg, method = "spearman")$estimate

# standardizing
inf.lands.200kb.rep10$thetaS <- (inf.lands.200kb.rep10$theta - mean(inf.lands.200kb.rep10$theta)) / sd(inf.lands.200kb.rep10$theta)
inf.lands.200kb.rep10$tmrcaS <- (inf.lands.200kb.rep10$tmrca - mean(inf.lands.200kb.rep10$tmrca)) / sd(inf.lands.200kb.rep10$tmrca)
inf.lands.200kb.rep10$rhoS <- (inf.lands.200kb.rep10$rho - mean(inf.lands.200kb.rep10$rho)) / sd(inf.lands.200kb.rep10$rho)

inf.lands.200kb.rep10$bin <- 1:nrow(inf.lands.200kb.rep10)

inf.lands.200kb.rep10$Replicate <- 10

m.div.200kb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep10)
m.div.200kb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.200kb.rep10)
m.div.200kb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.200kb.rep10)

AIC(m.div.200kb, m.div.200kb.2, m.div.200kb.3)

plot(resid(m.div.200kb)~fitted(m.div.200kb))
dwtest(m.div.200kb)
hmctest(m.div.200kb)
hist(resid(m.div.200kb))

summary(m.div.200kb)
vif(m.div.200kb)

anova.diversity <- Anova(m.div.200kb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.200kb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.200kb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.bgs.200kb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.bgs.200kb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.bgs.200kb[5, 10] <- anova.diversity$VarExp[4] * 100

g.div.200kb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep10, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep10, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.200kb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep10, weights = varPower(0, ~theta), method = "ML")
g.div.200kb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.200kb.rep10, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.200kb.1, g.div.200kb.2, g.div.200kb.3, g.div.200kb.4)

summary(g.div.200kb.4)
vif(g.div.200kb.4)
```

## all replicates:

```{r, message=FALSE, warning=FALSE}
theta.plot <- as.data.frame(cbind(1:nrow(sim.theta.200kb),
                                sim.theta.200kb$Rate * 1e-7 * 3e+4, 
                                rep_1.theta.200kb$sample_mean,
                                rep_2.theta.200kb$sample_mean,
                                rep_3.theta.200kb$sample_mean,
                                rep_4.theta.200kb$sample_mean,
                                rep_5.theta.200kb$sample_mean,
                                rep_6.theta.200kb$sample_mean,
                                rep_7.theta.200kb$sample_mean,
                                rep_8.theta.200kb$sample_mean,
                                rep_9.theta.200kb$sample_mean,
                                rep_10.theta.200kb$sample_mean))

names(theta.plot) <- c("bin", "sim", reps)
molten.theta <- melt(theta.plot, id.vars = "bin")
theta.map.200kb.bgs <- ggplot(data = molten.theta, aes(x = bin * 200, y = value, colour = variable)) + theme_bw()
theta.map.200kb.bgs <- theta.map.200kb.bgs + geom_line(data = molten.theta, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
theta.map.200kb.bgs <- theta.map.200kb.bgs + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Reds"), "orange"))
theta.map.200kb.bgs <- theta.map.200kb.bgs + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
theta.map.200kb.bgs <- theta.map.200kb.bgs + labs(title = NULL, x = NULL, y = NULL)
theta.map.200kb.bgs <- theta.map.200kb.bgs + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)
theta.map.200kb.bgs
```

## 1 Mb scale

```{r, message=FALSE, warning=FALSE}
r2.bgs.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.bgs.1Mb) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.bgs.1Mb) <- reps

r2.bgs.1Mb.true <- as.data.frame(matrix(ncol = nreps, nrow = 5))
row.names(r2.bgs.1Mb.true) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
colnames(r2.bgs.1Mb.true) <- reps

sim.theta.1Mb <- read.table("dm_bgs_sims/MutationMap_1000kb.csv", sep = ",", header = T)
sim.rho.1Mb <- read.table("dm_bgs_sims/RecombinationMap_1000kb.csv", sep = ",", header = T)
```

### Replicate 1

```{r, message=FALSE, warning=FALSE}
rep1.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep1_w1000000.csv", sep = ",", header = T)

rep_1.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.diversity.1Mb.bedgraph", header = T)
rep_1.pi.1Mb$avg <- apply(rep_1.pi.1Mb[4:ncol(rep_1.pi.1Mb)], 1, mean)
rep_1.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.rho.1Mb.bedgraph", header = T)
rep_1.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.theta.1Mb.bedgraph", header = T)
rep_1.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep1/dm2L_bgs_rep1_5.TMRCA.1Mb.bedgraph", header = T)
rep_1.tmrca.1Mb$avg <- apply(rep_1.tmrca.1Mb[4:ncol(rep_1.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep1 <- as.data.frame(cbind(rep_1.pi.1Mb$avg, sim.theta.1Mb$Rate, rep1.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep1) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep1$thetaS <- (true.lands.1Mb.rep1$theta - mean(true.lands.1Mb.rep1$theta)) / sd(true.lands.1Mb.rep1$theta)
true.lands.1Mb.rep1$tmrcaS <- (true.lands.1Mb.rep1$tmrca - mean(true.lands.1Mb.rep1$tmrca)) / sd(true.lands.1Mb.rep1$tmrca)
true.lands.1Mb.rep1$rhoS <- (true.lands.1Mb.rep1$rho - mean(true.lands.1Mb.rep1$rho, na.rm = T)) / sd(true.lands.1Mb.rep1$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep1)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 1] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 1] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 1] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 1] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep1 <- as.data.frame(cbind(rep_1.pi.1Mb$avg, rep_1.theta.1Mb$sample_mean, rep_1.tmrca.1Mb$avg, rep_1.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep1) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[1, 3] <- cor.test(sim.theta.1Mb$Rate, rep_1.theta.1Mb$sample_mean, method = "spearman")$estimate 
cor.table.rho[1, 3] <- cor.test(sim.rho.1Mb$Rate, rep_1.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[1, 3] <- cor.test(rep1.sim.tmrca.1Mb$AverageTmrca, rep_1.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep1$thetaS <- (inf.lands.1Mb.rep1$theta - mean(inf.lands.1Mb.rep1$theta)) / sd(inf.lands.1Mb.rep1$theta)
inf.lands.1Mb.rep1$tmrcaS <- (inf.lands.1Mb.rep1$tmrca - mean(inf.lands.1Mb.rep1$tmrca)) / sd(inf.lands.1Mb.rep1$tmrca)
inf.lands.1Mb.rep1$rhoS <- (inf.lands.1Mb.rep1$rho - mean(inf.lands.1Mb.rep1$rho)) / sd(inf.lands.1Mb.rep1$rho)

inf.lands.1Mb.rep1$bin <- 1:nrow(inf.lands.1Mb.rep1)
inf.lands.1Mb.rep1$Replicate <- 1

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep1)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep1)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep1)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb.2)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 1] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 1] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 1] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 1] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 1] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep1, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep1, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep1, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep1, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.1)
vif(g.div.200kb.1)
```

### Replicate 2

```{r, message=FALSE, warning=FALSE}
rep2.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep2_w1000000.csv", sep = ",", header = T)

rep_2.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.diversity.1Mb.bedgraph", header = T)
rep_2.pi.1Mb$avg <- apply(rep_2.pi.1Mb[4:ncol(rep_2.pi.1Mb)], 1, mean)
rep_2.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.rho.1Mb.bedgraph", header = T)
rep_2.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.theta.1Mb.bedgraph", header = T)
rep_2.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep2/dm2L_bgs_rep2_5.TMRCA.1Mb.bedgraph", header = T)
rep_2.tmrca.1Mb$avg <- apply(rep_2.tmrca.1Mb[4:ncol(rep_2.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep2 <- as.data.frame(cbind(rep_2.pi.1Mb$avg, sim.theta.1Mb$Rate, rep2.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep2) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep2$thetaS <- (true.lands.1Mb.rep2$theta - mean(true.lands.1Mb.rep2$theta)) / sd(true.lands.1Mb.rep2$theta)
true.lands.1Mb.rep2$tmrcaS <- (true.lands.1Mb.rep2$tmrca - mean(true.lands.1Mb.rep2$tmrca)) / sd(true.lands.1Mb.rep2$tmrca)
true.lands.1Mb.rep2$rhoS <- (true.lands.1Mb.rep2$rho - mean(true.lands.1Mb.rep2$rho, na.rm = T)) / sd(true.lands.1Mb.rep2$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep2)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 2] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 2] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 2] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 2] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep2 <- as.data.frame(cbind(rep_2.pi.1Mb$avg, rep_2.theta.1Mb$sample_mean, rep_2.tmrca.1Mb$avg, rep_2.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep2) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[2, 3] <- cor.test(sim.theta.1Mb$Rate, rep_2.theta.1Mb$sample_mean, method = "spearman")$estimate 
cor.table.rho[2, 3] <- cor.test(sim.rho.1Mb$Rate, rep_2.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[2, 3] <- cor.test(rep2.sim.tmrca.1Mb$AverageTmrca, rep_2.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep2$thetaS <- (inf.lands.1Mb.rep2$theta - mean(inf.lands.1Mb.rep2$theta)) / sd(inf.lands.1Mb.rep2$theta)
inf.lands.1Mb.rep2$tmrcaS <- (inf.lands.1Mb.rep2$tmrca - mean(inf.lands.1Mb.rep2$tmrca)) / sd(inf.lands.1Mb.rep2$tmrca)
inf.lands.1Mb.rep2$rhoS <- (inf.lands.1Mb.rep2$rho - mean(inf.lands.1Mb.rep2$rho)) / sd(inf.lands.1Mb.rep2$rho)

inf.lands.1Mb.rep2$bin <- 1:nrow(inf.lands.1Mb.rep2)
inf.lands.1Mb.rep2$Replicate <- 2

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep2)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep2)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep2)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb.2)~fitted(m.div.1Mb.2))
dwtest(m.div.1Mb.2)
hmctest(m.div.1Mb.2)
hist(resid(m.div.1Mb.2))

summary(m.div.1Mb.2)
vif(m.div.1Mb.2)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 2] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 2] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 2] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 2] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 2] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep2, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep2, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep2, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep2, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.1)
vif(g.div.200kb.1)
```

### Replicate 3

```{r, message=FALSE, warning=FALSE}
rep3.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep3_w1000000.csv", sep = ",", header = T)

rep_3.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.diversity.1Mb.bedgraph", header = T)
rep_3.pi.1Mb$avg <- apply(rep_3.pi.1Mb[4:ncol(rep_3.pi.1Mb)], 1, mean)
rep_3.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.rho.1Mb.bedgraph", header = T)
rep_3.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.theta.1Mb.bedgraph", header = T)
rep_3.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep3/dm2L_bgs_rep3_5.TMRCA.1Mb.bedgraph", header = T)
rep_3.tmrca.1Mb$avg <- apply(rep_3.tmrca.1Mb[4:ncol(rep_3.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep3 <- as.data.frame(cbind(rep_2.pi.1Mb$avg, sim.theta.1Mb$Rate, rep3.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep3) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep3$thetaS <- (true.lands.1Mb.rep3$theta - mean(true.lands.1Mb.rep3$theta)) / sd(true.lands.1Mb.rep3$theta)
true.lands.1Mb.rep3$tmrcaS <- (true.lands.1Mb.rep3$tmrca - mean(true.lands.1Mb.rep3$tmrca)) / sd(true.lands.1Mb.rep3$tmrca)
true.lands.1Mb.rep3$rhoS <- (true.lands.1Mb.rep3$rho - mean(true.lands.1Mb.rep3$rho, na.rm = T)) / sd(true.lands.1Mb.rep3$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep3)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 3] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 3] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 3] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 3] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep3 <- as.data.frame(cbind(rep_3.pi.1Mb$avg, rep_3.theta.1Mb$sample_mean, rep_3.tmrca.1Mb$avg, rep_3.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep3) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[3, 3] <- cor.test(sim.theta.1Mb$Rate, rep_3.theta.1Mb$sample_mean, method = "spearman")$estimate 
cor.table.rho[3, 3] <- cor.test(sim.rho.1Mb$Rate, rep_3.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[3, 3] <- cor.test(rep3.sim.tmrca.1Mb$AverageTmrca, rep_3.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep3$thetaS <- (inf.lands.1Mb.rep3$theta - mean(inf.lands.1Mb.rep3$theta)) / sd(inf.lands.1Mb.rep3$theta)
inf.lands.1Mb.rep3$tmrcaS <- (inf.lands.1Mb.rep3$tmrca - mean(inf.lands.1Mb.rep3$tmrca)) / sd(inf.lands.1Mb.rep3$tmrca)
inf.lands.1Mb.rep3$rhoS <- (inf.lands.1Mb.rep3$rho - mean(inf.lands.1Mb.rep3$rho)) / sd(inf.lands.1Mb.rep3$rho)

inf.lands.1Mb.rep3$bin <- 1:nrow(inf.lands.1Mb.rep3)
inf.lands.1Mb.rep3$Replicate <- 3

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep3)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep3)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep3)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 3] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 3] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 3] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 3] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 3] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep3, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep3, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep3, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep3, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.4)
vif(g.div.200kb.4)
```

### Replicate 4

```{r, message=FALSE, warning=FALSE}
rep4.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep4_w1000000.csv", sep = ",", header = T)

rep_4.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.diversity.1Mb.bedgraph", header = T)
rep_4.pi.1Mb$avg <- apply(rep_4.pi.1Mb[4:ncol(rep_4.pi.1Mb)], 1, mean)
rep_4.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.rho.1Mb.bedgraph", header = T)
rep_4.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.theta.1Mb.bedgraph", header = T)
rep_4.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep4/dm2L_bgs_rep4_5.TMRCA.1Mb.bedgraph", header = T)
rep_4.tmrca.1Mb$avg <- apply(rep_4.tmrca.1Mb[4:ncol(rep_4.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep4 <- as.data.frame(cbind(rep_4.pi.1Mb$avg, sim.theta.1Mb$Rate, rep4.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep4) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep4$thetaS <- (true.lands.1Mb.rep4$theta - mean(true.lands.1Mb.rep4$theta)) / sd(true.lands.1Mb.rep4$theta)
true.lands.1Mb.rep4$tmrcaS <- (true.lands.1Mb.rep4$tmrca - mean(true.lands.1Mb.rep4$tmrca)) / sd(true.lands.1Mb.rep4$tmrca)
true.lands.1Mb.rep4$rhoS <- (true.lands.1Mb.rep4$rho - mean(true.lands.1Mb.rep4$rho, na.rm = T)) / sd(true.lands.1Mb.rep4$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep4)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 4] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 4] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 4] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 4] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep4 <- as.data.frame(cbind(rep_4.pi.1Mb$avg, rep_4.theta.1Mb$sample_mean, rep_4.tmrca.1Mb$avg, rep_4.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep4) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[4, 3] <- cor.test(sim.theta.1Mb$Rate, rep_4.theta.1Mb$sample_mean, method = "spearman")$estimate
cor.table.rho[4, 3] <- cor.test(sim.rho.1Mb$Rate, rep_4.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[4, 3] <- cor.test(rep4.sim.tmrca.1Mb$AverageTmrca, rep_4.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep4$thetaS <- (inf.lands.1Mb.rep4$theta - mean(inf.lands.1Mb.rep4$theta))
inf.lands.1Mb.rep4$tmrcaS <- (inf.lands.1Mb.rep4$tmrca - mean(inf.lands.1Mb.rep4$tmrca))
inf.lands.1Mb.rep4$rhoS <- (inf.lands.1Mb.rep4$rho - mean(inf.lands.1Mb.rep4$rho))

inf.lands.1Mb.rep4$bin <- 1:nrow(inf.lands.1Mb.rep4)
inf.lands.1Mb.rep4$Replicate <- 4

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep4)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep4)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep4)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb.3)~fitted(m.div.1Mb.3))
dwtest(m.div.1Mb.3)
hmctest(m.div.1Mb.3)
hist(resid(m.div.1Mb.3))

summary(m.div.1Mb.3)
vif(m.div.1Mb.3)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 4] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 4] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 4] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 4] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 4] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep4, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep4, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep4, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep4, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.2)
vif(g.div.200kb.2)
```

### Replicate 5

```{r, message=FALSE, warning=FALSE}
rep5.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep5_w1000000.csv", sep = ",", header = T)

rep_5.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.diversity.1Mb.bedgraph", header = T)
rep_5.pi.1Mb$avg <- apply(rep_5.pi.1Mb[4:ncol(rep_5.pi.1Mb)], 1, mean)
rep_5.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.rho.1Mb.bedgraph", header = T)
rep_5.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.theta.1Mb.bedgraph", header = T)
rep_5.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep5/dm2L_bgs_rep5_5.TMRCA.1Mb.bedgraph", header = T)
rep_5.tmrca.1Mb$avg <- apply(rep_5.tmrca.1Mb[4:ncol(rep_5.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep5 <- as.data.frame(cbind(rep_4.pi.1Mb$avg, sim.theta.1Mb$Rate, rep5.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep5) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep5$thetaS <- (true.lands.1Mb.rep5$theta - mean(true.lands.1Mb.rep5$theta)) / sd(true.lands.1Mb.rep5$theta)
true.lands.1Mb.rep5$tmrcaS <- (true.lands.1Mb.rep5$tmrca - mean(true.lands.1Mb.rep5$tmrca)) / sd(true.lands.1Mb.rep5$tmrca)
true.lands.1Mb.rep5$rhoS <- (true.lands.1Mb.rep5$rho - mean(true.lands.1Mb.rep5$rho, na.rm = T)) / sd(true.lands.1Mb.rep5$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep5)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 5] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 5] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 5] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 5] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep5 <- as.data.frame(cbind(rep_5.pi.1Mb$avg, rep_5.theta.1Mb$sample_mean, rep_5.tmrca.1Mb$avg, rep_5.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep5) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[5, 3] <- cor.test(sim.theta.1Mb$Rate, rep_5.theta.1Mb$sample_mean, method = "spearman")$estimate
cor.table.rho[5, 3] <- cor.test(sim.rho.1Mb$Rate, rep_5.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[5, 3] <- cor.test(rep5.sim.tmrca.1Mb$AverageTmrca, rep_5.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep5$thetaS <- (inf.lands.1Mb.rep5$theta - mean(inf.lands.1Mb.rep5$theta)) / sd(inf.lands.1Mb.rep5$theta)
inf.lands.1Mb.rep5$tmrcaS <- (inf.lands.1Mb.rep5$tmrca - mean(inf.lands.1Mb.rep5$tmrca)) / sd(inf.lands.1Mb.rep5$tmrca)
inf.lands.1Mb.rep5$rhoS <- (inf.lands.1Mb.rep5$rho - mean(inf.lands.1Mb.rep5$rho)) / sd(inf.lands.1Mb.rep5$rho)

inf.lands.1Mb.rep5$bin <- 1:nrow(inf.lands.1Mb.rep5)
inf.lands.1Mb.rep5$Replicate <- 5

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep5)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep5)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep5)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb.2)~fitted(m.div.1Mb.2))
dwtest(m.div.1Mb.2)
hmctest(m.div.1Mb.2)
hist(resid(m.div.1Mb.2))

summary(m.div.1Mb.2)
vif(m.div.1Mb.2)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 5] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 5] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 5] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 5] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 5] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep5, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep5, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep5, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep5, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.4)
vif(g.div.200kb.4)
```

### Replicate 6

```{r, message=FALSE, warning=FALSE}
rep6.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep6_w1000000.csv", sep = ",", header = T)

rep_6.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.diversity.1Mb.bedgraph", header = T)
rep_6.pi.1Mb$avg <- apply(rep_6.pi.1Mb[4:ncol(rep_6.pi.1Mb)], 1, mean)
rep_6.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.rho.1Mb.bedgraph", header = T)
rep_6.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.theta.1Mb.bedgraph", header = T)
rep_6.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep6/dm2L_bgs_rep6_5.TMRCA.1Mb.bedgraph", header = T)
rep_6.tmrca.1Mb$avg <- apply(rep_6.tmrca.1Mb[4:ncol(rep_6.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep6 <- as.data.frame(cbind(rep_6.pi.1Mb$avg, sim.theta.1Mb$Rate, rep6.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep6) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep6$thetaS <- (true.lands.1Mb.rep6$theta - mean(true.lands.1Mb.rep6$theta)) / sd(true.lands.1Mb.rep6$theta)
true.lands.1Mb.rep6$tmrcaS <- (true.lands.1Mb.rep6$tmrca - mean(true.lands.1Mb.rep6$tmrca)) / sd(true.lands.1Mb.rep6$tmrca)
true.lands.1Mb.rep6$rhoS <- (true.lands.1Mb.rep6$rho - mean(true.lands.1Mb.rep6$rho, na.rm = T)) / sd(true.lands.1Mb.rep6$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep6)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 6] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 6] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 6] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 6] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep6 <- as.data.frame(cbind(rep_6.pi.1Mb$avg, rep_6.theta.1Mb$sample_mean, rep_6.tmrca.1Mb$avg, rep_6.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep6) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[6, 3] <- cor.test(sim.theta.1Mb$Rate, rep_6.theta.1Mb$sample_mean, method = "spearman")$estimate
cor.table.rho[6, 3] <- cor.test(sim.rho.1Mb$Rate, rep_6.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[6, 3] <- cor.test(rep6.sim.tmrca.1Mb$AverageTmrca, rep_6.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep6$thetaS <- (inf.lands.1Mb.rep6$theta - mean(inf.lands.1Mb.rep6$theta)) / sd(inf.lands.1Mb.rep6$theta)
inf.lands.1Mb.rep6$tmrcaS <- (inf.lands.1Mb.rep6$tmrca - mean(inf.lands.1Mb.rep6$tmrca)) / sd(inf.lands.1Mb.rep6$tmrca)
inf.lands.1Mb.rep6$rhoS <- (inf.lands.1Mb.rep6$rho - mean(inf.lands.1Mb.rep6$rho)) / sd(inf.lands.1Mb.rep6$rho)

inf.lands.1Mb.rep6$bin <- 1:nrow(inf.lands.1Mb.rep6)
inf.lands.1Mb.rep6$Replicate <- 6

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep6)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep6)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep6)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 6] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 6] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 6] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 6] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 6] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep6, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep6, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep6, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep6, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.1)
vif(g.div.200kb.1)
```

### Replicate 7

```{r, message=FALSE, warning=FALSE}
rep7.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep7_w1000000.csv", sep = ",", header = T)

rep_7.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.diversity.1Mb.bedgraph", header = T)
rep_7.pi.1Mb$avg <- apply(rep_7.pi.1Mb[4:ncol(rep_7.pi.1Mb)], 1, mean)
rep_7.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.rho.1Mb.bedgraph", header = T)
rep_7.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.theta.1Mb.bedgraph", header = T)
rep_7.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep7/dm2L_bgs_rep7_5.TMRCA.1Mb.bedgraph", header = T)
rep_7.tmrca.1Mb$avg <- apply(rep_7.tmrca.1Mb[4:ncol(rep_7.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep7 <- as.data.frame(cbind(rep_7.pi.1Mb$avg, sim.theta.1Mb$Rate, rep7.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep7) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep7$thetaS <- (true.lands.1Mb.rep7$theta - mean(true.lands.1Mb.rep7$theta)) / sd(true.lands.1Mb.rep7$theta)
true.lands.1Mb.rep7$tmrcaS <- (true.lands.1Mb.rep7$tmrca - mean(true.lands.1Mb.rep7$tmrca)) / sd(true.lands.1Mb.rep7$tmrca)
true.lands.1Mb.rep7$rhoS <- (true.lands.1Mb.rep7$rho - mean(true.lands.1Mb.rep7$rho, na.rm = T)) / sd(true.lands.1Mb.rep7$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep7)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 7] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 7] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 7] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 7] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep7 <- as.data.frame(cbind(rep_7.pi.1Mb$avg, rep_7.theta.1Mb$sample_mean, rep_7.tmrca.1Mb$avg, rep_7.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep7) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[7, 3] <- cor.test(sim.theta.1Mb$Rate, rep_7.theta.1Mb$sample_mean, method = "spearman")$estimate
cor.table.rho[7, 3] <- cor.test(sim.rho.1Mb$Rate, rep_7.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[7, 3] <- cor.test(rep7.sim.tmrca.1Mb$AverageTmrca, rep_7.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep7$thetaS <- (inf.lands.1Mb.rep7$theta - mean(inf.lands.1Mb.rep7$theta)) / sd(inf.lands.1Mb.rep7$theta)
inf.lands.1Mb.rep7$tmrcaS <- (inf.lands.1Mb.rep7$tmrca - mean(inf.lands.1Mb.rep7$tmrca)) / sd(inf.lands.1Mb.rep7$tmrca)
inf.lands.1Mb.rep7$rhoS <- (inf.lands.1Mb.rep7$rho - mean(inf.lands.1Mb.rep7$rho)) / sd(inf.lands.1Mb.rep7$rho)

inf.lands.1Mb.rep7$bin <- 1:nrow(inf.lands.1Mb.rep7)
inf.lands.1Mb.rep7$Replicate <- 7

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep7)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep7)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep7)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb.3)~fitted(m.div.1Mb.3))
dwtest(m.div.1Mb.3)
hmctest(m.div.1Mb.3)
hist(resid(m.div.1Mb.3))

summary(m.div.1Mb.3)
vif(m.div.1Mb.3)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 7] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 7] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 7] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 7] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 7] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep7, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep7, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep7, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep7, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.2)
vif(g.div.200kb.2)
```

### Replicate 8

```{r, message=FALSE, warning=FALSE}
rep8.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep8_w1000000.csv", sep = ",", header = T)

rep_8.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.diversity.1Mb.bedgraph", header = T)
rep_8.pi.1Mb$avg <- apply(rep_8.pi.1Mb[4:ncol(rep_8.pi.1Mb)], 1, mean)
rep_8.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.rho.1Mb.bedgraph", header = T)
rep_8.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.theta.1Mb.bedgraph", header = T)
rep_8.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep8/dm2L_bgs_rep8_5.TMRCA.1Mb.bedgraph", header = T)
rep_8.tmrca.1Mb$avg <- apply(rep_8.tmrca.1Mb[4:ncol(rep_8.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep8 <- as.data.frame(cbind(rep_8.pi.1Mb$avg, sim.theta.1Mb$Rate, rep8.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep8) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep8$thetaS <- (true.lands.1Mb.rep8$theta - mean(true.lands.1Mb.rep8$theta)) / sd(true.lands.1Mb.rep8$theta)
true.lands.1Mb.rep8$tmrcaS <- (true.lands.1Mb.rep8$tmrca - mean(true.lands.1Mb.rep8$tmrca)) / sd(true.lands.1Mb.rep8$tmrca)
true.lands.1Mb.rep8$rhoS <- (true.lands.1Mb.rep8$rho - mean(true.lands.1Mb.rep8$rho, na.rm = T)) / sd(true.lands.1Mb.rep8$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep8)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 8] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 8] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 8] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 8] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep8 <- as.data.frame(cbind(rep_8.pi.1Mb$avg, rep_8.theta.1Mb$sample_mean, rep_8.tmrca.1Mb$avg, rep_8.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep8) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[8, 3] <- cor.test(sim.theta.1Mb$Rate, rep_8.theta.1Mb$sample_mean, method = "spearman")$estimate
cor.table.rho[8, 3] <- cor.test(sim.rho.1Mb$Rate, rep_8.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[8, 3] <- cor.test(rep8.sim.tmrca.1Mb$AverageTmrca, rep_8.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep8$thetaS <- (inf.lands.1Mb.rep8$theta - mean(inf.lands.1Mb.rep8$theta)) / sd(inf.lands.1Mb.rep8$theta)
inf.lands.1Mb.rep8$tmrcaS <- (inf.lands.1Mb.rep8$tmrca - mean(inf.lands.1Mb.rep8$tmrca)) / sd(inf.lands.1Mb.rep8$tmrca)
inf.lands.1Mb.rep8$rhoS <- (inf.lands.1Mb.rep8$rho - mean(inf.lands.1Mb.rep8$rho)) / sd(inf.lands.1Mb.rep8$rho)

inf.lands.1Mb.rep8$bin <- 1:nrow(inf.lands.1Mb.rep8)
inf.lands.1Mb.rep8$Replicate <- 8

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep8)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep8)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep8)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb.2)~fitted(m.div.1Mb.2))
dwtest(m.div.1Mb.2)
hmctest(m.div.1Mb.2)
hist(resid(m.div.1Mb.2))

summary(m.div.1Mb.2)
vif(m.div.1Mb.2)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 8] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 8] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 8] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 8] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 8] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep8, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep8, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep8, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep8, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.4)
vif(g.div.200kb.4)
```

### Replicate 9

```{r, message=FALSE, warning=FALSE}
rep9.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep9_w1000000.csv", sep = ",", header = T)

rep_9.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.diversity.1Mb.bedgraph", header = T)
rep_9.pi.1Mb$avg <- apply(rep_9.pi.1Mb[4:ncol(rep_9.pi.1Mb)], 1, mean)
rep_9.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.rho.1Mb.bedgraph", header = T)
rep_9.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.theta.1Mb.bedgraph", header = T)
rep_9.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep9/dm2L_bgs_rep9_5.TMRCA.1Mb.bedgraph", header = T)
rep_9.tmrca.1Mb$avg <- apply(rep_9.tmrca.1Mb[4:ncol(rep_9.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep9 <- as.data.frame(cbind(rep_9.pi.1Mb$avg, sim.theta.1Mb$Rate, rep9.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep9) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep9$thetaS <- (true.lands.1Mb.rep9$theta - mean(true.lands.1Mb.rep9$theta)) / sd(true.lands.1Mb.rep9$theta)
true.lands.1Mb.rep9$tmrcaS <- (true.lands.1Mb.rep9$tmrca - mean(true.lands.1Mb.rep9$tmrca)) / sd(true.lands.1Mb.rep9$tmrca)
true.lands.1Mb.rep9$rhoS <- (true.lands.1Mb.rep9$rho - mean(true.lands.1Mb.rep9$rho, na.rm = T)) / sd(true.lands.1Mb.rep9$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep9)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 9] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 9] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 9] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 9] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep9 <- as.data.frame(cbind(rep_9.pi.1Mb$avg, rep_9.theta.1Mb$sample_mean, rep_9.tmrca.1Mb$avg, rep_9.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep9) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[9, 3] <- cor.test(sim.theta.1Mb$Rate, rep_9.theta.1Mb$sample_mean, method = "spearman")$estimate
cor.table.rho[9, 3] <- cor.test(sim.rho.1Mb$Rate, rep_9.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[9, 3] <- cor.test(rep9.sim.tmrca.1Mb$AverageTmrca, rep_9.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep9$thetaS <- (inf.lands.1Mb.rep9$theta - mean(inf.lands.1Mb.rep9$theta)) / sd(inf.lands.1Mb.rep9$theta)
inf.lands.1Mb.rep9$tmrcaS <- (inf.lands.1Mb.rep9$tmrca - mean(inf.lands.1Mb.rep9$tmrca)) / sd(inf.lands.1Mb.rep9$tmrca)
inf.lands.1Mb.rep9$rhoS <- (inf.lands.1Mb.rep9$rho - mean(inf.lands.1Mb.rep9$rho)) / sd(inf.lands.1Mb.rep9$rho)

inf.lands.1Mb.rep9$bin <- 1:nrow(inf.lands.1Mb.rep9)
inf.lands.1Mb.rep9$Replicate <- 9

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep9)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep9)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep9)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 9] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 9] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 9] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 9] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 9] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep9, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep9, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep9, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep9, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.4)
vif(g.div.200kb.4)
```

### Replicate 10

```{r, message=FALSE, warning=FALSE}
rep10.sim.tmrca.1Mb <- read.table("dm_bgs_sims/10r/dm2L_bgs_rep10_w1000000.csv", sep = ",", header = T)

rep_10.pi.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.diversity.1Mb.bedgraph", header = T)
rep_10.pi.1Mb$avg <- apply(rep_10.pi.1Mb[4:ncol(rep_10.pi.1Mb)], 1, mean)
rep_10.rho.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.rho.1Mb.bedgraph", header = T)
rep_10.theta.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.theta.1Mb.bedgraph", header = T)
rep_10.tmrca.1Mb <- read.table("dm_bgs_sims/10r/NonHomogeneous/iSMC/NonHomogeneous/rep10/dm2L_bgs_rep10_5.TMRCA.1Mb.bedgraph", header = T)
rep_10.tmrca.1Mb$avg <- apply(rep_10.tmrca.1Mb[4:ncol(rep_10.tmrca.1Mb)], 1, mean)

# first the linear modeling with the true (simulated) landscapes
true.lands.1Mb.rep10 <- as.data.frame(cbind(rep_10.pi.1Mb$avg, sim.theta.1Mb$Rate, rep10.sim.tmrca.1Mb$AverageTmrca, sim.rho.1Mb$Rate))
names(true.lands.1Mb.rep10) <- c("diversity", "theta", "tmrca", "rho")
true.lands.1Mb.rep10$thetaS <- (true.lands.1Mb.rep10$theta - mean(true.lands.1Mb.rep10$theta)) / sd(true.lands.1Mb.rep10$theta)
true.lands.1Mb.rep10$tmrcaS <- (true.lands.1Mb.rep10$tmrca - mean(true.lands.1Mb.rep10$tmrca)) / sd(true.lands.1Mb.rep10$tmrca)
true.lands.1Mb.rep10$rhoS <- (true.lands.1Mb.rep10$rho - mean(true.lands.1Mb.rep10$rho, na.rm = T)) / sd(true.lands.1Mb.rep10$rho, na.rm = T)

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = true.lands.1Mb.rep10)
anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)
r2.bgs.1Mb.true[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb.true[2, 10] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb.true[3, 10] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb.true[4, 10] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb.true[5, 10] <- anova.diversity$VarExp[4] * 100

summary(m.div.1Mb)
vif(m.div.1Mb)

# now the lm with inferred landscapes
inf.lands.1Mb.rep10 <- as.data.frame(cbind(rep_10.pi.1Mb$avg, rep_10.theta.1Mb$sample_mean, rep_10.tmrca.1Mb$avg, rep_1.rho.1Mb$sample_mean))
names(inf.lands.1Mb.rep10) <- c("diversity", "theta", "tmrca", "rho")

cor.table.theta[10, 3] <- cor.test(sim.theta.1Mb$Rate, rep_10.theta.1Mb$sample_mean, method = "spearman")$estimate
cor.table.rho[10, 3] <- cor.test(sim.rho.1Mb$Rate, rep_10.rho.1Mb$sample_mean, method = "spearman")$estimate
cor.table.tmrca[10, 3] <- cor.test(rep10.sim.tmrca.1Mb$AverageTmrca, rep_10.tmrca.1Mb$avg, method = "spearman")$estimate

# standardizing
inf.lands.1Mb.rep10$thetaS <- (inf.lands.1Mb.rep10$theta - mean(inf.lands.1Mb.rep10$theta)) / sd(inf.lands.1Mb.rep10$theta)
inf.lands.1Mb.rep10$tmrcaS <- (inf.lands.1Mb.rep10$tmrca - mean(inf.lands.1Mb.rep10$tmrca)) / sd(inf.lands.1Mb.rep10$tmrca)
inf.lands.1Mb.rep10$rhoS <- (inf.lands.1Mb.rep10$rho - mean(inf.lands.1Mb.rep10$rho)) / sd(inf.lands.1Mb.rep10$rho)

inf.lands.1Mb.rep10$bin <- 1:nrow(inf.lands.1Mb.rep10)
inf.lands.1Mb.rep10$Replicate <- 10

m.div.1Mb <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep10)
m.div.1Mb.2 <- lm(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS + rhoS:tmrcaS, data = inf.lands.1Mb.rep10)
m.div.1Mb.3 <- lm(diversity ~ (thetaS + rhoS + tmrcaS) ^ 2, data = inf.lands.1Mb.rep10)

AIC(m.div.1Mb, m.div.1Mb.2, m.div.1Mb.3)

plot(resid(m.div.1Mb)~fitted(m.div.1Mb))
dwtest(m.div.1Mb)
hmctest(m.div.1Mb)
hist(resid(m.div.1Mb))

summary(m.div.1Mb)
vif(m.div.1Mb)

anova.diversity <- Anova(m.div.1Mb)
apiss <- anova.diversity$"Sum Sq"
anova.diversity$VarExp <- apiss / sum(apiss)

r2.bgs.1Mb[1, 10] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
r2.bgs.1Mb[2, 10] <- anova.diversity$VarExp[1] * 100
r2.bgs.1Mb[3, 10] <- anova.diversity$VarExp[2] * 100
r2.bgs.1Mb[4, 10] <- anova.diversity$VarExp[3] * 100
r2.bgs.1Mb[5, 10] <- anova.diversity$VarExp[4] * 100

g.div.1Mb.1 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep10, weights = varPower(0, ~tmrcaS), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.2 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep10, weights = varPower(0, ~theta), cor = corAR1(0, ~bin), method = "ML")
g.div.1Mb.3 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep10, weights = varPower(0, ~theta), method = "ML")
g.div.1Mb.4 <- gls(diversity ~ thetaS + rhoS + tmrcaS + thetaS:tmrcaS, data = inf.lands.1Mb.rep10, weights = varPower(0, ~tmrcaS), method = "ML")

AIC(g.div.1Mb.1, g.div.1Mb.2, g.div.1Mb.3, g.div.1Mb.4)

summary(g.div.200kb.1)
vif(g.div.200kb.1)
```

## all replicates:

```{r, message=FALSE, warning=FALSE}
theta.plot <- as.data.frame(cbind(1:nrow(sim.theta.1Mb),
                                sim.theta.1Mb$Rate * 1e-7 * 3e+4, 
                                rep_1.theta.1Mb$sample_mean,
                                rep_2.theta.1Mb$sample_mean,
                                rep_3.theta.1Mb$sample_mean,
                                rep_4.theta.1Mb$sample_mean,
                                rep_5.theta.1Mb$sample_mean,
                                rep_6.theta.1Mb$sample_mean,
                                rep_7.theta.1Mb$sample_mean,
                                rep_8.theta.1Mb$sample_mean,
                                rep_9.theta.1Mb$sample_mean,
                                rep_10.theta.1Mb$sample_mean))

names(theta.plot) <- c("bin", "sim", reps)
molten.theta <- melt(theta.plot, id.vars = "bin")
theta.map.1Mb.bgs <- ggplot(data = molten.theta, aes(x = bin * 1000, y = value, colour = variable)) + theme_bw()
theta.map.1Mb.bgs <- theta.map.1Mb.bgs + geom_line(data = molten.theta, aes(size = variable)) + scale_size_manual(values = c(1.2, rep(0.4, 10)))
theta.map.1Mb.bgs <- theta.map.1Mb.bgs + scale_color_manual(values = c("black", brewer.pal(n = 9, name = "Reds"), "orange"))
theta.map.1Mb.bgs <- theta.map.1Mb.bgs + scale_x_continuous(breaks = pretty_breaks()) + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d)
theta.map.1Mb.bgs <- theta.map.1Mb.bgs + labs(title = NULL, x = "Position (kb)", y = NULL)
theta.map.1Mb.bgs <- theta.map.1Mb.bgs + theme(text = element_text(size = 20), axis.title.x = element_text(size = 20), axis.title.y = element_text(size = 20), legend.position = "none", legend.title = NULL)
theta.map.1Mb.bgs
```

# Plots 

```{r, message=FALSE, warning=FALSE}

scale.2d <- function(x) sprintf("%.2f", x)

write.table(cor.table.theta, "cor.mutation.bgs.tsv", quote = F, sep = "\t")
write.table(cor.table.tmrca, "cor.tmrca.bgs.tsv", quote = F, sep = "\t")
write.table(cor.table.rho, "cor.rho.bgs.tsv", quote = F, sep = "\t")

cor.table.comb <- rbind.data.frame(t(cor.table.theta), t(cor.table.rho), t(cor.table.tmrca))
cor.table.comb$bin.size <- rep(c(50, 200, 1000), 3)
cor.table.comb$rate <- c(rep("Mutation map", 3), rep("Recombination map", 3), rep("TMRCA map", 3))

molten.cor <- melt(cor.table.comb, id.vars = c("bin.size", "rate"))
cor.bgs.plot <- ggplot(data = molten.cor, aes(x = bin.size, y = value, alpha = 0.6))
cor.bgs.plot <- cor.bgs.plot + geom_jitter(width = 0.05, height = 0.05) + facet_wrap(~rate)
cor.bgs.plot <- cor.bgs.plot + scale_x_continuous(breaks = c(50, 200, 1000), trans="log10") 
cor.bgs.plot <- cor.bgs.plot + scale_y_continuous(breaks = pretty_breaks())
cor.bgs.plot <- cor.bgs.plot + labs(title = NULL, x = "Bin Size (kb)", y = "Spearman's Rho") 
cor.bgs.plot <- cor.bgs.plot + theme_bw() + ylim(0, 1)
cor.bgs.plot <- cor.bgs.plot + theme(axis.title = element_text(size = 20), axis.text = element_text(size = 16),
                                     strip.text.x = element_text(size = 16), legend.position = "none")
cor.bgs.plot

ggsave("Figure6.pdf", cor.bgs.plot, device = "pdf", height = 5, width = 12)

# true (simulated) landscapes
r2.bgs.50kb.true$average <- apply(r2.bgs.50kb.true, 1, mean)
r2.bgs.200kb.true$average <- apply(r2.bgs.200kb.true, 1, mean)
r2.bgs.1Mb.true$average <- apply(r2.bgs.1Mb.true, 1, mean)

r2.true.avg <- rbind.data.frame(r2.bgs.50kb.true$average, r2.bgs.200kb.true$average, r2.bgs.1Mb.true$average, make.row.names = F)
colnames(r2.true.avg) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
r2.true.avg$bin.size <- c(50, 200, 1000)

# inferred landscapes
r2.bgs.50kb$average <- apply(r2.bgs.50kb, 1, mean)
r2.bgs.200kb$average <- apply(r2.bgs.200kb, 1, mean)
r2.bgs.1Mb$average <- apply(r2.bgs.1Mb, 1, mean)

r2.inf.avg <- rbind.data.frame(r2.bgs.50kb$average, r2.bgs.200kb$average, r2.bgs.1Mb$average, make.row.names = F)
colnames(r2.inf.avg) <- c("Total", "Theta", "Rho", "TMRCA", "Theta:TMRCA")
r2.inf.avg$bin.size <- c(50, 200, 1000)

r2.tab.comb <- rbind.data.frame(r2.dm.tab, r2.true.avg, r2.inf.avg)
r2.tab.comb$type <- c(rep("iSMC-inferred (Drosophila)", 3), rep("True landscapes (simulations)", 3), rep("iSMC-inferred (simulations)", 3))

molten.r2 <- melt(r2.tab.comb, id.vars = c("bin.size", "type"))
r2.bgs.plot <- ggplot(data = molten.r2, aes(x = bin.size, y = value, shape = variable))
r2.bgs.plot <- r2.bgs.plot + geom_line(data = molten.r2)
r2.bgs.plot <- r2.bgs.plot + geom_point(aes(shape = variable), size = 4) + facet_wrap(~type)
r2.bgs.plot <- r2.bgs.plot + scale_x_continuous(breaks = c(50, 200, 1000), trans="log10") 
r2.bgs.plot <- r2.bgs.plot + scale_y_continuous(breaks = pretty_breaks())
r2.bgs.plot <- r2.bgs.plot + scale_shape_manual(values = c(0, 1, 2, 3, 4), name = "",
                                                labels = c("Total", expression(theta), expression(rho), expression(tau), expression(theta:tau)))
r2.bgs.plot <- r2.bgs.plot + labs(title = NULL, x = "Bin Size (kb)", y = "Variance Explained (%)") 
r2.bgs.plot <- r2.bgs.plot + theme_bw()
r2.bgs.plot <- r2.bgs.plot + theme(axis.title = element_text(size = 20), axis.text = element_text(size = 16),
                                   strip.text.x = element_text(size = 16), 
                                   legend.text=element_text(size=16), legend.position = "bottom")
r2.bgs.plot

# combine coal and BGS R2 plots
r2.comb.plot <- plot_grid(r2.coal.plot, r2.bgs.plot, nrow = 2, ncol = 1, labels = "AUTO")
cowplot::save_plot("Figure4.pdf", r2.comb.plot, device = "pdf", base_height = 9, base_width = 12)

# bench theta
theta.maps.bgs <- plot_grid(theta.map.50kb.bgs, theta.map.200kb.bgs, theta.map.1Mb.bgs, nrow = 3, ncol = 1)

theta.maps.comb <- plot_grid(theta.maps.coal, theta.maps.bgs, labels = "AUTO", nrow = 1, ncol = 2)
save_plot("Figure2.pdf", theta.maps.comb, base_height = 16, base_width = 12)

# vsualise true join landscapes
dm_2L_exome <- read.table("dm_bgs_sims/GeneAnnotations/exons_chr2L.csv", header = F, sep = ",")
names(dm_2L_exome) <- c("exon_start", "exon_end")

genes_barcode <- ggplot(data = dm_2L_exome) + geom_segment(aes(x = exon_start, xend = exon_end, size = 2))

## 50kb
theta.land.50kb <- cbind.data.frame(1:nrow(sim.theta.50kb), sim.theta.50kb$Rate * 4 * 1e+4 * 1e-7)
names(theta.land.50kb) <- c("bin", "rate")

rho.land.50kb <- cbind.data.frame(1:nrow(sim.rho.50kb), sim.rho.50kb$Rate * 1e-7 * 4 * 1e+4)
names(rho.land.50kb) <- c("bin", "rate")

pi.lands.50kb <- cbind.data.frame(1:nrow(sim.theta.50kb), rep_1.pi.50kb$avg, rep_2.pi.50kb$avg, rep_3.pi.50kb$avg, rep_4.pi.50kb$avg, rep_5.pi.50kb$avg, rep_6.pi.50kb$avg, rep_7.pi.50kb$avg, rep_8.pi.50kb$avg, rep_9.pi.50kb$avg, rep_10.pi.50kb$avg)
names(pi.lands.50kb) <- c("bin", reps)


tau.lands.50kb <- cbind.data.frame(1:nrow(sim.theta.50kb), rep1.sim.tmrca.50kb$AverageTmrca, rep2.sim.tmrca.50kb$AverageTmrca, rep3.sim.tmrca.50kb$AverageTmrca, rep4.sim.tmrca.50kb$AverageTmrca, rep5.sim.tmrca.50kb$AverageTmrca, rep6.sim.tmrca.50kb$AverageTmrca, rep7.sim.tmrca.50kb$AverageTmrca, rep8.sim.tmrca.50kb$AverageTmrca, rep9.sim.tmrca.50kb$AverageTmrca, rep10.sim.tmrca.50kb$AverageTmrca)
names(tau.lands.50kb) <- c("bin", reps)

rho.map.50kb <- ggplot(data = rho.land.50kb, aes(x = (bin -1) * 50, y = rate))
rho.map.50kb <- rho.map.50kb + geom_line(data = rho.land.50kb) + theme_bw()
rho.map.50kb <- rho.map.50kb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.2d, limits = c(0, 0.042))
rho.map.50kb <- rho.map.50kb + labs(title = NULL, x = NULL, y = expression(rho))
rho.map.50kb <- rho.map.50kb + theme(axis.title.x=element_blank(),
                                     axis.text.x=element_blank(),
                                     axis.ticks.x=element_blank(),
                                     axis.title.y=element_text(size = 20), legend.position = "none") 
rho.map.50kb

theta.map.50kb <- ggplot(data = theta.land.50kb, aes(x = (bin -1) * 50, y = rate))
theta.map.50kb <- theta.map.50kb + geom_line(data = theta.land.50kb) + theme_bw()
theta.map.50kb <- theta.map.50kb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.2d, limits = c(0, 0.015))
theta.map.50kb <- theta.map.50kb + labs(title = NULL, x = "Position (kb)", y = expression(theta))
theta.map.50kb <- theta.map.50kb + geom_segment(data = dm_2L_exome, aes(x = exon_start / 1000, xend = exon_end / 1000, y = 0, yend = 0, size = 2))
theta.map.50kb <- theta.map.50kb + theme(legend.position = "none", axis.title.y=element_text(size = 20))
theta.map.50kb

molten.tau <- melt(tau.lands.50kb, id.vars = "bin")
tau.map.50kb <- ggplot(data = molten.tau, aes(x = (bin -1) * 50, y = value / (4 * 1e+4), colour = variable))
tau.map.50kb <- tau.map.50kb + geom_line(data = molten.tau) + theme_bw() 
tau.map.50kb <- tau.map.50kb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 1.01))
tau.map.50kb <- tau.map.50kb + labs(title = NULL, x = NULL, y = expression(tau))
tau.map.50kb <- tau.map.50kb + scale_color_manual(values = c(brewer.pal(n = 9, name = "Greys"), "Black"))
tau.map.50kb <- tau.map.50kb + theme(axis.title.x=element_blank(),
                                     axis.text.x=element_blank(),
                                     axis.ticks.x=element_blank(),
                                     axis.title.y=element_text(size = 20), legend.position = "none") 
tau.map.50kb

molten.pi <- melt(pi.lands.50kb, id.vars = "bin")
pi.map.50kb <- ggplot(data = molten.pi, aes(x = (bin -1) * 50, y = value, colour = variable))
pi.map.50kb <- pi.map.50kb + geom_line(data = molten.pi) + theme_bw()
pi.map.50kb <- pi.map.50kb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 0.016))
pi.map.50kb <- pi.map.50kb + labs(title = "50 kb", x = NULL, y = expression(pi))
pi.map.50kb <- pi.map.50kb + scale_color_manual(values = c(brewer.pal(n = 9, name = "Greys"), "Black"))
pi.map.50kb <- pi.map.50kb + theme(axis.title.x=element_blank(),
                                   axis.text.x=element_blank(),
                                   axis.ticks.x=element_blank(),
                                   axis.title.y=element_text(size = 20),
                                   plot.title = element_text(size = 16), legend.position = "none") 
pi.map.50kb

true.maps.50kb <- plot_grid(pi.map.50kb, tau.map.50kb, rho.map.50kb, theta.map.50kb, ncol = 1)
true.maps.50kb

## 200kb
theta.land.200kb <- cbind.data.frame(1:nrow(sim.theta.200kb), sim.theta.200kb$Rate * 4 * 1e+4 * 1e-7)
names(theta.land.200kb) <- c("bin", "rate")

rho.land.200kb <- cbind.data.frame(1:nrow(sim.rho.200kb), sim.rho.200kb$Rate * 1e-7 * 4 * 1e+4)
names(rho.land.200kb) <- c("bin", "rate")

pi.lands.200kb <- cbind.data.frame(1:nrow(sim.theta.200kb), rep_1.pi.200kb$avg, rep_2.pi.200kb$avg, rep_3.pi.200kb$avg, rep_4.pi.200kb$avg, rep_5.pi.200kb$avg, rep_6.pi.200kb$avg, rep_7.pi.200kb$avg, rep_8.pi.200kb$avg, rep_9.pi.200kb$avg, rep_10.pi.200kb$avg)
names(pi.lands.200kb) <- c("bin", reps)


tau.lands.200kb <- cbind.data.frame(1:nrow(sim.theta.200kb), rep1.sim.tmrca.200kb$AverageTmrca, rep2.sim.tmrca.200kb$AverageTmrca, rep3.sim.tmrca.200kb$AverageTmrca, rep4.sim.tmrca.200kb$AverageTmrca, rep5.sim.tmrca.200kb$AverageTmrca, rep6.sim.tmrca.200kb$AverageTmrca, rep7.sim.tmrca.200kb$AverageTmrca, rep8.sim.tmrca.200kb$AverageTmrca, rep9.sim.tmrca.200kb$AverageTmrca, rep10.sim.tmrca.200kb$AverageTmrca)
names(tau.lands.200kb) <- c("bin", reps)


rho.map.200kb <- ggplot(data = rho.land.200kb, aes(x = (bin -1) * 200, y = rate))
rho.map.200kb <- rho.map.200kb + geom_line(data = rho.land.200kb) + theme_bw()
rho.map.200kb <- rho.map.200kb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 0.042))
rho.map.200kb <- rho.map.200kb + labs(title = NULL, x = NULL, y = NULL)
rho.map.200kb <- rho.map.200kb + theme(axis.title.x=element_blank(),
                                       axis.text.x=element_blank(),
                                       axis.ticks.x=element_blank(),
                                       axis.title.y=element_text(size = 20), legend.position = "none") 
rho.map.200kb

theta.map.200kb <- ggplot(data = theta.land.200kb, aes(x = (bin -1) * 200, y = rate))
theta.map.200kb <- theta.map.200kb + geom_line(data = theta.land.200kb) + theme_bw()
theta.map.200kb <- theta.map.200kb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 0.015))
theta.map.200kb <- theta.map.200kb + labs(title = NULL, x = "Position (kb)", y = NULL)
theta.map.200kb <- theta.map.200kb + geom_segment(data = dm_2L_exome, aes(x = exon_start / 1000, xend = exon_end / 1000, y = 0, yend = 0, size = 2))
theta.map.200kb <- theta.map.200kb + theme(legend.position = "none", axis.title.y=element_text(size = 20))
theta.map.200kb

molten.tau <- melt(tau.lands.200kb, id.vars = "bin")
tau.map.200kb <- ggplot(data = molten.tau, aes(x = (bin -1) * 200, y = value / (4 * 1e+4), colour = variable))
tau.map.200kb <- tau.map.200kb + geom_line(data = molten.tau) + theme_bw()
tau.map.200kb <- tau.map.200kb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 1.01))
tau.map.200kb <- tau.map.200kb + labs(title = NULL, x = NULL, y = NULL) 
tau.map.200kb <- tau.map.200kb + scale_color_manual(values = c(brewer.pal(n = 9, name = "Greys"), "Black"))
tau.map.200kb <- tau.map.200kb + theme(axis.title.x=element_blank(),
                                       axis.text.x=element_blank(),
                                       axis.ticks.x=element_blank(),
                                       axis.title.y=element_text(size = 20), legend.position = "none") 
tau.map.200kb

molten.pi <- melt(pi.lands.200kb, id.vars = "bin")
pi.map.200kb <- ggplot(data = molten.pi, aes(x = (bin -1) * 200, y = value, colour = variable))
pi.map.200kb <- pi.map.200kb + geom_line(data = molten.pi) + theme_bw() 
pi.map.200kb <- pi.map.200kb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 0.016))
pi.map.200kb <- pi.map.200kb + labs(title = "200 kb", x = NULL, y = NULL)
pi.map.200kb <- pi.map.200kb + scale_color_manual(values = c(brewer.pal(n = 9, name = "Greys"), "Black"))
pi.map.200kb <- pi.map.200kb + theme(axis.title.x=element_blank(),
                                     axis.text.x=element_blank(),
                                     axis.ticks.x=element_blank(),
                                     axis.title.y=element_text(size = 20),
                                     plot.title = element_text(size = 16), legend.position = "none") 
pi.map.200kb

true.maps.200kb <- plot_grid(pi.map.200kb, tau.map.200kb, rho.map.200kb, theta.map.200kb, ncol = 1)
true.maps.200kb

## 1Mb
theta.land.1Mb <- cbind.data.frame(1:nrow(sim.theta.1Mb), sim.theta.1Mb$Rate * 4 * 1e+4 * 1e-7)
names(theta.land.1Mb) <- c("bin", "rate")

rho.land.1Mb <- cbind.data.frame(1:nrow(sim.rho.1Mb), sim.rho.1Mb$Rate * 1e-7 * 4 * 1e+4)
names(rho.land.1Mb) <- c("bin", "rate")

pi.lands.1Mb <- cbind.data.frame(1:nrow(sim.theta.1Mb), rep_1.pi.1Mb$avg, rep_2.pi.1Mb$avg, rep_3.pi.1Mb$avg, rep_4.pi.1Mb$avg, rep_5.pi.1Mb$avg, rep_6.pi.1Mb$avg, rep_7.pi.1Mb$avg, rep_8.pi.1Mb$avg, rep_9.pi.1Mb$avg, rep_10.pi.1Mb$avg)
names(pi.lands.1Mb) <- c("bin", reps)


tau.lands.1Mb <- cbind.data.frame(1:nrow(sim.theta.1Mb), rep1.sim.tmrca.1Mb$AverageTmrca, rep2.sim.tmrca.1Mb$AverageTmrca, rep3.sim.tmrca.1Mb$AverageTmrca, rep4.sim.tmrca.1Mb$AverageTmrca, rep5.sim.tmrca.1Mb$AverageTmrca, rep6.sim.tmrca.1Mb$AverageTmrca, rep7.sim.tmrca.1Mb$AverageTmrca, rep8.sim.tmrca.1Mb$AverageTmrca, rep9.sim.tmrca.1Mb$AverageTmrca, rep10.sim.tmrca.1Mb$AverageTmrca)
names(tau.lands.1Mb) <- c("bin", reps)


rho.map.1Mb <- ggplot(data = rho.land.1Mb, aes(x = (bin -1) * 1000, y = rate))
rho.map.1Mb <- rho.map.1Mb + geom_line(data = rho.land.1Mb)  + theme_bw()
rho.map.1Mb <- rho.map.1Mb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 0.042))
rho.map.1Mb <- rho.map.1Mb + labs(title = NULL, x = NULL, y = NULL) 
rho.map.1Mb <- rho.map.1Mb + theme(axis.title.x=element_blank(),
                                   axis.text.x=element_blank(),
                                   axis.ticks.x=element_blank(),
                                   axis.title.y=element_text(size = 20), legend.position = "none") 
rho.map.1Mb

theta.map.1Mb <- ggplot(data = theta.land.1Mb, aes(x = (bin -1) * 1000, y = rate))
theta.map.1Mb <- theta.map.1Mb + geom_line(data = theta.land.1Mb) + theme_bw() 
theta.map.1Mb <- theta.map.1Mb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 0.015))
theta.map.1Mb <- theta.map.1Mb + labs(title = NULL, x = "Position (kb)", y = NULL) 
theta.map.1Mb <- theta.map.1Mb + geom_segment(data = dm_2L_exome, aes(x = exon_start / 1000, xend = exon_end / 1000, y = 0, yend = 0, size = 2))
theta.map.1Mb <- theta.map.1Mb + theme(legend.position = "none", axis.title.y=element_text(size = 20))

theta.map.1Mb

molten.tau <- melt(tau.lands.1Mb, id.vars = "bin")
tau.map.1Mb <- ggplot(data = molten.tau, aes(x = (bin -1) * 1000, y = value / (4 * 1e+4), colour = variable))
tau.map.1Mb <- tau.map.1Mb + geom_line(data = molten.tau) + theme_bw()
tau.map.1Mb <- tau.map.1Mb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 1.01))
tau.map.1Mb <- tau.map.1Mb + labs(title = NULL, x = NULL, y = NULL)
tau.map.1Mb <- tau.map.1Mb + scale_color_manual(values = c(brewer.pal(n = 9, name = "Greys"), "Black"))
tau.map.1Mb <- tau.map.1Mb + theme(axis.title.x=element_blank(),
                                   axis.text.x=element_blank(),
                                   axis.ticks.x=element_blank(),
                                   axis.title.y=element_text(size = 20), legend.position = "none") 
tau.map.1Mb

molten.pi <- melt(pi.lands.1Mb, id.vars = "bin")
pi.map.1Mb <- ggplot(data = molten.pi, aes(x = (bin -1) * 1000, y = value, colour = variable))
pi.map.1Mb <- pi.map.1Mb + geom_line(data = molten.pi) + theme_bw()
pi.map.1Mb <- pi.map.1Mb + scale_y_continuous(breaks = pretty_breaks(), labels = scale.3d, limits = c(0, 0.016))
pi.map.1Mb <- pi.map.1Mb + labs(title = "1 Mb", x = NULL, y = NULL) 
pi.map.1Mb <- pi.map.1Mb + scale_color_manual(values = c(brewer.pal(n = 9, name = "Greys"), "Black"))
pi.map.1Mb <- pi.map.1Mb + theme(axis.title.x=element_blank(),
                                 axis.text.x=element_blank(),
                                 axis.ticks.x=element_blank(),
                                 axis.title.y=element_text(size = 20),
                                 plot.title = element_text(size = 16), legend.position = "none") 
pi.map.1Mb

true.maps.1Mb <- plot_grid(pi.map.1Mb, tau.map.1Mb, rho.map.1Mb, theta.map.1Mb, ncol = 1)
true.maps.1Mb

true.maps <- plot_grid(true.maps.50kb, true.maps.200kb, true.maps.1Mb, labels = "AUTO", ncol = 3, align = "hv")
true.maps
save_plot("Figure7.pdf", true.maps, base_height = 10, base_width = 20)


mean(apply(tau.lands.50kb[2:ncol(tau.lands.50kb)], 2, sd) / apply(tau.lands.50kb[2:ncol(tau.lands.50kb)], 2, mean))
mean(apply(tau.lands.200kb[2:ncol(tau.lands.200kb)], 2, sd) / apply(tau.lands.200kb[2:ncol(tau.lands.200kb)], 2, mean))
mean(apply(tau.lands.1Mb[2:ncol(tau.lands.1Mb)], 2, sd) / apply(tau.lands.1Mb[2:ncol(tau.lands.1Mb)], 2, mean))
sd(apply(tau.lands.50kb[2:ncol(tau.lands.50kb)], 2, sd) / apply(tau.lands.50kb[2:ncol(tau.lands.50kb)], 2, mean))
sd(apply(tau.lands.200kb[2:ncol(tau.lands.200kb)], 2, sd) / apply(tau.lands.200kb[2:ncol(tau.lands.200kb)], 2, mean))
sd(apply(tau.lands.1Mb[2:ncol(tau.lands.1Mb)], 2, sd) / apply(tau.lands.1Mb[2:ncol(tau.lands.1Mb)], 2, mean))

mean(apply(pi.lands.50kb[2:ncol(pi.lands.50kb)], 2, sd) / apply(pi.lands.50kb[2:ncol(pi.lands.50kb)], 2, mean))
mean(apply(pi.lands.200kb[2:ncol(pi.lands.200kb)], 2, sd) / apply(pi.lands.200kb[2:ncol(pi.lands.200kb)], 2, mean))
mean(apply(pi.lands.1Mb[2:ncol(pi.lands.1Mb)], 2, sd) / apply(pi.lands.1Mb[2:ncol(pi.lands.1Mb)], 2, mean))
sd(apply(pi.lands.50kb[2:ncol(pi.lands.50kb)], 2, sd) / apply(pi.lands.50kb[2:ncol(pi.lands.50kb)], 2, mean))
sd(apply(pi.lands.200kb[2:ncol(pi.lands.200kb)], 2, sd) / apply(pi.lands.200kb[2:ncol(pi.lands.200kb)], 2, mean))
sd(apply(pi.lands.1Mb[2:ncol(pi.lands.1Mb)], 2, sd) / apply(pi.lands.1Mb[2:ncol(pi.lands.1Mb)], 2, mean))

```

# Exploring neutral evolutionary scenarios

## bottleneck_r_1e-8_flat_mu

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/bottleneck_r_1e-8_flat_mu/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.50kb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "/sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "/rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "/rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)

  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "rho", "tmrca")

  # centering
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)

  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)

  m.div.50kb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.50kb)

  summary(m.div.50kb)

  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)

  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))


# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.200kb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "/sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "/rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "/rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))


# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.1Mb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "/sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))


r2.sim.avg_1 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_1) <- c("Total", "Rho", "TMRCA")
r2.sim.avg_1$Theta <- NA
r2.sim.avg_1 <- r2.sim.avg_1[,c(1,4,2,3)]
r2.sim.avg_1$bin.size <- c(50, 200, 1000)
r2.sim.avg_1$rho <- "r = 1e-8"
r2.sim.avg_1$mu_block <- "mu = flat"

```

## bottleneck_r_1e-8_mu_change_50kb

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/bottleneck_r_1e-8_mu_change_50kb/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "/sim.rho.50000.map", sep = ""), header = T)
sim.theta.50kb <- read.table(paste(d, "/sim.theta.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$thetaC <- sim.lands.50kb$theta - mean(sim.lands.50kb$theta)
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.50kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))


# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "/sim.rho.2e+05.map", sep = ""), header = T)
sim.theta.200kb <- read.table(paste(d, "/sim.theta.2e+05.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "/rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "/rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$thetaC <- sim.lands.200kb$theta - mean(sim.lands.200kb$theta)
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.200kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))


# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.1e+06.map", sep = ""), header = T)
sim.theta.1Mb <- read.table(paste(d,"sim.theta.1e+06.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$thetaC <- sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.1Mb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_2 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_2) <- c("Total", "Theta", "Rho", "TMRCA")
r2.sim.avg_2$bin.size <- c(50, 200, 1000)
r2.sim.avg_2$rho <- "r = 1e-8"
r2.sim.avg_2$mu_block <- "avg mu block = 50 kb"

```

## bottleneck_r_1e-8_mu_change_500kb

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/bottleneck_r_1e-8_mu_change_500kb/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)
sim.theta.50kb <- read.table(paste(d, "sim.theta.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$thetaC <- sim.lands.50kb$theta - mean(sim.lands.50kb$theta)
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.50kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))


# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.2e+05.map", sep = ""), header = T)
sim.theta.200kb <- read.table(paste(d,"sim.theta.2e+05.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$thetaC <- sim.lands.200kb$theta - mean(sim.lands.200kb$theta)
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.200kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))


# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.1e+06.map", sep = ""), header = T)
sim.theta.1Mb <- read.table(paste(d,"sim.theta.1e+06.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$thetaC <- sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.1Mb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_3 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_3) <- c("Total", "Theta", "Rho", "TMRCA")
r2.sim.avg_3$bin.size <- c(50, 200, 1000)
r2.sim.avg_3$rho <- "r = 1e-8"
r2.sim.avg_3$mu_block <- "avg mu block = 500 kb"

```

## bottleneck_r_1e-9_flat_mu

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/bottleneck_r_1e-9_flat_mu/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.50kb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))


# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.200kb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))


# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.1Mb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))


# true landscapes
r2.sim.avg_4 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_4) <- c("Total", "Rho", "TMRCA")
r2.sim.avg_4$Theta <- NA
r2.sim.avg_4 <- r2.sim.avg_4[,c(1,4,2,3)]
r2.sim.avg_4$bin.size <- c(50, 200, 1000)
r2.sim.avg_4$rho <- "r = 1e-9"
r2.sim.avg_4$mu_block <- "mu = flat"

```

## bottleneck_r_1e-9_mu_change_50kb

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/bottleneck_r_1e-9_mu_change_50kb/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)
sim.theta.50kb <- read.table(paste(d, "sim.theta.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$thetaC <- sim.lands.50kb$theta - mean(sim.lands.50kb$theta)
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.50kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))

# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.2e+05.map", sep = ""), header = T)
sim.theta.200kb <- read.table(paste(d,"sim.theta.2e+05.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$thetaC <- sim.lands.200kb$theta - mean(sim.lands.200kb$theta)
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.200kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.1e+06.map", sep = ""), header = T)
sim.theta.1Mb <- read.table(paste(d,"sim.theta.1e+06.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$thetaC <- sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.1Mb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_5 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_5) <- c("Total", "Theta", "Rho", "TMRCA")
r2.sim.avg_5$bin.size <- c(50, 200, 1000)
r2.sim.avg_5$rho <- "r = 1e-9"
r2.sim.avg_5$mu_block <- "avg mu block = 50 kb"

```

## bottleneck_r_1e-9_mu_change_500kb

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/bottleneck_r_1e-9_mu_change_500kb/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)
sim.theta.50kb <- read.table(paste(d, "sim.theta.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$thetaC <- sim.lands.50kb$theta - mean(sim.lands.50kb$theta)
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.50kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))

# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.2e+05.map", sep = ""), header = T)
sim.theta.200kb <- read.table(paste(d,"sim.theta.2e+05.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$thetaC <- sim.lands.200kb$theta - mean(sim.lands.200kb$theta)
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.200kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.1e+06.map", sep = ""), header = T)
sim.theta.1Mb <- read.table(paste(d,"sim.theta.1e+06.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$thetaC <- sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.1Mb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))


# true landscapes
r2.sim.avg_6 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_6) <- c("Total", "Theta", "Rho", "TMRCA")
r2.sim.avg_6$bin.size <- c(50, 200, 1000)
r2.sim.avg_6$rho <- "r = 1e-9"
r2.sim.avg_6$mu_block <- "avg mu block = 500 kb"

```

## bottleneck plot

```{r, message=FALSE, warning=FALSE}

r2.sim.bottleneck <- rbind.data.frame(r2.sim.avg_1, r2.sim.avg_2, r2.sim.avg_3, r2.sim.avg_4, r2.sim.avg_5, r2.sim.avg_6, make.row.names = F)
r2.sim.bottleneck$mu_block = factor(r2.sim.bottleneck$mu_block, levels=c('mu = flat','avg mu block = 500 kb','avg mu block = 50 kb'))

molten.r2 <- melt(r2.sim.bottleneck, id.vars = c("bin.size", "rho", "mu_block"))

r2.plot_bottleneck <- ggplot(data = molten.r2, aes(x = bin.size, y = value, shape = variable))
r2.plot_bottleneck <- r2.plot_bottleneck + geom_line(data = molten.r2) + facet_grid(rho ~ mu_block) 
r2.plot_bottleneck <- r2.plot_bottleneck + geom_point(aes(shape = variable), size = 4)
r2.plot_bottleneck <- r2.plot_bottleneck + scale_shape_manual(values = c(0, 1, 2, 8), name = "",
                                                              labels = c("Total", expression(theta), expression(rho), expression(tau)))
r2.plot_bottleneck <- r2.plot_bottleneck + scale_x_continuous(breaks = c(50, 200, 1000), limits = c(40, 1200), trans="log10") 
r2.plot_bottleneck <- r2.plot_bottleneck + scale_y_continuous(breaks = pretty_breaks())
r2.plot_bottleneck <- r2.plot_bottleneck + labs(title = NULL, x = "Bin Size (kb)", y = "Variance Explained (%)") + theme_bw()
r2.plot_bottleneck <- r2.plot_bottleneck + theme(axis.title = element_text(size = 16), axis.text = element_text(size = 12), 
                                                 strip.text.x = element_text(size = 16), strip.text.y = element_text(size = 16),
                                                 legend.text=element_text(size=16), legend.position = "bottom")

```

## flat_Ne_r_1e-8_flat_mu

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/flat_Ne_r_1e-8_flat_mu/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.50kb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))

# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.200kb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.1Mb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_1 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_1) <- c("Total", "Rho", "TMRCA")
r2.sim.avg_1$Theta <- NA
r2.sim.avg_1 <- r2.sim.avg_1[,c(1,4,2,3)]
r2.sim.avg_1$bin.size <- c(50, 200, 1000)
r2.sim.avg_1$rho <- "r = 1e-8"
r2.sim.avg_1$mu_block <- "mu = flat"

```

## flat_Ne_r_1e-8_mu_change_50kb

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/flat_Ne_r_1e-8_mu_change_50kb/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)
sim.theta.50kb <- read.table(paste(d, "sim.theta.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$thetaC <- sim.lands.50kb$theta - mean(sim.lands.50kb$theta)
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.50kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))

# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.2e+05.map", sep = ""), header = T)
sim.theta.200kb <- read.table(paste(d,"sim.theta.2e+05.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$thetaC <- sim.lands.200kb$theta - mean(sim.lands.200kb$theta)
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.200kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.1e+06.map", sep = ""), header = T)
sim.theta.1Mb <- read.table(paste(d,"sim.theta.1e+06.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$thetaC <- sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.1Mb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_2 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_2) <- c("Total", "Theta", "Rho", "TMRCA")
r2.sim.avg_2$bin.size <- c(50, 200, 1000)
r2.sim.avg_2$rho <- "r = 1e-8"
r2.sim.avg_2$mu_block <- "avg mu block = 50 kb"

```

## flat_Ne_r_1e-8_mu_change_500kb

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/flat_Ne_r_1e-8_mu_change_500kb/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)
sim.theta.50kb <- read.table(paste(d, "sim.theta.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$thetaC <- sim.lands.50kb$theta - mean(sim.lands.50kb$theta)
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.50kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))

# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.2e+05.map", sep = ""), header = T)
sim.theta.200kb <- read.table(paste(d,"sim.theta.2e+05.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$thetaC <- sim.lands.200kb$theta - mean(sim.lands.200kb$theta)
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.200kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.1e+06.map", sep = ""), header = T)
sim.theta.1Mb <- read.table(paste(d,"sim.theta.1e+06.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$thetaC <- sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.1Mb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_3 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_3) <- c("Total", "Theta", "Rho", "TMRCA")
r2.sim.avg_3$bin.size <- c(50, 200, 1000)
r2.sim.avg_3$rho <- "r = 1e-8"
r2.sim.avg_3$mu_block <- "avg mu block = 500 kb"

```

## flat_Ne_r_1e-9_flat_mu

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/flat_Ne_r_1e-9_flat_mu/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.50kb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))

# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.200kb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 3))
row.names(r2.sim.1Mb) <- c("Total", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ rhoC + tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_4 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_4) <- c("Total", "Rho", "TMRCA")
r2.sim.avg_4$Theta <- NA
r2.sim.avg_4 <- r2.sim.avg_4[,c(1,4,2,3)]
r2.sim.avg_4$bin.size <- c(50, 200, 1000)
r2.sim.avg_4$rho <- "r = 1e-9"
r2.sim.avg_4$mu_block <- "mu = flat"

```

## flat_Ne_r_1e-9_mu_change_50kb

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/flat_Ne_r_1e-9_mu_change_50kb/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)
sim.theta.50kb <- read.table(paste(d, "sim.theta.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$thetaC <- sim.lands.50kb$theta - mean(sim.lands.50kb$theta)
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.50kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))

# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.2e+05.map", sep = ""), header = T)
sim.theta.200kb <- read.table(paste(d,"sim.theta.2e+05.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$thetaC <- sim.lands.200kb$theta - mean(sim.lands.200kb$theta)
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.200kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.1e+06.map", sep = ""), header = T)
sim.theta.1Mb <- read.table(paste(d,"sim.theta.1e+06.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$thetaC <- sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.1Mb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_5 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_5) <- c("Total", "Theta", "Rho", "TMRCA")
r2.sim.avg_5$bin.size <- c(50, 200, 1000)
r2.sim.avg_5$rho <- "r = 1e-9"
r2.sim.avg_5$mu_block <- "avg mu block = 50 kb"

```

## flat_Ne_r_1e-9_mu_change_500kb

```{r, message=FALSE, warning=FALSE}

d <- "other_neutral_scenarios/flat_Ne_r_1e-9_mu_change_500kb/"

# 50kb
r2.sim.50kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.50kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.50kb) <- reps

sim.rho.50kb <- read.table(paste(d, "sim.rho.50000.map", sep = ""), header = T)
sim.theta.50kb <- read.table(paste(d, "sim.theta.50000.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.50kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.50kb.bedgraph", sep = ""), header = T)
  rep_tmrca.50kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.50k.map", sep = ""), header = T)
  
  sim.lands.50kb <- as.data.frame(cbind(rep_pi.50kb$pi, sim.theta.50kb$sim, sim.rho.50kb$sim, rep_tmrca.50kb$tmrca))
  names(sim.lands.50kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.50kb$thetaC <- sim.lands.50kb$theta - mean(sim.lands.50kb$theta)
  sim.lands.50kb$tmrcaC <- sim.lands.50kb$tmrca - mean(sim.lands.50kb$tmrca)
  sim.lands.50kb$rhoC <- sim.lands.50kb$rho - mean(sim.lands.50kb$rho)
  
  sim.lands.50kb$bin <- 1:nrow(sim.lands.50kb)
  
  m.div.50kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.50kb)
  
  summary(m.div.50kb)
  
  anova.diversity <- Anova(m.div.50kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.50kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.50kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.50kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.50kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.50kb$average <- rowMeans(r2.sim.50kb)
r2.sim.50kb <- transform(r2.sim.50kb, sd=apply(r2.sim.50kb, 1, sd, na.rm = TRUE))

# 200kb
r2.sim.200kb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.200kb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.200kb) <- reps

sim.rho.200kb <- read.table(paste(d, "sim.rho.2e+05.map", sep = ""), header = T)
sim.theta.200kb <- read.table(paste(d,"sim.theta.2e+05.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.200kb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.200kb.bedgraph", sep = ""), header = T)
  rep_tmrca.200kb <- read.table(paste(d, "rep_", i, "/sim.tmrca.200k.map", sep = ""), header = T)
  
  sim.lands.200kb <- as.data.frame(cbind(rep_pi.200kb$pi, sim.theta.200kb$sim, sim.rho.200kb$sim, rep_tmrca.200kb$tmrca))
  names(sim.lands.200kb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.200kb$thetaC <- sim.lands.200kb$theta - mean(sim.lands.200kb$theta)
  sim.lands.200kb$tmrcaC <- sim.lands.200kb$tmrca - mean(sim.lands.200kb$tmrca)
  sim.lands.200kb$rhoC <- sim.lands.200kb$rho - mean(sim.lands.200kb$rho)
  
  sim.lands.200kb$bin <- 1:nrow(sim.lands.200kb)
  
  m.div.200kb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.200kb)
  
  summary(m.div.200kb)
  
  anova.diversity <- Anova(m.div.200kb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.200kb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.200kb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.200kb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.200kb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.200kb$average <- rowMeans(r2.sim.200kb)
r2.sim.200kb <- transform(r2.sim.200kb, sd=apply(r2.sim.200kb, 1, sd, na.rm = TRUE))

# 1Mb
r2.sim.1Mb <- as.data.frame(matrix(ncol = nreps, nrow = 4))
row.names(r2.sim.1Mb) <- c("Total", "Theta", "Rho", "TMRCA")
colnames(r2.sim.1Mb) <- reps

sim.rho.1Mb <- read.table(paste(d, "sim.rho.1e+06.map", sep = ""), header = T)
sim.theta.1Mb <- read.table(paste(d,"sim.theta.1e+06.map", sep = ""), header = T)

for(i in 1:nreps) {
  rep_pi.1Mb <- read.table(paste(d, "rep_", i, "/rep_", i, ".pi.1Mb.bedgraph", sep = ""), header = T)
  rep_tmrca.1Mb <- read.table(paste(d, "rep_", i, "/sim.tmrca.1M.map", sep = ""), header = T)
  
  sim.lands.1Mb <- as.data.frame(cbind(rep_pi.1Mb$pi, sim.theta.1Mb$sim, sim.rho.1Mb$sim, rep_tmrca.1Mb$tmrca))
  names(sim.lands.1Mb) <- c("diversity", "theta", "rho", "tmrca")
  
  # centering
  sim.lands.1Mb$thetaC <- sim.lands.1Mb$theta - mean(sim.lands.1Mb$theta)
  sim.lands.1Mb$tmrcaC <- sim.lands.1Mb$tmrca - mean(sim.lands.1Mb$tmrca)
  sim.lands.1Mb$rhoC <- sim.lands.1Mb$rho - mean(sim.lands.1Mb$rho)
  
  sim.lands.1Mb$bin <- 1:nrow(sim.lands.1Mb)
  
  m.div.1Mb <- lm( I(diversity * 1e+6) ~ thetaC + rhoC + tmrcaC + thetaC:tmrcaC, data = sim.lands.1Mb)
  
  summary(m.div.1Mb)
  
  anova.diversity <- Anova(m.div.1Mb)
  apiss <- anova.diversity$"Sum Sq"
  anova.diversity$VarExp <- apiss / sum(apiss)
  
  r2.sim.1Mb[1, i] <- (anova.diversity$VarExp[1] + anova.diversity$VarExp[2] + anova.diversity$VarExp[3] + anova.diversity$VarExp[4]) * 100
  r2.sim.1Mb[2, i] <- anova.diversity$VarExp[1] * 100
  r2.sim.1Mb[3, i] <- anova.diversity$VarExp[2] * 100
  r2.sim.1Mb[4, i] <- anova.diversity$VarExp[3] * 100
}

r2.sim.1Mb$average <- rowMeans(r2.sim.1Mb)
r2.sim.1Mb <- transform(r2.sim.1Mb, sd=apply(r2.sim.1Mb, 1, sd, na.rm = TRUE))

# true landscapes
r2.sim.avg_6 <- rbind.data.frame(r2.sim.50kb$average, r2.sim.200kb$average, r2.sim.1Mb$average, make.row.names = F)
colnames(r2.sim.avg_6) <- c("Total", "Theta", "Rho", "TMRCA")
r2.sim.avg_6$bin.size <- c(50, 200, 1000)
r2.sim.avg_6$rho <- "r = 1e-9"
r2.sim.avg_6$mu_block <- "avg mu block = 500 kb"

```

## flat_Ne plot

```{r, message=FALSE, warning=FALSE}

r2.sim.flat_Ne <- rbind.data.frame(r2.sim.avg_1, r2.sim.avg_2, r2.sim.avg_3, r2.sim.avg_4, r2.sim.avg_5, r2.sim.avg_6, make.row.names = F)
r2.sim.flat_Ne$mu_block = factor(r2.sim.flat_Ne$mu_block, levels=c('mu = flat','avg mu block = 500 kb','avg mu block = 50 kb'))

molten.r2 <- melt(r2.sim.flat_Ne, id.vars = c("bin.size", "rho", "mu_block"))

r2.plot_flat_Ne <- ggplot(data = molten.r2, aes(x = bin.size, y = value, shape = variable))
r2.plot_flat_Ne <- r2.plot_flat_Ne + geom_line(data = molten.r2) + facet_grid(rho ~ mu_block) 
r2.plot_flat_Ne <- r2.plot_flat_Ne + geom_point(aes(shape = variable), size = 4)
r2.plot_flat_Ne <- r2.plot_flat_Ne + scale_shape_manual(values = c(0, 1, 2, 8))
r2.plot_flat_Ne <- r2.plot_flat_Ne + scale_x_continuous(breaks = c(50, 200, 1000), limits = c(40, 1200), trans="log10") 
r2.plot_flat_Ne <- r2.plot_flat_Ne + scale_y_continuous(breaks = pretty_breaks())
r2.plot_flat_Ne <- r2.plot_flat_Ne + labs(title = NULL, x = NULL, y = "Variance Explained (%)") + theme_bw()
r2.plot_flat_Ne <- r2.plot_flat_Ne + theme(axis.title = element_text(size = 16), axis.text = element_text(size = 12), 
                                           strip.text.x = element_text(size = 16), strip.text.y = element_text(size = 16), legend.position = "none")

```

## plots combined

```{r, message=FALSE, warning=FALSE}

coal.sims.plot <- plot_grid(r2.plot_flat_Ne, r2.plot_bottleneck, nrow = 2, ncol = 1, labels = "AUTO")
coal.sims.plot
save_plot("Figure5.pdf", coal.sims.plot, device = "pdf", base_width = 9, base_height = 12)

```
